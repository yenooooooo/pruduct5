<!-- =========================
  HabitFlow (Hardened Build)
  PART 1 / 2  (<= ~800 lines)
  - ê´€ë¦¬ì íŒ¨ë„ í¬í•¨
  - ì¤‘ë³µ/ì¶©ëŒ ì œê±°
  - í´ë¦­/ë²„íŠ¼ ë¨¹í†µ ì›ì¸ ì œê±°
========================= -->
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>HabitFlow - Ultimate God Mode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --bg-color: #f8fafc;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --card-bg: rgba(255, 255, 255, 0.85);
      --card-border: rgba(255, 255, 255, 0.6);
      --panel-bg: #ffffff;
      --input-bg: rgba(241, 245, 249, 0.8);
      --primary: #6366f1;
      --secondary: #a855f7;
      --accent: #f59e0b;
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.08);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    }

    body.dark-mode {
      --bg-color: #0f172a;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --card-bg: rgba(30, 41, 59, 0.75);
      --card-border: rgba(255, 255, 255, 0.08);
      --panel-bg: #1e293b;
      --input-bg: rgba(15, 23, 42, 0.6);
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: 'SUIT', sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      position: relative;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    button {
      font-family: inherit;
    }

    @keyframes pulse {
      0% {
        transform: scale(0.95);
        opacity: 0.7;
      }

      100% {
        transform: scale(1.05);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(40px, 60px);
      }
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes ticker {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    @keyframes breathe {

      0%,
      100% {
        transform: scale(1);
        opacity: 0.3;
      }

      50% {
        transform: scale(1.5);
        opacity: 0.6;
      }
    }

    @keyframes slideDown {
      from {
        top: -100px;
      }

      to {
        top: 100px;
      }
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
      }

      to {
        transform: translateX(0);
      }
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }

      100% {
        transform: translateY(-100vh) scale(1.5);
        opacity: 0;
      }
    }

    @keyframes glowing {
      0% {
        background-position: 0 0;
      }

      50% {
        background-position: 400% 0;
      }

      100% {
        background-position: 0 0;
      }
    }

    /* âœ… í´ë¦­/ë“œë˜ê·¸ ë¨¹í†µ ë°©ì§€: ê¸°ë³¸ì€ auto */
    section {
      width: 100%;
      padding: 84px 20px;
      position: relative;
      z-index: 1;
      pointer-events: auto;
    }

    .container {
      width: 100%;
      max-width: 1080px;
      margin: 0 auto;
    }

    .glass,
    button,
    input,
    .card,
    .price-card,
    .workout-side-panel,
    .problem-card,
    .memo-panel {
      pointer-events: auto;
    }

    header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px 0;
      z-index: 10;
      pointer-events: auto;
    }

    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-weight: 900;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-main);
    }

    .logo-badge {
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 50%;
    }

    nav {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .pc-only {
      display: block;
    }

    @media (max-width: 600px) {
      .pc-only {
        display: none;
      }
    }

    .glass {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(16px);
      border-radius: 24px;
      transition: transform 0.25s ease;
    }

    .glass:hover {
      transform: translateY(-4px);
    }

    .hero {
      padding-top: 140px;
      padding-bottom: 80px;
    }

    .hero {
      padding-top: 110px;
      /* í—¤ë”ë‘ ê²¹ì¹˜ì§€ ì•Šê²Œ + ê½‰ ì°¨ê²Œ */
      padding-bottom: 70px;
      /* ì•„ë˜ë„ ì‚´ì§ */
    }


    .hero-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      /* 1:1 ë¹„ìœ¨ë¡œ ê¹”ë”í•˜ê²Œ */
      gap: 60px;
      align-items: center;
      /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
    }

    /* ëª¨ë°”ì¼ì—ì„œëŠ” ì„¸ë¡œë¡œ ë°°ì¹˜ */
    @media (max-width: 900px) {
      .hero-grid {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .hero-reasons {
        flex-direction: column;
      }
    }

    /* âœ… ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ ì „ìš© */
    .hero-right {
      display: flex;
      flex-direction: column;
      gap: 20px;
      /* íŒŒë€ â†” ë¹¨ê°„ ê°„ê²© */
      align-items: stretch;
    }


    .hero-pill {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 800;
      background: rgba(99, 102, 241, 0.15);
      color: var(--primary);
    }

    .hero-title {
      font-size: 46px;
      line-height: 1.2;
      letter-spacing: -1px;
      margin: 18px 0;
      font-weight: 900;
      color: var(--text-main);
    }

    .hero-desc {
      font-size: 16px;
      color: var(--text-muted);
      line-height: 1.7;
      margin-bottom: 24px;
    }

    .hero-metrics {
      display: flex;
      gap: 14px;
      margin-top: 28px;
    }

    .metric-card {
      padding: 14px 18px;
      border-radius: 16px;
      background: var(--input-bg);
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
      color: var(--text-main);
    }

    .recommend-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 15px;
      color: var(--text-main);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      transition: opacity 0.5s ease-in-out;
      min-height: 140px;
      justify-content: center;
    }

    .dashboard-layout {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 24px;
      max-width: 960px;
      margin: 0 auto;
      display: none;
    }

    #app {
      flex: 1;
      max-width: 480px;
      padding: 30px;
      text-align: center;
      position: relative;
      z-index: 10;
      width: 100%;
    }

    .right-stack {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 340px;
      flex-shrink: 0;
    }

    .workout-side-panel {
      width: 100%;
      background: linear-gradient(145deg, #1e293b, #0f172a);
      color: white;
      padding: 24px;
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
      display: none;
      text-align: left;
      position: relative;
      overflow: hidden;
    }

    .master-badge-corner {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
      border: 1px solid #fbbf24;
      font-size: 10px;
      font-weight: 800;
      padding: 4px 8px;
      border-radius: 6px;
      letter-spacing: 1px;
    }

    .w-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 20px;
      background: linear-gradient(to right, #fff, #94a3b8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .workout-tabs {
      display: flex;
      background: rgba(0, 0, 0, 0.3);
      padding: 4px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .w-tab {
      flex: 1;
      border: none;
      background: transparent;
      color: #94a3b8;
      padding: 8px;
      font-size: 13px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .w-tab.active {
      background: #fbbf24;
      color: #000;
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
    }

    .workout-display {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px 10px;
      text-align: center;
      margin-bottom: 20px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .wd-main {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 4px;
      color: #fff;
    }

    .wd-sub {
      font-size: 12px;
      color: #94a3b8;
    }

    .workout-anim {
      animation: pulse 0.5s infinite alternate;
      color: #fbbf24;
      font-size: 24px;
      font-weight: 900;
    }

    .memo-panel {
      width: 100%;
      padding: 20px;
      text-align: left;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }

    .memo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .memo-title {
      font-weight: 800;
      font-size: 16px;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .memo-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      background: var(--primary);
      color: white;
      font-weight: 700;
    }

    textarea.memo-input {
      width: 100%;
      height: 100px;
      border: none;
      border-radius: 12px;
      background: var(--input-bg);
      color: var(--text-main);
      padding: 12px;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.5;
      resize: none;
      outline: none;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .memo-history-list {
      max-height: 150px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .memo-item {
      background: var(--input-bg);
      padding: 10px;
      border-radius: 10px;
      font-size: 13px;
      color: var(--text-main);
      border: 1px solid var(--card-border);
    }

    .memo-date {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
      font-weight: 700;
    }

    .panel-lock {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 24px;
      z-index: 10;
      color: var(--text-main);
      font-weight: 800;
      text-align: center;
      padding: 20px;
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 18px;
    }

    .price-card {
      padding: 24px;
      text-align: left;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      background: var(--card-bg);
      border-radius: 24px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
    }

    .price-card .plan {
      font-size: 13px;
      font-weight: 800;
      color: var(--text-muted);
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .price-card .amount {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 4px;
      letter-spacing: -1px;
      color: var(--text-main);
    }

    .price-card .desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 15px;
      min-height: 32px;
    }

    .price-card ul {
      margin-bottom: 15px;
      padding: 0;
      list-style: none;
    }

    .price-card li {
      display: flex;
      gap: 6px;
      font-size: 12px;
      margin-bottom: 6px;
      align-items: center;
      font-weight: 500;
      color: var(--text-main);
    }

    .price-card.pro {
      border: 2px solid var(--primary);
    }

    .price-card.ultra {
      border: 2px solid var(--accent);
    }

    .price-card.master {
      border: 2px solid #333;
      background: linear-gradient(135deg, #1e1e1e, #0f172a);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transform: scale(1.03);
      z-index: 2;
      position: relative;
    }

    .price-card.master .plan {
      color: #ffd700;
    }

    .price-card.master .desc {
      color: #94a3b8;
    }

    .price-card.master .amount,
    .price-card.master li {
      color: #fff;
    }

    .price-card.master .btn {
      background: #ffd700;
      color: #000;
      border: none;
      font-weight: 900;
    }

    .auth-card {
      max-width: 400px;
      margin: 0 auto;
      padding: 30px;
      text-align: center;
    }

    .btn {
      padding: 12px;
      border-radius: 12px;
      font-weight: 900;
      cursor: pointer;
      border: 1px solid var(--card-border);
      background: var(--panel-bg);
      color: var(--text-main);
      width: 100%;
      transition: 0.2s;
      box-shadow: var(--shadow);
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
    }

    input {
      width: 100%;
      padding: 14px;
      margin-bottom: 10px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: var(--input-bg);
      color: var(--text-main);
    }

    .tag-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      justify-content: center;
    }

    .theme-tag {
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid var(--card-border);
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-main);
    }

    .theme-tag.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .aura-effect {
      position: relative;
    }

    .aura-effect::before {
      content: '';
      position: absolute;
      top: -15px;
      left: -15px;
      right: -15px;
      bottom: -15px;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
      background-size: 400%;
      z-index: -1;
      filter: blur(25px);
      animation: glowing 20s linear infinite;
      opacity: 0.5;
    }

    .pet-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .pet-emoji {
      font-size: 80px;
      animation: bounce 2s infinite;
      filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.15));
    }

    .pet-bubble {
      background: var(--panel-bg);
      color: var(--text-main);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: bold;
      position: relative;
      margin-bottom: 10px;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: var(--shadow);
    }

    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(20, 1fr);
      gap: 4px;
      margin-top: 10px;
      justify-content: center;
    }

    .grass {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 3px;
      background: rgba(0, 0, 0, 0.08);
    }

    .grass.active {
      background: #22c55e;
    }

    .blob-cont {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      opacity: 0.6;
      filter: blur(60px);
      animation: float 10s infinite alternate;
    }

    .blob-1 {
      top: 10%;
      left: 10%;
      width: 300px;
      height: 300px;
      background: var(--secondary);
      animation-duration: 25s;
    }

    /* =========================
   HERO ë°°ê²½ Blob ë¶€ìœ  ì• ë‹ˆë©”ì´ì…˜ (PATCH A)
========================= */
    @keyframes hf-float-1 {
      0% {
        transform: translate3d(0, 0, 0) scale(1);
      }

      50% {
        transform: translate3d(0, -42px, 0) scale(1.06);
      }

      100% {
        transform: translate3d(0, 0, 0) scale(1);
      }
    }

    @keyframes hf-float-2 {
      0% {
        transform: translate3d(0, 0, 0) scale(1);
      }

      50% {
        transform: translate3d(0, 36px, 0) scale(1.04);
      }

      100% {
        transform: translate3d(0, 0, 0) scale(1);
      }
    }

    /* blob ìš”ì†Œê°€ ìˆì–´ì•¼ ì ìš©ë¨ */
    .blob-1,
    .blob-2 {
      will-change: transform, filter;
      transform-origin: center;
      filter: blur(80px);
    }

    /* ê°ê° ë‹¤ë¥¸ ì†ë„ë¡œ ë¶€ìœ  */
    .blob-1 {
      animation: hf-float-1 12s ease-in-out infinite;
    }

    .blob-2 {
      animation: hf-float-2 15s ease-in-out infinite;
    }

    /* ì›€ì§ì„ ì¤„ì´ê¸°(ì ‘ê·¼ì„±) */
    @media (prefers-reduced-motion: reduce) {

      .blob-1,
      .blob-2 {
        animation: none !important;
      }
    }


    .blob-2 {
      bottom: 20%;
      right: 10%;
      width: 350px;
      height: 350px;
      background: var(--primary);
      animation-duration: 30s;
    }

    .blob-3 {
      bottom: 10%;
      left: 30%;
      width: 250px;
      height: 250px;
      background: #ec4899;
      animation-duration: 22s;
    }

    @media (max-width: 900px) {

      .hero-grid,
      .pricing-grid,
      .problem-grid {
        grid-template-columns: 1fr;
      }

      /* âœ… ëŒ€ì‹œë³´ë“œëŠ” ì»¬ëŸ¼ìœ¼ë¡œ ì•ˆ ë‚´ë¦¼ (ì˜¤ë¥¸ìª½ ê¸°ëŠ¥ ìœ ì§€) */
      .dashboard-layout {
        flex-direction: row;
        align-items: flex-start;
      }

      .workout-side-panel,
      .right-stack {
        width: 340px;
        max-width: 340px;
      }
    }


    .admin-shell {
      grid-template-columns: 1fr;
    }

    .admin-left {
      display: none;
    }
    }

    /* Live ticker */
    .live-ticker {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      color: white;
      padding: 8px 0;
      z-index: 9000;
      overflow: hidden;
      white-space: nowrap;
      font-size: 13px;
      font-weight: 700;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .ticker-content {
      display: inline-block;
      animation: ticker 30s linear infinite;
      padding-left: 100%;
    }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-right: 40px;
    }

    /* Zen */
    .zen-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-color);
      z-index: 20000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      opacity: 0;
      transition: opacity 0.35s;
    }

    .zen-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      opacity: 0.3;
      animation: breathe 4s infinite ease-in-out;
      margin-bottom: 30px;
    }

    /* Broadcast */
    .broadcast-overlay {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(239, 68, 68, 0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 900;
      box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
      z-index: 30000;
      display: none;
      animation: slideDown 0.5s;
    }

    .broadcast-overlay.active {
      display: block;
    }

    /* Achievement */
    .achievement-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #ffd700, #f59e0b);
      color: #000;
      padding: 15px 20px;
      border-radius: 12px;
      font-weight: 800;
      box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
      z-index: 25000;
      display: none;
      align-items: center;
      gap: 10px;
      animation: slideInRight 0.5s;
    }

    /* Hearts */
    .cheer-heart {
      position: fixed;
      font-size: 24px;
      animation: floatUp 3s linear forwards;
      z-index: 9999;
      pointer-events: none;
    }

    /* Stickers */
    #stickerLayer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 5;
    }

    .sticker {
      position: absolute;
      font-size: 40px;
      cursor: grab;
      user-select: none;
      z-index: 50;
      transition: transform 0.1s;
      filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.15));
      pointer-events: auto;
    }

    .sticker:active {
      cursor: grabbing;
      transform: scale(1.1);
    }

    /* =========================
       ADMIN PANEL
    ========================= */
    #adminPanel {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      padding: 20px;
      animation: fadeIn 0.3s;
    }

    .admin-shell {
      width: 100%;
      max-width: 1400px;
      height: 90vh;
      margin: 0 auto;
      border-radius: 20px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 260px 1fr;
      background: #111;
      box-shadow: 0 0 100px rgba(99, 102, 241, 0.2);
      border: 1px solid #333;
    }

    .admin-left {
      padding: 20px;
      background: #000;
      border-right: 1px solid #333;
      display: flex;
      flex-direction: column;
    }

    .admin-right {
      padding: 30px;
      overflow-y: auto;
      background: #0a0a0a;
      color: #eee;
    }

    .admin-title {
      font-weight: 1000;
      font-size: 24px;
      color: #fff;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .admin-sub {
      color: #666;
      font-size: 11px;
      margin-bottom: 30px;
      letter-spacing: 1px;
      font-family: monospace;
    }

    .adminNavBtn {
      width: 100%;
      padding: 14px 16px;
      border-radius: 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 700;
      text-align: left;
      color: #888;
      margin-bottom: 5px;
      transition: 0.2s;
    }

    .adminNavBtn:hover {
      background: #222;
      color: #fff;
    }

    .adminNavBtn.active {
      background: linear-gradient(90deg, #6366f1, #4f46e5);
      color: #fff;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }

    .admin-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .admin-card {
      padding: 20px;
      border-radius: 12px;
      background: #1a1a1a;
      border: 1px solid #333;
    }

    .admin-card .k {
      color: #888;
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
    }

    .admin-card .v {
      font-size: 32px;
      font-weight: 1000;
      margin-top: 10px;
      color: #fff;
    }

    .admin-pane {
      display: none;
      animation: fadeIn 0.3s;
    }

    .admin-pane.active {
      display: block;
    }

    .admin-close-x {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      opacity: 0.6;
      transition: 0.2s;
      z-index: 20;
    }

    .admin-close-x:hover {
      opacity: 1;
      color: #ef4444;
    }

    .chart-container {
      display: flex;
      gap: 5px;
      height: 10px;
      width: 100%;
      margin-top: 10px;
      background: #222;
      border-radius: 5px;
      overflow: hidden;
    }

    .chart-bar {
      height: 100%;
      transition: width 0.5s;
    }

    .matrix-bg {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.08;
      z-index: 0;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiMwZjAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTIiIHRleHQtYW5jaG9yPSJtaWRkbGUiPjEwPC90ZXh0Pjwvc3ZnPg==');
    }

    .matrix-terminal {
      background: #000;
      color: #00ff41;
      padding: 20px;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      height: 250px;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.5;
      border: 1px solid #0f0;
      box-shadow: inset 0 0 30px rgba(0, 255, 0, 0.1);
      margin-top: 20px;
      position: relative;
      z-index: 1;
    }

    .log-line {
      margin-bottom: 4px;
      display: flex;
      gap: 10px;
    }

    .log-line span {
      opacity: 0.5;
    }

    /* ===== ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´ UI ì •ë¦¬ ===== */
    .routine-state {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .routine-state.hidden {
      display: none;
    }

    .today-card h3 {
      font-size: 20px;
      font-weight: 800;
    }

    .muted {
      color: #94a3b8;
      font-size: 14px;
    }

    .routine-badge {
      font-size: 18px;
      font-weight: 900;
    }

    .routine-desc {
      font-size: 14px;
      color: #475569;
    }

    /* ================================
   AI ì¶”ì²œ ì¹´ë“œ: í…Œë‘ë¦¬ UI + ì• ë‹ˆë©”ì´ì…˜
   ================================ */

    /* ì¹´ë“œ ì „ì²´ í…Œë‘ë¦¬(ê·¸ë¼ë°ì´ì…˜) */
    .ai-rec-box {
      position: relative;
      border-radius: 18px;
      padding: 14px;
      overflow: hidden;
      background: var(--panel-bg);
      border: 1px solid rgba(99, 102, 241, 0.18);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    /* ë°”ê¹¥ ê·¸ë¼ë°ì´ì…˜ í…Œë‘ë¦¬ ëŠë‚Œ (pseudo) */
    .ai-rec-box::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.55), rgba(168, 85, 247, 0.45), rgba(245, 158, 11, 0.35));
      filter: blur(10px);
      opacity: 0.35;
      z-index: 0;
    }

    /* ë‚´ë¶€ ì‹¤ì œ ì»¨í…ì¸  ë°•ìŠ¤ */
    .ai-rec-box::after {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: 17px;
      background: var(--panel-bg);
      z-index: 0;
    }

    .ai-rec-top,
    .ai-rec-main {
      position: relative;
      z-index: 1;
    }

    /* ìƒë‹¨ ë¼ë²¨ ë¼ì¸ */
    .ai-rec-top {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .ai-badge {
      font-size: 11px;
      font-weight: 900;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(99, 102, 241, 0.12);
      color: var(--primary);
      border: 1px solid rgba(99, 102, 241, 0.18);
    }

    .ai-small {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 700;
    }

    .ai-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: rgba(34, 197, 94, 0.9);
      box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.45);
      animation: aiPulse 1.6s ease-in-out infinite;
    }

    @keyframes aiPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.45);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(34, 197, 94, 0.0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.0);
      }
    }

    /* ë©”ì¸ í…ìŠ¤íŠ¸ */
    .ai-rec-title {
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: -0.3px;
      margin-bottom: 6px;
    }

    /* ë¬¸êµ¬ í˜ì´ë“œ ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ ë˜í¼ */
    .ai-rec-desc-wrap {
      position: relative;
      min-height: 22px;
      /* ë¬¸êµ¬ ë†’ì´ ê³ ì •í•´ì„œ ëœ í”ë“¤ë¦¬ê²Œ */
      overflow: hidden;
    }

    .ai-rec-desc {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
      transform: translateY(0);
      opacity: 1;
    }

    /* ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ */
    .ai-rec-desc.fade-out {
      animation: aiFadeOut 260ms ease forwards;
    }

    .ai-rec-desc.fade-in {
      animation: aiFadeIn 380ms ease forwards;
    }

    @keyframes aiFadeOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }

      to {
        opacity: 0;
        transform: translateY(8px);
      }
    }

    @keyframes aiFadeIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* í•˜ë‹¨ divider */
    .ai-rec-divider {
      margin: 12px 0 10px;
      height: 1px;
      width: 100%;
      background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.22), transparent);
    }

    .ai-rec-hint {
      font-size: 12px;
      color: var(--text-main);
      font-weight: 700;
      opacity: 0.85;
    }

    /* ë‹¤í¬ëª¨ë“œ ë³´ì • */
    body.dark-mode .ai-rec-box {
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
    }

    body.dark-mode .ai-rec-box::after {
      background: rgba(30, 41, 59, 0.85);
    }

    body.dark-mode .ai-rec-hint {
      color: #e2e8f0;
      opacity: 0.9;
    }

    /* âœ… WHY ëœë”© ì„¹ì…˜ */
    .why-section {
      padding: 70px 0 30px;
      position: relative;
    }

    .why-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 18px;
      text-align: center;
    }

    .why-pill {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .3px;
      background: rgba(99, 102, 241, .10);
      border: 1px solid rgba(99, 102, 241, .22);
      color: #3730a3;
      margin-bottom: 12px;
    }

    .why-title {
      margin: 0;
      font-size: clamp(26px, 4vw, 42px);
      line-height: 1.12;
      letter-spacing: -.4px;
    }

    .why-sub {
      margin: 12px auto 28px;
      max-width: 720px;
      color: rgba(15, 23, 42, .72);
      font-size: 15px;
      line-height: 1.6;
    }

    .why-grid {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      margin-top: 10px;
    }

    .why-card {
      background: rgba(255, 255, 255, .78);
      border: 1px solid rgba(255, 255, 255, .55);
      box-shadow: 0 18px 40px rgba(2, 6, 23, .08);
      border-radius: 18px;
      padding: 18px 18px 16px;
      text-align: left;
      backdrop-filter: blur(8px);
    }

    .why-ico {
      font-size: 20px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(99, 102, 241, .10);
      border: 1px solid rgba(99, 102, 241, .18);
      margin-bottom: 10px;
    }

    .why-h {
      font-weight: 900;
      color: #0f172a;
      margin-bottom: 6px;
      font-size: 16px;
    }

    .why-p {
      color: rgba(15, 23, 42, .70);
      font-size: 13px;
      line-height: 1.55;
    }

    @media (max-width: 900px) {
      .why-grid {
        grid-template-columns: 1fr;
      }

      .why-section {
        padding: 52px 0 18px;
      }
    }

    /* =========================
  TOPBAR (Promotional Header)
========================= */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 9999;
      backdrop-filter: blur(14px);
      background: rgba(255, 255, 255, 0.65);
      border-bottom: 1px solid rgba(255, 255, 255, 0.55);
    }

    .topbar-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      padding: 14px 0;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
    }

    .brand .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--primary);
      box-shadow: 0 0 18px rgba(99, 102, 241, 0.55);
    }

    .brand-name {
      font-size: 16px;
      letter-spacing: -0.01em;
    }

    .brand-tag {
      font-size: 11px;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.12);
      color: #059669;
      border: 1px solid rgba(16, 185, 129, 0.22);
    }

    .topnav {
      display: flex;
      gap: 16px;
      font-weight: 800;
      color: var(--text-muted);
    }

    .topnav a {
      text-decoration: none;
      color: var(--text-muted);
      padding: 8px 10px;
      border-radius: 999px;
    }

    .topnav a:hover {
      background: rgba(0, 0, 0, 0.04);
      color: var(--text-main);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.04);
      border: 1px solid var(--card-border);
      font-size: 12px;
      font-weight: 900;
      color: var(--text-main);
    }

    .live-bolt {
      filter: drop-shadow(0 0 12px rgba(251, 191, 36, 0.6));
    }

    @media (max-width: 900px) {
      .topnav {
        display: none;
      }
    }

    .hero-proof {
      margin-top: 16px;
    }

    .proof-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .proof-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.65);
      border: 1px solid var(--card-border);
      font-size: 12px;
      font-weight: 900;
    }

    .proof-quote {
      margin-top: 10px;
      color: var(--text-main);
      font-size: 13px;
      line-height: 1.6;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.03);
      border: 1px solid var(--card-border);
    }

    .proof-by {
      color: var(--text-muted);
      font-weight: 800;
      margin-left: 8px;
    }

    /* =========================
  BOTTOM LIVE TICKER (fixed)
========================= */
    .bottom-ticker {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9998;
      height: 44px;
      display: flex;
      align-items: center;
      overflow: hidden;
      backdrop-filter: blur(14px);
      background: rgba(255, 255, 255, 0.65);
      border-top: 1px solid rgba(255, 255, 255, 0.55);
    }

    .bottom-ticker .ticker-track {
      display: inline-flex;
      align-items: center;
      gap: 14px;
      white-space: nowrap;
      padding-left: 100%;
      will-change: transform;
      animation: ticker-move 18s linear infinite;
    }

    /* ê° ì•„ì´í…œ(appendTickerì—ì„œ ë§Œë“œëŠ” .ticker-item) */
    .bottom-ticker .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      background: rgba(0, 0, 0, 0.04);
      font-size: 12px;
      font-weight: 900;
      color: var(--text-main);
    }

    @keyframes ticker-move {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    /* âœ… ë§¨ ì•„ë˜ ë°” ë•Œë¬¸ì— ë‚´ìš© ê°€ë¦¬ì§€ ì•Šê²Œ ì—¬ë°± í™•ë³´ */
    body {
      padding-bottom: 56px;
    }

    /* âœ… í—¤ë” ë°°ê²½ì„ ê¹”ë”í•˜ê²Œ ê³ ì • */
    header,
    .navbar,
    .topbar {
      background: rgba(255, 255, 255, 0.82) !important;
      backdrop-filter: blur(16px) !important;
      -webkit-backdrop-filter: blur(16px) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.6) !important;
    }

    /* ===== Header Controls (NEW) ===== */
    .header-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .hbtn {
      height: 38px;
      padding: 0 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(10px);
      color: var(--text-main);
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
    }

    .hbtn:hover {
      transform: translateY(-1px);
    }

    .hbtn.primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      color: white;
    }

    .coin-pill {
      height: 38px;
      padding: 0 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(10px);
      font-weight: 900;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
    }

    /* ë‹¤í¬ëª¨ë“œ í—¤ë” ë²„íŠ¼ í†¤ */
    body.dark-mode .hbtn,
    body.dark-mode .coin-pill {
      background: rgba(17, 24, 39, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: #fff;
    }

    .top-strip {
      position: relative;
      z-index: 2;
      padding: 12px 0;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.6);
    }

    .strip-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 18px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .strip-item {
      font-size: 13px;
      font-weight: 700;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.7);
    }

    .strip-item.highlight {
      background: linear-gradient(135deg, #7c7cff, #b18cff);
      color: #fff;
    }

    .hero-reasons {
      display: flex;
      gap: 14px;
      margin-top: 28px;
    }

    .hero-reasons {
      margin-top: -40px;
      /* ìˆ«ì ì¡°ì ˆ */
    }


    .reason-card {
      flex: 1;
      padding: 16px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(12px);
      font-weight: 800;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
    }

    .reason-card span {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      font-weight: 600;
      color: #64748b;
    }

    /* =========================
   RIGHT CARD: LIVE PREVIEW
========================= */
    .today-card.live-preview {
      padding: 18px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(16px);
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
    }

    .lp-header {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 900;
      color: #16a34a;
      margin-bottom: 12px;
    }

    .lp-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      animation: pulse 1.6s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.6);
        opacity: .4;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .lp-body {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .lp-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      font-weight: 700;
    }

    .lp-label {
      color: #64748b;
    }

    .lp-value.reward {
      color: #6366f1;
      font-weight: 900;
    }

    .lp-action {
      margin-top: 10px;
      padding: 12px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      color: white;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.35);
    }

    .lp-footer {
      margin-top: 14px;
      font-size: 12px;
      color: #475569;
      text-align: center;
    }

    /* ê´€ë¦¬ì íŒ¨ë„ ì•¡ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .admin-act-btn {
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 700;
      border-radius: 6px;
      background: #333;
      border: 1px solid #555;
      color: #eee;
      cursor: pointer;
      transition: 0.2s;
    }

    .admin-act-btn:hover {
      background: #444;
      border-color: #777;
    }

    /* ê´€ë¦¬ì íŒ¨ë„ ì•¡ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .admin-act-btn {
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 700;
      border-radius: 6px;
      background: #333;
      border: 1px solid #555;
      color: #eee;
      cursor: pointer;
      transition: 0.2s;
    }

    .admin-act-btn:hover {
      background: #444;
      border-color: #777;
    }

    /* [ê°•ì œ ì ìš©] ê´€ë¦¬ì íŒ¨ë„ì˜ ëª¨ë“  ë²„íŠ¼ í´ë¦­ í—ˆìš© */
    #adminPanel button,
    #adminUserList button {
      pointer-events: auto !important;
      cursor: pointer !important;
      z-index: 999999 !important;
      position: relative !important;
    }

    /* ê´€ë¦¬ì íŒ¨ë„ì´ ë§¨ ìœ„ì— ì˜¤ë„ë¡ */
    #adminPanel {
      z-index: 20000 !important;
    }
  </style>
</head>

<body>
  <!-- âœ… TOP HEADER (í™ë³´ìš©) -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <span class="dot"></span>
        <span class="brand-name">HabitFlow</span>
        <span class="brand-tag">LIVE</span>
      </div>

      <nav class="topnav">
        <a href="#why">WHY</a>
        <a href="#pricing">ê°€ê²©</a>
        <a href="#authSection">ì‹œì‘í•˜ê¸°</a>
      </nav>
      <!-- âœ… HEADER RIGHT CONTROLS (ì—¬ê¸° ë¶™ì—¬ë„£ê¸°) -->
      <div class="header-controls">
        <button id="focusToggleBtn" class="hbtn">ğŸ§˜ Deep Focus</button>
        <button id="themeToggleBtn" class="hbtn">ğŸŒ™</button>
        <div id="coinPill" class="coin-pill">â­ <span id="coinCount">0</span></div>
      </div>

      <div class="topbar-right">
        <div id="liveBadge" class="live-badge" title="ì‹¤ì‹œê°„ í™œë™">
          <span class="live-bolt">âš¡</span>
          <span id="liveText">ì§€ê¸ˆ ì ‘ì† ì¤‘â€¦</span>
        </div>

        <button id="topStartBtn" class="btn btn-primary" style="width:auto; padding:10px 14px;">ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  </header>



  <!-- Zen overlay -->
  <div id="zenOverlay" class="zen-overlay">
    <div class="zen-circle"></div>
    <h2 style="font-weight:300; margin-bottom:10px;">Deep Focus</h2>
    <p style="color:var(--text-muted);">ì˜¤ì§ ë‚˜ì—ê²Œë§Œ ì§‘ì¤‘í•˜ì„¸ìš”.</p>
    <button class="btn" id="zenExitBtn" style="margin-top:30px;">ë‚˜ê°€ê¸°</button>
  </div>

  <!-- Broadcast -->
  <div id="broadcastOverlay" class="broadcast-overlay">
    ğŸ“¢ <span id="broadcastMsg">ê¸´ê¸‰ ê³µì§€ì‚¬í•­ì…ë‹ˆë‹¤.</span>
  </div>

  <!-- Achievement toast -->
  <div id="achievementToast" class="achievement-toast">
    <div style="font-size:24px;">ğŸ†</div>
    <div>
      <div style="font-size:10px; opacity:0.8;">ACHIEVEMENT UNLOCKED</div>
      <div id="achievementTitle">ì‘ì‹¬ì‚¼ì¼ íƒˆì¶œ!</div>
    </div>
  </div>

  <!-- blobs -->
  <div class="blob-cont">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <!-- stickers layer -->
  <div id="stickerLayer"></div>

  <!-- coin display -->
  <div id="coinDisplay"
    style="position: fixed; top: 20px; right: 20px; z-index: 500; background: var(--panel-bg); padding: 8px 12px; border-radius: 20px; font-weight: 800; font-size: 14px; display:none; border: 2px solid var(--accent); color: var(--text-main); box-shadow: var(--shadow);">
    <span>â­</span> <span id="coinCount">0</span>
  </div>

  <header>
    <div class="container header-inner">
      <div class="logo">
        <div class="logo-badge"></div>HabitFlow
      </div>
      <nav>
        <button class="btn" id="zenToggleBtn" style="padding: 8px 12px; width:auto;">ğŸ§˜</button>
        <button class="btn btn-primary" id="startNowBtn"
          style="padding: 8px 16px; font-size: 14px; width:auto;">ì‹œì‘í•˜ê¸°</button>
        <button id="darkModeToggle" class="btn" style="padding: 8px; width:auto;">ğŸŒ“</button>
      </nav>
    </div>
  </header>
  <section class="top-strip">
    <div class="strip-inner">
      <div class="strip-item">âš¡ í•˜ë£¨ 1ë¶„, ì‹¤íŒ¨ ì—†ëŠ” ìŠµê´€</div>
      <div class="strip-item">ğŸ”¥ í‰ê·  ì—°ì† ê¸°ë¡ 6.2ì¼</div>
      <div class="strip-item">â­ ì˜¤ëŠ˜ 312ëª…ì´ ìŠµê´€ì„ ì™„ë£Œí–ˆì–´ìš”</div>
      <div class="strip-item highlight">LIVE Â· ì§€ê¸ˆë„ ê¸°ë¡ ì¤‘</div>
    </div>
  </section>

  <section class="hero">
    <div class="container">
      <div class="hero-grid">
        <div class="hero-left">
          <span class="hero-pill">âœ¨ í•˜ë£¨ í•˜ë‚˜ë¡œ ì¶©ë¶„í•´ìš”</span>
          <h1 class="hero-title">í•˜ë£¨ í•˜ë‚˜,<br />ì¸ìƒì„ ë°”ê¾¸ëŠ” ìŠµê´€</h1>
          <p class="hero-desc">ì‘ì‹¬ì‚¼ì¼ì„ ëë‚´ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°©ì‹.<br>ë²„íŠ¼ í•œ ë²ˆìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ì—°ì† ê¸°ë¡ìœ¼ë¡œ ë™ê¸°ë¶€ì—¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”.</p>
          <div class="hero-actions">
            <button class="btn btn-primary" id="heroStartBtn" style="width:auto;">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
          </div>
          <div class="hero-metrics">
            <div class="metric-card"><b>1 Habit</b><span>í•˜ë£¨ ë”± í•˜ë‚˜</span></div>
            <div class="metric-card"><b>Streak</b><span>ì—°ì† ê¸°ë¡</span></div>
            <div class="metric-card"><b>Report</b><span>ì£¼ê°„ ë¦¬í¬íŠ¸</span></div>
          </div>
        </div>

        <div class="today-card live-preview" style="margin: 0; align-self: center;">
          <div class="lp-header">
            <span class="lp-dot"></span>
            <span class="lp-title">LIVE Â· HabitFlow</span>
          </div>
          <div class="lp-body">
            <div class="lp-row">
              <span class="lp-label">ì˜¤ëŠ˜ì˜ ë£¨í‹´</span>
              <span class="lp-value">ğŸ“– ë…ì„œ 2í˜ì´ì§€</span>
            </div>
            <div class="lp-row">
              <span class="lp-label">ì˜ˆìƒ ì†Œìš”</span>
              <span class="lp-value">â± 1ë¶„</span>
            </div>
            <div class="lp-row">
              <span class="lp-label">ë³´ìƒ</span>
              <span class="lp-value reward">+20 XP Â· +1 â­</span>
            </div>
            <button class="lp-action">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ</button>
          </div>
          <div class="lp-footer">ğŸ”¥ ì§€ê¸ˆ ì´ ìˆœê°„ì—ë„ ëˆ„êµ°ê°€ëŠ” ì™„ë£Œ ì¤‘</div>
        </div>
      </div>
      <div class="hero-reasons" style="margin-top: 60px; justify-content: center;">
        <div class="reason-card">
          ğŸ¯ <b>ëª©í‘œëŠ” 1ê°œ</b>
          <span>ê²°ì • í”¼ë¡œë¥¼ ì œê±°í•©ë‹ˆë‹¤</span>
        </div>
        <div class="reason-card">
          âš¡ <b>ë²„íŠ¼ í•œ ë²ˆ</b>
          <span>ê¸°ë¡ ë¶€ë‹´ 0</span>
        </div>
        <div class="reason-card">
          ğŸ” <b>ì—°ì† ë³´ìƒ</b>
          <span>ìŠµê´€ì´ ì¤‘ë…ì²˜ëŸ¼ ì´ì–´ì§‘ë‹ˆë‹¤</span>
        </div>
      </div>

      <div class="hero-proof" style="text-align: center; margin-top: 40px;">
        <div class="proof-badges" style="justify-content: center;">
          <span class="proof-pill">âš¡ ë²„íŠ¼ 1ë²ˆ</span>
          <span class="proof-pill">ğŸ”¥ ì—°ì†ê¸°ë¡</span>
          <span class="proof-pill">ğŸ ì½”ì¸ ë¦¬ì›Œë“œ</span>
        </div>
        <div class="proof-quote">
          â€œì‘ì‹¬ì‚¼ì¼ì´ ì•„ë‹ˆë¼, <b>ì‘ì€ ìŠ¹ë¦¬</b>ê°€ ìŒ“ì´ê²Œ í•´ì£¼ëŠ” ì•±.â€
          <span class="proof-by">â€” ì‚¬ìš©ì í›„ê¸°</span>
        </div>
      </div>

    </div>
  </section>
  <!-- âœ… WHY ëœë”© ì„¹ì…˜ (hero ì•„ë˜, ëŒ€ì‹œë³´ë“œ ìœ„) -->
  <section class="why-section" id="why">
    <div class="why-inner">
      <div class="why-pill">WHY</div>
      <h2 class="why-title">ì™œ ìŠµê´€ì€ í•­ìƒ ì‹¤íŒ¨í• ê¹Œ?</h2>
      <p class="why-sub">
        HabitFlowëŠ” <b>â€œë”± 1ê°œë§Œ, ë²„íŠ¼ 1ë²ˆâ€</b>ìœ¼ë¡œ ì‹¤í–‰ ì¥ë²½ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.
      </p>

      <div class="why-grid">
        <div class="why-card">
          <div class="why-ico">ğŸ¯</div>
          <div class="why-h">ëª©í‘œê°€ ë„ˆë¬´ ë§ë‹¤</div>
          <div class="why-p">ìš•ì‹¬ì´ ì»¤ì§ˆìˆ˜ë¡ ì‹œì‘ì´ ì–´ë ¤ì›Œì ¸ìš”. í•˜ë£¨ 1ê°œë§Œ ë‚¨ê¹ë‹ˆë‹¤.</div>
        </div>

        <div class="why-card">
          <div class="why-ico">ğŸ“</div>
          <div class="why-h">ê¸°ë¡ì´ ê·€ì°®ë‹¤</div>
          <div class="why-p">ê¸°ë¡ì´ ë²ˆê±°ë¡œìš°ë©´ í¬ê¸° í™•ë¥ ì´ ì˜¬ë¼ê°€ìš”. ë²„íŠ¼ í•œ ë²ˆì´ë©´ ë.</div>
        </div>

        <div class="why-card">
          <div class="why-ico">ğŸ“ˆ</div>
          <div class="why-h">ì„±ì·¨ê°€ ëˆˆì— ì•ˆ ë³´ì¸ë‹¤</div>
          <div class="why-p">ìŒ“ì´ëŠ” ëŠë‚Œì´ ì—†ìœ¼ë©´ ì§€ì†ì´ ì–´ë µì£ . ì—°ì† ê¸°ë¡ì„ ì¦‰ì‹œ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>
  </section>


  <section id="authSection" style="padding-top: 40px; min-height: 80vh;">
    <div class="container" style="display:flex; justify-content:center;">
      <div id="auth" class="auth-card glass">
        <h2>HabitFlow ì‹œì‘í•˜ê¸°</h2>
        <input id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
        <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
        <div class="auth-actions">
          <button id="signupBtn" class="btn btn-primary">íšŒì›ê°€ì…</button>
          <button id="signinBtn" class="btn">ë¡œê·¸ì¸</button>
        </div>
        <div style="margin-top:10px;">
          <button id="resetPwBtn" class="btn"
            style="background:transparent; box-shadow:none; border:none; text-decoration:underline; color:var(--text-muted);">ë¹„ë°€ë²ˆí˜¸
            ì°¾ê¸°</button>
        </div>
      </div>

      <div id="dashboardLayout" class="dashboard-layout">
        <div id="app" class="glass">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 id="welcome" style="margin:0; font-size: 1.2rem;"></h2>
            <button id="logoutBtn"
              style="background:none; border:none; color:var(--text-muted); font-size:0.8rem; text-decoration:underline; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
          </div>

          <div style="margin: 10px 0 10px;">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:5px;">
              <span id="levelBadge" style="font-weight:900; color:var(--primary); font-size:18px;">Lv.1</span>
              <span id="xpText" style="font-size:12px; color:var(--text-muted); font-weight:700;">0 / 100 XP</span>
            </div>
            <div
              style="background:rgba(0,0,0,0.08); border-radius:10px; height:10px; overflow:hidden; position:relative;">
              <div id="xpBar"
                style="background:linear-gradient(90deg, var(--primary), var(--secondary)); width:0%; height:100%; transition: width 0.6s; border-radius:10px;">
              </div>
            </div>
          </div>

          <div class="pet-container" id="petContainer">
            <div id="petBubble" class="pet-bubble">ì‘ì›í•©ë‹ˆë‹¤!</div>
            <div id="petEmoji" class="pet-emoji">ğŸ¥š</div>
          </div>

          <button id="globalCheerBtn" class="btn"
            style="background: #fff0f7; color: #ec4899; border: 1px solid #ec4899; width: 100%; margin-bottom: 15px;">
            ğŸ’– ëª¨ë‘ì—ê²Œ ì‘ì› ë³´ë‚´ê¸°
          </button>

          <div class="heatmap-container"
            style="margin: 15px 0; padding: 15px; border-radius: 16px; background: rgba(0,0,0,0.05); border: 1px solid var(--card-border);">
            <div
              style="font-size:12px; font-weight:700; color:var(--text-muted); display:flex; justify-content:space-between; margin-bottom: 5px;">
              <span>ğŸŒ¿ ìµœê·¼ 20ì¼</span><span>Log</span>
            </div>
            <div id="heatmapGrid" class="heatmap-grid"></div>
          </div>

          <div id="tierBadge" style="display:none; margin: 20px 0;">
            <p id="streakCount" style="font-size: 0.9rem; margin-top: 8px; font-weight:700;"></p>
          </div>

          <div id="themeSection" style="margin-top:24px;">
            <p style="font-size: 0.9rem; font-weight: 700; margin-bottom:10px;">ğŸ ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ©</p>
            <div class="tag-container">
              <button class="theme-tag" data-theme="survival">ğŸš‘ ìƒì¡´</button>
              <button class="theme-tag" data-theme="godsaeng">âœ¨ ê°“ìƒ</button>
              <button class="theme-tag" data-theme="detox">ğŸ“± ë””í†¡ìŠ¤</button>
              <button class="theme-tag" data-theme="custom">â• ì»¤ìŠ¤í…€</button>
            </div>
          </div>

          <div id="todaySuggestion"
            style="margin-top:16px; font-size:0.9rem; padding:12px; background:rgba(99,102,241,0.1); border-radius:12px; color:var(--text-main);">
            í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.
          </div>

          <input id="habitName" readonly value="í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”"
            style="margin-top: 20px; text-align: center; font-weight:700;">
          <div style="display:flex; gap:8px; margin-top:10px;">
            <button id="habitBtn" class="btn btn-primary">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ âœ…</button>
            <button id="timerBtn" class="btn"
              style="width:60px; background:#333; color:white; display:none;">â±ï¸</button>
          </div>
          <p id="status"
            style="margin-top:12px; font-size:14px; color:var(--primary); font-weight:700; min-height:20px;"></p>

          <div id="stats"
            style="display:none; margin-top:20px; padding:16px; background:rgba(0,0,0,0.05); border-radius:12px;">
            <h3 style="margin:0 0 10px; font-size:16px;">ğŸ“Š í†µê³„</h3>
            <p id="totalDays" style="margin:0; font-weight:700;"></p>
          </div>
        </div>

        <div class="right-stack">
          <div id="workoutSidePanel" class="workout-side-panel">
            <span class="master-badge-corner">MASTER</span>
            <div class="w-title">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì±Œë¦°ì§€</div>
            <div class="workout-tabs">
              <!-- âœ… inline onclick ì œê±°í•˜ê³  JSì—ì„œ ì•ˆì „í•˜ê²Œ ë°”ì¸ë”© -->
              <button class="w-tab active" data-type="walk">ğŸš¶ ê±·ê¸°</button>
              <button class="w-tab" data-type="run">ğŸƒ ë‹¬ë¦¬ê¸°</button>
              <button class="w-tab" data-type="gym">ğŸ‹ï¸ í—¬ìŠ¤</button>
            </div>
            <div class="workout-display">
              <div id="workoutResult" class="wd-main">â“</div>
              <div class="wd-sub">ì¢…ëª© ì„ íƒ í›„ ë¯¸ì…˜ ë½‘ê¸°!</div>
            </div>
            <button id="startWorkoutBtn" class="btn"
              style="background:var(--accent); color:#000; border:none; font-weight:900; box-shadow:0 4px 15px rgba(251,191,36,0.4);">ğŸ°
              ë¯¸ì…˜ ëœë¤ ë½‘ê¸°</button>
            <button id="completeWorkoutBtn" class="btn"
              style="background:linear-gradient(to right, #22c55e, #16a34a); color:#fff; border:none; display:none;">âœ…
              ì™„ë£Œ (ì½”ì¸ 3ë°°)</button>
          </div>

          <div id="memoPanel" class="glass memo-panel" style="display:none;">
            <div class="memo-header">
              <div class="memo-title">ğŸ“ ì˜¤ëŠ˜ì˜ ë©”ëª¨</div>
              <span class="memo-badge">PRO+</span>
            </div>
            <div id="memoLocked" class="panel-lock">
              <div style="font-size:30px; margin-bottom:10px;">ğŸ”’</div>
              <div>PRO ë“±ê¸‰ë¶€í„° ì‚¬ìš© ê°€ëŠ¥</div>
              <button class="btn btn-primary" id="memoUnlockBtn"
                style="margin-top:15px; width:auto; padding:8px 16px; font-size:12px;">ì ê¸ˆ í•´ì œ</button>
            </div>
            <textarea id="dailyMemo" class="memo-input" placeholder="ì˜¤ëŠ˜ì˜ ë‹¤ì§ì´ë‚˜ í•  ì¼ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea>
            <button id="saveMemoBtn" class="btn btn-primary" style="margin-top:10px;">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          </div>

          <div id="memoHistoryPanel" class="glass memo-panel" style="display:none;">
            <div class="memo-header">
              <div class="memo-title">ğŸ“‚ ì§€ë‚œ ë©”ëª¨ ê¸°ë¡</div>
            </div>
            <div id="memoHistoryList" class="memo-history-list">
              <div style="text-align:center; padding:10px; color:var(--text-muted); font-size:13px;">ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>
      </div><!-- /dashboardLayout -->
    </div>
  </section>

  <section id="pricing">
    <div class="container">
      <div style="text-align:center; margin-bottom:36px;">
        <span
          style="display:inline-block; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 800; background: rgba(99, 102, 241, 0.15); color: var(--primary);">PRICING</span>
        <h2 style="margin: 12px 0 8px;">ê°€ê²©</h2>
        <p style="color:var(--text-muted);">ë‹¹ì‹ ì˜ ì„±ì¥ì„ ê°€ì†í™”í•  ìµœì ì˜ í”Œëœì„ ì„ íƒí•˜ì„¸ìš”.</p>
      </div>

      <div class="pricing-grid">
        <div class="price-card glass">
          <div>
            <div class="plan">ë¬´ë£Œ</div>
            <div class="amount">â‚©0</div>
            <div class="desc">ê°€ë³ê²Œ ì‹œì‘í•˜ëŠ” ì…ë¬¸ììš©</div>
            <ul>
              <li>âœ… í•˜ë£¨ 1ìŠµê´€ ê¸°ë¡</li>
              <li>âœ… ê¸°ë³¸ í…Œë§ˆ ì¶”ì²œ</li>
            </ul>
          </div>
        </div>

        <div class="price-card glass pro">
          <div>
            <div class="plan" style="color:var(--primary);">PRO</div>
            <div class="amount">â‚©3,900</div>
            <div class="desc">ìŠµê´€ íŒ¨í„´ì„ ì¡ê³  ì‹¶ì€ ë¶„</div>
            <ul>
              <li>âœ¨ ìŠµê´€ ë¬´ì œí•œ + ì»¤ìŠ¤í…€</li>
              <li>âœ¨ ì£¼ê°„ AI ë¶„ì„ ë¦¬í¬íŠ¸</li>
              <li>âœ¨ ìº˜ë¦°ë” ë·° / ë³µêµ¬ê¶Œ</li>
              <li>ğŸ“ <b>ì˜¤ëŠ˜ì˜ ë©”ëª¨ & íˆìŠ¤í† ë¦¬</b></li>
            </ul>
          </div>
          <button class="btn btn-primary" id="proUpgradeBtn">PRO ì—…ê·¸ë ˆì´ë“œ</button>
        </div>

        <div class="price-card glass ultra">
          <div>
            <div class="plan" style="color:var(--accent);">ULTRA</div>
            <div class="amount">â‚©5,900</div>
            <div class="desc">ë‚˜ë§Œì˜ ê°ì„±ìœ¼ë¡œ ê¾¸ë¯¸ê¸°</div>
            <ul>
              <li>ğŸŒˆ ì•± ì»¬ëŸ¬ í…Œë§ˆ ë³€ê²½</li>
              <li>ğŸµ BGM ì„ ê³¡ê¶Œ</li>
              <li>ğŸ’° ì½”ì¸ íšë“ 2ë°°</li>
              <li>ğŸ‘‘ PRO ê¸°ëŠ¥ ëª¨ë‘ í¬í•¨</li>
            </ul>
          </div>
          <button class="btn btn-primary" id="ultraUpgradeBtn"
            style="background:linear-gradient(135deg, #f59e0b, #d97706);">ULTRA ì—…ê·¸ë ˆì´ë“œ</button>
        </div>

        <div class="price-card glass master">
          <div>
            <div class="plan">MASTER</div>
            <div class="amount">â‚©7,900</div>
            <div class="desc">ê·¹í•œì˜ ì„±ì¥ì„ ìœ„í•œ ì™„ì „ì²´</div>
            <ul>
              <li>ğŸ’ª <b>ë§¤ì¼ ìš´ë™ ì±Œë¦°ì§€ íŒ¨ë„</b></li>
              <li>â±ï¸ í¬ëª¨ë„ë¡œ ì§‘ì¤‘ íƒ€ì´ë¨¸</li>
              <li>âœ¨ ë§ˆìŠ¤í„° ì „ìš© ì˜¤ë¼</li>
              <li>ğŸ’° ì½”ì¸ íšë“ 3ë°°</li>
            </ul>
          </div>
          <button class="btn" id="masterUpgradeBtn">MASTER ì—…ê·¸ë ˆì´ë“œ</button>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="text-align:center; padding-bottom:40px; color:var(--text-muted); font-size:14px;">
      <p>Â© 2026 HabitFlow. All rights reserved.</p>
    </div>
  </footer>

  <!-- Floating buttons -->
  <button id="trashModeBtn"
    style="display:none; position:fixed; bottom:50px; right:140px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ—‘ï¸</button>
  <button id="shopOpenBtn"
    style="display:none; position:fixed; bottom:50px; right:80px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#8b5cf6; color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ</button>
  <button id="rankOpenBtn"
    style="display:none; position:fixed; bottom:50px; right:20px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:24px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ†</button>
  <button id="adminOpenBtn"
    style="display:none; position:fixed; bottom:50px; left:20px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#000; color:#0f0; border:2px solid #0f0; font-size:24px; cursor:pointer; box-shadow:0 0 20px #0f0;">ğŸ˜</button>

  <!-- Shop panel -->
  <div id="shopPanel" class="glass"
    style="display:none; position:fixed; bottom:110px; right:20px; width:300px; padding:20px; z-index:10000; border:2px solid #8b5cf6; background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
      <h3 style="margin:0; color:#7c3aed;">ğŸ ìƒì </h3>
      <button class="btn" id="shopCloseBtn" style="width:auto; padding:8px 10px;">âœ–</button>
    </div>
    <div style="text-align:center; margin-bottom:20px;">
      <div style="font-size:60px;">ğŸ”®</div>
      <button id="gachaBtn" class="btn btn-primary" style="margin-top:10px;">1ì½”ì¸ ë½‘ê¸°! (ë³´ìœ : <span
          id="shopCoinCount">0</span>)</button>
    </div>
    <div style="font-size:12px; font-weight:bold; margin-bottom:5px;">ğŸ’ ë‚´ ìŠ¤í‹°ì»¤</div>
    <div id="inventoryList"
      style="height:150px; overflow-y:auto; background:var(--input-bg); padding:10px; border-radius:8px; display:grid; grid-template-columns:repeat(4,1fr); gap:10px;">
    </div>
  </div>

  <!-- Rank panel -->
  <div id="rankPanel" class="glass"
    style="display:none; position:fixed; bottom:110px; right:20px; width:340px; padding:20px; z-index:10000; border:2px solid var(--accent); background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
      <h3 style="margin:0; color:var(--accent);">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h3>
      <button class="btn" id="rankCloseBtn" style="width:auto; padding:8px 10px;">âœ–</button>
    </div>
    <div id="rankList"
      style="height:300px; overflow-y:auto; background:var(--input-bg); padding:10px; border-radius:8px;"></div>
  </div>

  <!-- Pro modal -->
  <div id="proModal"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001; backdrop-filter:blur(5px);">
    <div class="glass" style="padding:40px; max-width:360px; width:90%; text-align:center; background:var(--panel-bg);">
      <h2 style="margin-top:0;" id="modalTitle">ğŸ‘‘ ì—…ê·¸ë ˆì´ë“œ</h2>
      <p style="color:var(--text-muted); margin-bottom:20px;">ë” ê°•ë ¥í•œ ê¸°ëŠ¥ìœ¼ë¡œ ì„±ì¥í•˜ì„¸ìš”.</p>
      <button class="btn btn-primary" id="modalPayBtn">ì‹œì‘í•˜ê¸°</button>
      <p style="margin-top:16px; font-size:13px; cursor:pointer; color:var(--text-muted);" id="modalCloseBtn">ë‹«ê¸°</p>
    </div>
  </div>

  <!-- Admin panel -->
  <div id="adminPanel">
    <div class="matrix-bg"></div>
    <button class="admin-close-x" id="adminCloseBtn">âœ–</button>

    <div class="admin-shell">
      <div class="admin-left">
        <div class="admin-title">ğŸ‘‘ GOD MODE</div>
        <div class="admin-sub" id="adminSubtitle">SYSTEM ACCESS GRANTED</div>

        <div class="admin-nav">
          <button class="adminNavBtn active" data-pane="pane-dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
          <button class="adminNavBtn" data-pane="pane-users">ğŸ‘¥ ìœ ì € ê´€ë¦¬</button>
          <button class="adminNavBtn" data-pane="pane-tools">ğŸ› ï¸ ì‹ ì˜ ê¶ŒëŠ¥</button>
        </div>

        <div style="margin-top:auto; color:#666; font-size:11px;">
          SECURE CONNECTION ESTABLISHED<br>v3.0.0 HARDENED
        </div>
      </div>

      <div class="admin-right">
        <div id="pane-dashboard" class="admin-pane active">
          <h2 style="color:#fff; margin-top:0;">ì‹œìŠ¤í…œ í˜„í™©</h2>
          <div class="admin-cards">
            <div class="admin-card">
              <div class="k">TOTAL USERS</div>
              <div class="v" id="dashTotal">0</div>
            </div>
            <div class="admin-card">
              <div class="k">PRO MEMBERS</div>
              <div class="v" id="dashPro">0</div>
            </div>
            <div class="admin-card">
              <div class="k">ACTIVE (7D)</div>
              <div class="v" id="dashActive">0</div>
            </div>
          </div>

          <h4 style="color:#aaa; margin-bottom:5px;">USER TIER DISTRIBUTION</h4>
          <div class="chart-container" id="tierChart"></div>

          <h3 style="color:#0f0; margin-top:30px;">ğŸ“Ÿ THE MATRIX LOG</h3>
          <div id="matrixLog" class="matrix-terminal">
            <div class="log-line"><span>[SYSTEM]</span> Booting admin console...</div>
          </div>
        </div>

        <div id="pane-users" class="admin-pane">
          <h2 style="color:#fff; margin-top:0;">ìœ ì € ê´€ë¦¬</h2>
          <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input id="adminSearch" placeholder="ì´ë©”ì¼ ê²€ìƒ‰..."
              style="flex:1; background:#222; border:1px solid #444; color:#fff;">
            <button id="refreshAdminBtn" class="btn"
              style="background:#333; color:#fff; border:1px solid #555; width: auto;">ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div id="adminUserList" style="display:grid; gap:10px;"></div>
        </div>

        <div id="pane-tools" class="admin-pane">
          <h2 style="color:#fff; margin-top:0;">ì‹ ì˜ ê¶ŒëŠ¥ (God Tools)</h2>

          <div class="admin-cards" style="grid-template-columns: 1fr 1fr;">
            <div class="admin-card">
              <div class="k">ğŸ’° MASS GIFT</div>
              <p style="color:#888; font-size:12px; margin-bottom:15px;">ëª¨ë“  ìœ ì €ì—ê²Œ 100 ì½”ì¸ì„ ì„ ë¬¼í•©ë‹ˆë‹¤.</p>
              <button id="godGiftBtn" class="btn"
                style="width:100%; background:#ffd700; color:#000; border:none; font-weight:900;">ì „ì²´ ì½”ì¸ ë°œì†¡</button>
            </div>

            <div class="admin-card">
              <div class="k">ğŸ“¢ EMERGENCY BROADCAST</div>
              <p style="color:#888; font-size:12px; margin-bottom:10px;">ëª¨ë“  ìœ ì € í™”ë©´ì— ê¸´ê¸‰ ê³µì§€ë¥¼ ë„ì›ë‹ˆë‹¤.</p>
              <div style="display:flex; gap:5px;">
                <input id="broadcastInput" placeholder="ê³µì§€ ë‚´ìš© ì…ë ¥"
                  style="background:#222; border:1px solid #444; color:#fff; width:100%;">
                <button id="godBroadcastBtn" class="btn"
                  style="background:#ef4444; color:#fff; border:none; width:auto;">ì „ì†¡</button>
              </div>
            </div>
          </div>

          <button id="adminExitBtn" class="btn"
            style="margin-top:30px; background:transparent; color:#ef4444; border:1px solid #ef4444; width:100%;">GOD
            MODE ì¢…ë£Œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
    SCRIPT (MODULE) - PART 1 ì‹œì‘
  ========================= -->
  <script type="module">
    /* =========================
       0) Imports
    ========================= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      onAuthStateChanged,
      signOut,
      sendPasswordResetEmail,
      sendEmailVerification
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    import {
      getFirestore,
      doc, setDoc, getDoc, updateDoc,
      collection, getDocs, addDoc,
      query, orderBy, limit,
      onSnapshot, arrayUnion,
      serverTimestamp,
      runTransaction,
      increment,
      writeBatch
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    /* =========================
       1) Firebase Config
    ========================= */
    const firebaseConfig = {
      apiKey: "AIzaSyAIaroNs2VsMamnnNJV1cP9LdXqIDhl3Ig",
      authDomain: "giiiddd-36340523-3f595.firebaseapp.com",
      projectId: "giiiddd-36340523-3f595",
      storageBucket: "giiiddd-36340523-3f595.firebasestorage.app",
      messagingSenderId: "698901018936",
      appId: "1:698901018936:web:2fb12a7a03cbd844c1e9cd"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* =========================
       2) Admin Settings
    ========================= */
    const ADMIN_EMAILS = ["test@gmail.com"];

    /* =========================
       3) Safe Helpers
    ========================= */
    const $ = (id) => document.getElementById(id);

    function isAdminUser(user) {
      return !!user?.email && ADMIN_EMAILS.includes(user.email);
    }

    function nowDateKey() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }

    function dateKeyFromOffset(n) {
      const d = new Date();
      d.setDate(d.getDate() - n);
      return d.toISOString().slice(0, 10);
    }

    function toastAchievement(title) {
      const box = $("achievementToast");
      const t = $("achievementTitle");
      if (!box || !t) return;
      t.textContent = title;
      box.style.display = "flex";
      setTimeout(() => { box.style.display = "none"; }, 3500);
    }

    function safeConfetti(p = 120) {
      try { confetti({ particleCount: p, spread: 70, origin: { y: 0.65 } }); } catch (_) { }
    }

    function appendTicker(msg) {
      const track = $("tickerContent");
      if (!track) return;
      const item = document.createElement("div");
      item.className = "ticker-item";
      item.textContent = `âš¡ ${msg}`;
      track.appendChild(item);

      const items = track.querySelectorAll(".ticker-item");
      if (items.length > 30) items[0]?.remove();

      const lt = document.getElementById("liveText");
      if (lt) lt.textContent = msg;
    }

    function showProModal(type) {
      $("modalTitle").textContent = `ğŸ‘‘ ${type} ì—…ê·¸ë ˆì´ë“œ`;
      $("proModal").style.display = "flex";
    }

    function closeProModal() {
      $("proModal").style.display = "none";
    }

    function toggleZenMode(force = null) {
      const zen = $("zenOverlay");
      if (!zen) return;
      const isOpen = zen.style.display === "flex";
      const next = (force === null) ? !isOpen : force;

      if (next) {
        zen.style.display = "flex";
        requestAnimationFrame(() => { zen.style.opacity = "1"; });
      } else {
        zen.style.opacity = "0";
        setTimeout(() => { zen.style.display = "none"; }, 250);
      }
    }

    function setThemeActive(theme) {
      document.querySelectorAll(".theme-tag").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.theme === theme);
      });
    }

    const sfx = {
      click: new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=click-124467.mp3"),
      success: new Audio("https://cdn.pixabay.com/download/audio/2021/08/04/audio_bb630cc098.mp3?filename=success-1-6297.mp3"),
      admin: new Audio("https://cdn.pixabay.com/download/audio/2022/03/24/audio_03e0545939.mp3?filename=sci-fi-click-903.mp3"),
      play(name) { try { const a = this[name]; if (!a) return; a.currentTime = 0; a.play(); } catch (_) { } }
    };

    /* =========================
       4) Data Pools & Helpers
    ========================= */
    const STICKERS = ["ğŸ", "ğŸ’Š", "ğŸ“š", "ğŸ¸", "ğŸ’", "ğŸ‘‘", "ğŸš€", "ğŸ¦„", "ğŸ¦–", "ğŸ•", "ğŸŒˆ", "ğŸ”¥", "ğŸ’§", "â­", "ğŸ€", "ğŸ„"];
    const themeData = {
      survival: ["ğŸ›Œ ë°¤ 11ì‹œ í° ë„ê¸°", "ğŸ’§ ê³µë³µ ë¬¼ í•œ ì”", "ğŸ’Š ì˜ì–‘ì œ ì±™ê²¨ë¨¹ê¸°", "ğŸ¢ ê±°ë¶ëª© ìŠ¤íŠ¸ë ˆì¹­"],
      godsaeng: ["ğŸ“… ì£¼ê°„ ê³„íš", "ğŸ›ï¸ ì´ë¶ˆ ì •ë¦¬", "ğŸ’° ê°€ê³„ë¶€", "ğŸ“š ë…ì„œ 2p"],
      detox: ["ğŸ“ ì†ê¸°ë¡", "ğŸ“µ ê¸°ìƒí›„ ë…¸í°", "ğŸ½ï¸ ë°¥ë¨¹ì„ë•Œ í°X", "ğŸ§ ì´ì–´í° ë¹¼ê¸°"],
      custom: []
    };

    function chooseSuggestion(theme) {
      if (!theme) return "í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.";
      if (theme === "custom") return "ì»¤ìŠ¤í…€ì€ ì…ë ¥í•œ ë£¨í‹´ìœ¼ë¡œ ì§„í–‰ë¼ìš”.";
      const arr = themeData[theme] || [];
      if (!arr.length) return "ì¶”ì²œ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤.";
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function calcLevelFromXp(xp) {
      let level = 1, need = 100, remaining = xp;
      while (remaining >= need) {
        remaining -= need;
        level += 1;
        need = Math.floor(need * 1.2);
        if (level > 99) break;
      }
      return { level, remain: remaining, need };
    }

    function setXpUI(xp) {
      const { level, remain, need } = calcLevelFromXp(xp);
      $("levelBadge").textContent = `Lv.${level}`;
      $("xpText").textContent = `${remain} / ${need} XP`;
      const pct = Math.max(0, Math.min(100, Math.round((remain / need) * 100)));
      $("xpBar").style.width = `${pct}%`;
      return level;
    }

    function setCoinsUI(coins) {
      $("coinCount").textContent = String(coins || 0);
      if ($("shopCoinCount")) $("shopCoinCount").textContent = String(coins || 0);
    }

    function setPetByLevel(level) {
      const pet = $("petEmoji");
      if (!pet) return;
      if (level >= 30) pet.textContent = "ğŸ‰";
      else if (level >= 20) pet.textContent = "ğŸ¦„";
      else if (level >= 12) pet.textContent = "ğŸ£";
      else if (level >= 6) pet.textContent = "ğŸ¤";
      else pet.textContent = "ğŸ¥š";
    }

    function petSay(msg) {
      const bubble = $("petBubble");
      if (!bubble) return;
      bubble.textContent = msg;
      bubble.style.opacity = "1";
      setTimeout(() => bubble.style.opacity = "0", 2000);
    }

    /* =========================
       5) Firestore Core Refs
    ========================= */
    function userRef(uid) { return doc(db, "users", uid); }
    function userLogRef(uid, dateKey) { return doc(db, "users", uid, "logs", dateKey); }
    function userMemoRef(uid, dateKey) { return doc(db, "users", uid, "memos", dateKey); }
    function systemBroadcastRef() { return doc(db, "system", "broadcast"); }

    async function ensureUserDoc(user) {
      const ref = userRef(user.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, {
          email: user.email || "",
          createdAt: serverTimestamp(),
          tier: "FREE",
          xp: 0, level: 1, coins: 0, streak: 0, totalDays: 0,
          lastCompletedDate: "",
          lastActiveAt: serverTimestamp(),
          theme: "", inventory: [], placedStickers: []
        }, { merge: true });
      } else {
        await updateDoc(ref, { lastActiveAt: serverTimestamp() }).catch(() => { });
      }
    }

    /* =========================
       6) Core UI Functions
    ========================= */
    function showDashboard(show) {
      $("auth").style.display = show ? "none" : "block";
      $("dashboardLayout").style.display = show ? "flex" : "none";
      $("coinDisplay").style.display = show ? "block" : "none";
      $("trashModeBtn").style.display = show ? "block" : "none";
      $("shopOpenBtn").style.display = show ? "block" : "none";
      $("rankOpenBtn").style.display = show ? "block" : "none";
    }

    function setTierUI(tier) {
      const t = tier || "FREE";
      const memoOk = ["PRO", "ULTRA", "MASTER"].includes(t);
      if ($("memoPanel")) $("memoPanel").style.display = memoOk ? "flex" : "none";
      if ($("memoHistoryPanel")) $("memoHistoryPanel").style.display = memoOk ? "flex" : "none";
      if ($("memoLocked")) $("memoLocked").style.display = memoOk ? "none" : "flex";

      const isMaster = (t === "MASTER");
      if ($("workoutSidePanel")) $("workoutSidePanel").style.display = isMaster ? "block" : "none";
      if ($("timerBtn")) $("timerBtn").style.display = isMaster ? "block" : "none";

      const appEl = $("app");
      if (appEl) appEl.classList.toggle("aura-effect", isMaster);

      const tb = $("tierBadge");
      if (tb) {
        tb.style.display = "block";
        tb.innerHTML = `<div style="font-weight:900;">ë“±ê¸‰: <span style="color:var(--primary)">${t}</span></div>`;
      }
    }

    /* =========================
       7) Admin Panel (SAFE MODE)
    ========================= */
    function logAdmin(msg) {
      const box = $("matrixLog");
      if (!box) return;
      const line = document.createElement("div");
      line.className = "log-line";
      line.innerHTML = `<span>[System]</span><div>${msg}</div>`;
      box.appendChild(line);
      box.scrollTop = box.scrollHeight;
    }

    function openAdmin() {
      sfx.play("admin");
      $("adminPanel").style.display = "block";
      logAdmin("ADMIN CONSOLE OPENED");
    }
    function closeAdmin() {
      $("adminPanel").style.display = "none";
    }

    function getTierColor(tier) {
      if (tier === 'MASTER') return '#ffd700';
      if (tier === 'ULTRA') return '#f59e0b';
      if (tier === 'PRO') return '#6366f1';
      return '#fff';
    }

    // [ì¤‘ìš”] ê´€ë¦¬ì ìœ ì € ë¡œë“œ (ì•ˆì „ ë²„ì „)
    // [ìˆ˜ì •] IDë¥¼ 'adminUserList'ë¡œ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•¨
    /* =========================
       [ìµœì¢… ìˆ˜ì •] ê´€ë¦¬ì ìœ ì € ë¦¬ìŠ¤íŠ¸ (ID ë¶ˆì¼ì¹˜ í•´ê²° ë²„ì „)
       - HTMLì˜ id="admUserList"ë¥¼ ì •í™•íˆ ì°¾ë„ë¡ ìˆ˜ì •í•¨
    ========================= */
    /* =========================
       [ì§„ë‹¨ ëª¨ë“œ] ê´€ë¦¬ì ìœ ì € ë¦¬ìŠ¤íŠ¸
       - ë‹¨ê³„ë³„ë¡œ ì•Œë¦¼ì°½(Alert)ì„ ë„ì›Œ ì–´ë””ê°€ ë¬¸ì œì¸ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.
    ========================= */
    async function adminLoadUsers(filterEmail = "") {
      console.log("adminLoadUsers ì‹¤í–‰ë¨"); // ì½˜ì†” í™•ì¸ìš©

      const box = document.getElementById("adminUserList");
      if (!box) {
        alert("âŒ ì‹¬ê°í•œ ì˜¤ë¥˜: HTMLì—ì„œ 'adminUserList'ë¥¼ ëª» ì°¾ì•˜ìŠµë‹ˆë‹¤. ì˜¤íƒ€ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        return;
      }

      box.innerHTML = `<div style="padding:20px; text-align:center; color:#888;">ë°ì´í„° ë¡œë”© ì¤‘...</div>`;

      try {
        const snaps = await getDocs(collection(db, "users"));
        const rows = [];
        snaps.forEach(s => {
          const d = s.data();
          if (filterEmail && !(d.email || "").includes(filterEmail)) return;
          rows.push({ id: s.id, ...d });
        });

        box.innerHTML = ""; // ì´ˆê¸°í™”

        if (!rows.length) {
          box.innerHTML = `<div style="padding:20px; text-align:center; color:#888;">ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
          return;
        }

        // ìœ ì € ì¹´ë“œ ìƒì„±
        rows.slice(0, 100).forEach(u => {
          const card = document.createElement("div");
          card.className = "admin-card";
          card.style.padding = "12px";
          card.style.marginBottom = "8px";
          card.style.background = "rgba(255,255,255,0.05)";
          card.style.border = "1px solid #444";
          card.style.borderRadius = "8px";
          card.style.display = "flex";
          card.style.justifyContent = "space-between";
          card.style.alignItems = "center";

          // ì¤‘ìš”: í´ë¦­ ê°•ì œ í—ˆìš© ìŠ¤íƒ€ì¼
          card.style.pointerEvents = "auto";
          card.style.zIndex = "99999";

          const isBanned = u.isBanned === true;
          if (isBanned) {
            card.style.border = "1px solid #ef4444";
            card.style.background = "rgba(239, 68, 68, 0.1)";
          }

          // í…ìŠ¤íŠ¸ ì˜ì—­
          const infoDiv = document.createElement("div");
          infoDiv.innerHTML = `
            <div style="font-weight:900; color:#fff; pointer-events:none;">
              ${(u.email || "unknown").replace(/</g, "&lt;")}
              ${isBanned ? '<span style="color:#ef4444; margin-left:5px;">(ì°¨ë‹¨ë¨)</span>' : ''}
            </div>
            <div style="color:#aaa; font-size:12px; margin-top:4px; pointer-events:none;">
              ì½”ì¸: <b style="color:#ffd700">${u.coins || 0}</b>
            </div>
          `;

          // ë²„íŠ¼ ì˜ì—­
          const btnGroup = document.createElement("div");
          btnGroup.style.display = "flex";
          btnGroup.style.gap = "6px";

          // [ë²„íŠ¼ 1] ì½”ì¸
          const btnCoin = document.createElement("button");
          btnCoin.textContent = "ğŸ’° ì½”ì¸";
          btnCoin.style.padding = "6px 10px";
          btnCoin.style.cursor = "pointer";
          btnCoin.style.background = "#333";
          btnCoin.style.color = "white";
          btnCoin.style.border = "1px solid #555";

          // âœ… í´ë¦­ ì´ë²¤íŠ¸ (ì§„ë‹¨ìš©)
          btnCoin.onclick = async (e) => {
            e.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
            alert(`[í´ë¦­ í™•ì¸] ${u.email}ë‹˜ì˜ ì½”ì¸ ë²„íŠ¼ì´ ëˆŒë ¸ìŠµë‹ˆë‹¤!`);

            const amountStr = prompt("ë³€ê²½í•  ì½”ì¸ ì–‘ (ì˜ˆ: 100, -50)", "100");
            if (!amountStr) return;

            try {
              await updateDoc(userRef(u.id), { coins: increment(parseInt(amountStr)) });
              alert("âœ… ì½”ì¸ ë³€ê²½ ì„±ê³µ!");
              adminLoadUsers(filterEmail);
            } catch (err) {
              alert("âŒ ì—ëŸ¬ ë°œìƒ: " + err.message);
            }
          };

          // [ë²„íŠ¼ 2] ì°¨ë‹¨
          const btnBan = document.createElement("button");
          btnBan.textContent = isBanned ? "âœ… í•´ì œ" : "â›” ì°¨ë‹¨";
          btnBan.style.padding = "6px 10px";
          btnBan.style.cursor = "pointer";
          btnBan.style.background = isBanned ? "#22c55e" : "#ef4444";
          btnBan.style.color = "white";
          btnBan.style.border = "none";

          // âœ… í´ë¦­ ì´ë²¤íŠ¸ (ì§„ë‹¨ìš©)
          btnBan.onclick = async (e) => {
            e.stopPropagation();
            alert(`[í´ë¦­ í™•ì¸] ${u.email}ë‹˜ì˜ ì°¨ë‹¨ ë²„íŠ¼ì´ ëˆŒë ¸ìŠµë‹ˆë‹¤!`);

            if (!confirm("ì •ë§ ìƒíƒœë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            try {
              await updateDoc(userRef(u.id), { isBanned: !isBanned });
              alert("âœ… ìƒíƒœ ë³€ê²½ ì„±ê³µ!");
              adminLoadUsers(filterEmail);
            } catch (err) {
              alert("âŒ ì—ëŸ¬ ë°œìƒ: " + err.message);
            }
          };

          btnGroup.appendChild(btnCoin);
          btnGroup.appendChild(btnBan);

          card.appendChild(infoDiv);
          card.appendChild(btnGroup);

          box.appendChild(card);
        });

      } catch (err) {
        alert("âŒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + err.message);
      }
    }

    async function adminRefreshDashboard() {
      const snaps = await getDocs(collection(db, "users"));
      let total = 0, pro = 0, active = 0;
      const now = Date.now();
      const weekAgo = now - 7 * 24 * 60 * 60 * 1000;

      snaps.forEach(s => {
        total++;
        const d = s.data();
        if (["PRO", "ULTRA", "MASTER"].includes(d.tier)) pro++;
        const la = d.lastActiveAt?.toMillis ? d.lastActiveAt.toMillis() : 0;
        if (la && la >= weekAgo) active++;
      });

      if ($("dashTotal")) $("dashTotal").textContent = String(total);
      if ($("dashPro")) $("dashPro").textContent = String(pro);
      if ($("dashActive")) $("dashActive").textContent = String(active);
    }

    /* =========================
       8) Initial Bindings
    ========================= */
    let isGlobalEventBound = false;
    let currentUserCache = null;

    function bindStaticUI() {
      const goAuth = () => $("authSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
      $("topStartBtn")?.addEventListener("click", () => { sfx.play("click"); $("authSection")?.scrollIntoView({ behavior: "smooth", block: "start" }); });
      $("startNowBtn")?.addEventListener("click", () => { sfx.play("click"); goAuth(); });
      $("heroStartBtn")?.addEventListener("click", () => { sfx.play("click"); goAuth(); });

      $("darkModeToggle")?.addEventListener("click", () => {
        sfx.play("click");
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "on" : "off");
      });
      if (localStorage.getItem("darkMode") === "on") document.body.classList.add("dark-mode");

      $("zenToggleBtn")?.addEventListener("click", () => { sfx.play("click"); toggleZenMode(); });
      $("zenExitBtn")?.addEventListener("click", () => { sfx.play("click"); toggleZenMode(false); });
      $("modalCloseBtn")?.addEventListener("click", closeProModal);
      $("proUpgradeBtn")?.addEventListener("click", () => showProModal("PRO"));
      $("ultraUpgradeBtn")?.addEventListener("click", () => showProModal("ULTRA"));
      $("masterUpgradeBtn")?.addEventListener("click", () => showProModal("MASTER"));

      $("signupBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        const email = ($("email").value || "").trim();
        const password = ($("password").value || "").trim();
        if (!email || !password || password.length < 6) return alert("ì…ë ¥ í™•ì¸ (ë¹„ë²ˆ 6ì ì´ìƒ)");
        try {
          await createUserWithEmailAndPassword(auth, email, password);
          alert("íšŒì›ê°€ì… ì™„ë£Œ!");
        } catch (e) { alert(e.message); }
      });

      $("signinBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        const email = ($("email").value || "").trim();
        const password = ($("password").value || "").trim();
        if (!email || !password) return alert("ì´ë©”ì¼/ë¹„ë²ˆ ì…ë ¥");
        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message); }
      });

      // Admin UI Bindings
      // [ìˆ˜ì •] Admin UI Bindings (íƒ­ í´ë¦­ ì‹œ ë°ì´í„° ë¡œë“œ ì¶”ê°€)
      $("adminCloseBtn")?.addEventListener("click", closeAdmin);
      $("adminExitBtn")?.addEventListener("click", closeAdmin);

      document.querySelectorAll(".adminNavBtn").forEach(btn => {
        btn.addEventListener("click", async () => {
          // 1. íƒ­ í™œì„±í™” UI ì²˜ë¦¬
          document.querySelectorAll(".adminNavBtn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          document.querySelectorAll(".admin-pane").forEach(p => p.classList.remove("active"));

          const paneId = btn.dataset.pane;
          $(paneId).classList.add("active");

          // 2. [ì¤‘ìš”] 'ìœ ì € ê´€ë¦¬' íƒ­ì„ ëˆŒë €ì„ ë•Œë§Œ ëª©ë¡ ë¡œë“œ ì‹¤í–‰!
          if (paneId === "pane-users") {
            console.log("ìœ ì € ê´€ë¦¬ íƒ­ í´ë¦­ë¨ -> ëª©ë¡ ë¡œë“œ ì‹œì‘");
            await adminLoadUsers();
          }
        });
      });
      $("refreshAdminBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        await adminRefreshDashboard();
        await adminLoadUsers($("adminSearch").value.trim());
      });
      $("adminSearch")?.addEventListener("input", async () => {
        await adminLoadUsers($("adminSearch").value.trim());
      });

      // âœ… [ì¶”ê°€ë¨] ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      $("adminSearchBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        await adminLoadUsers($("adminSearch").value.trim());
      });

      $("godGiftBtn")?.addEventListener("click", async () => {
        if (confirm("ì „ì²´ 100ì½”ì¸ ì„ ë¬¼?")) {
          const snaps = await getDocs(collection(db, "users"));
          let i = 0; const allDocs = []; snaps.forEach(d => allDocs.push(d));
          while (i < allDocs.length) {
            const batch = writeBatch(db);
            allDocs.slice(i, i + 400).forEach(d => batch.update(d.ref, { coins: increment(100) }));
            await batch.commit();
            i += 400;
          }
          alert("ì „ì†¡ ì™„ë£Œ");
        }
      });
    }

    function bindAuthedUI(user, getUserData) {
      if (isGlobalEventBound) return;
      isGlobalEventBound = true;

      $("logoutBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        isGlobalEventBound = false;
        await signOut(auth);
        window.location.reload();
      });

      $("habitBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        const uSnap = await getDoc(userRef(user.uid));
        if (uSnap.exists()) {
          const d = uSnap.data();
          const today = nowDateKey();
          if ((d.lastCompletedDate === today)) {
            petSay("ì´ë¯¸ ì™„ë£Œí–ˆì–´!"); return;
          }
          let xp = 20, coin = 1;
          if (d.tier === "PRO") { xp = 25; }
          if (d.tier === "ULTRA") { xp = 25; coin = 2; }
          if (d.tier === "MASTER") { xp = 30; coin = 3; }

          await setDoc(userLogRef(user.uid, today), { completed: true, ts: serverTimestamp(), habit: $("habitName").value }, { merge: true });
          await updateDoc(userRef(user.uid), {
            xp: increment(xp), coins: increment(coin), totalDays: increment(1),
            streak: (d.lastCompletedDate === dateKeyFromOffset(1) ? (d.streak || 0) + 1 : 1),
            lastCompletedDate: today,
            lastActiveAt: serverTimestamp()
          });
          sfx.play("success"); safeConfetti(); petSay("ì™„ë£Œ!");
          $("status").textContent = "ì™„ë£Œ!";
          appendTicker(`${user.email} ë‹˜ì´ ìŠµê´€ ì„±ê³µ!`);
        }
      });
    }

    /* =========================
       9) Main Entry
    ========================= */
    document.addEventListener("DOMContentLoaded", bindStaticUI);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        currentUserCache = null;
        showDashboard(false);
        $("welcome").textContent = "";
        const ab = $("adminOpenBtn"); if (ab) ab.style.display = "none";
        return;
      }
      currentUserCache = user;
      showDashboard(true);
      $("welcome").textContent = `${user.email} ë‹˜`;

      // Live Subscription
      onSnapshot(userRef(user.uid), async (snap) => {
        if (!snap.exists()) { await ensureUserDoc(user); return; }
        const data = snap.data();

        // 1. BAN Check
        if (data.isBanned) {
          alert("ğŸš« ì°¨ë‹¨ëœ ê³„ì •ì…ë‹ˆë‹¤.");
          await signOut(auth);
          window.location.reload();
          return;
        }
        // 2. Admin Check
        const isAdmin = isAdminUser(user);
        if (isAdmin) data.tier = "MASTER";

        // 3. UI Update
        setXpUI(data.xp || 0);
        setCoinsUI(data.coins || 0);
        setTierUI(data.tier || "FREE");
        setPetByLevel(calcLevelFromXp(data.xp || 0).level);
        if ($("streakCount")) $("streakCount").textContent = `ğŸ”¥ ì—°ì† ${data.streak || 0}ì¼`;

        const theme = data.theme || "";
        setThemeActive(theme);
        if (theme) {
          $("habitName").value = chooseSuggestion(theme);
          $("todaySuggestion").textContent = chooseSuggestion(theme);
        }

        // 4. Admin Button
        const ab = $("adminOpenBtn");
        if (ab && isAdmin) {
          ab.style.display = "flex";
          ab.onclick = openAdmin;
          // íŒ¨ë„ ì—´ë ¤ìˆìœ¼ë©´ ê°±ì‹ 
          if ($("adminPanel").style.display === "block") await adminRefreshDashboard();
        } else if (ab) {
          ab.style.display = "none";
        }
      });

      bindAuthedUI(user);
      appendTicker(`${user.email} ì ‘ì†`);
    });
    // ===================================
    // HabitFlow ì˜¤ë¥˜ ìˆ˜ì • íŒ¨ì¹˜
    // ê¸°ì¡´ <script type="module"> ë‚´ë¶€ì˜ Main Entry ì„¹ì…˜ ì´í›„ì— ì¶”ê°€í•˜ì„¸ìš”
    // ===================================

    /* =========================
       10) ì¶”ê°€ ì´ë²¤íŠ¸ ë°”ì¸ë”© (ì˜¤ë¥˜ ìˆ˜ì •)
    ========================= */

    // âœ… 1. ìš´ë™ íŒ¨ë„ íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    function bindWorkoutTabs() {
      document.querySelectorAll('.w-tab').forEach(tab => {
        tab.addEventListener('click', function () {
          // í™œì„± íƒ­ ì „í™˜
          document.querySelectorAll('.w-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');

          // ì„ íƒëœ ìš´ë™ íƒ€ì… ì €ì¥
          const workoutType = this.dataset.type;
          console.log('ì„ íƒëœ ìš´ë™:', workoutType);

          // ê²°ê³¼ ì´ˆê¸°í™”
          const resultEl = document.getElementById('workoutResult');
          if (resultEl) {
            resultEl.textContent = 'â“';
            resultEl.classList.remove('workout-anim');
          }

          const completeBtn = document.getElementById('completeWorkoutBtn');
          if (completeBtn) completeBtn.style.display = 'none';
        });
      });
    }

    // âœ… 2. í…Œë§ˆ ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    function bindThemeTags() {
      document.querySelectorAll('.theme-tag').forEach(tag => {
        tag.addEventListener('click', async function () {
          if (!currentUserCache) return;

          const theme = this.dataset.theme;
          sfx.play('click');

          // í™œì„± ìƒíƒœ ì „í™˜
          setThemeActive(theme);

          // Firestore ì—…ë°ì´íŠ¸
          try {
            await updateDoc(userRef(currentUserCache.uid), {
              theme: theme,
              lastActiveAt: serverTimestamp()
            });

            // ì¶”ì²œ ë£¨í‹´ í‘œì‹œ
            const suggestion = chooseSuggestion(theme);
            const suggEl = document.getElementById('todaySuggestion');
            const habitInput = document.getElementById('habitName');

            if (suggEl) suggEl.textContent = suggestion;
            if (habitInput) habitInput.value = suggestion;

            petSay('í…Œë§ˆ ì„ íƒ ì™„ë£Œ!');
          } catch (err) {
            console.error('í…Œë§ˆ ì €ì¥ ì‹¤íŒ¨:', err);
            alert('í…Œë§ˆ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + err.message);
          }
        });
      });
    }

    // âœ… 3. ìš´ë™ ë¯¸ì…˜ ë½‘ê¸° ë²„íŠ¼
    function bindWorkoutButtons() {
      const startBtn = document.getElementById('startWorkoutBtn');
      const completeBtn = document.getElementById('completeWorkoutBtn');
      const resultEl = document.getElementById('workoutResult');

      if (startBtn) {
        startBtn.addEventListener('click', function () {
          sfx.play('click');

          // í™œì„± íƒ­ í™•ì¸
          const activeTab = document.querySelector('.w-tab.active');
          if (!activeTab) return alert('ìš´ë™ ì¢…ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');

          const workoutType = activeTab.dataset.type;

          // ìš´ë™ë³„ ë¯¸ì…˜ ë°ì´í„°
          const missions = {
            walk: ['10ë¶„ ì‚°ì±…', '15ë¶„ ë¹ ë¥´ê²Œ ê±·ê¸°', '5000ë³´ ê±·ê¸°', 'ê³„ë‹¨ 3ì¸µ ì˜¤ë¥´ê¸°'],
            run: ['5ë¶„ ì¡°ê¹…', '1km ë‹¬ë¦¬ê¸°', '10ë¶„ ì¸í„°ë²Œ ëŸ°', '400m ì „ë ¥ì§ˆì£¼'],
            gym: ['íŒ”êµ½í˜€í´ê¸° 10ê°œ', 'ìŠ¤ì¿¼íŠ¸ 15ê°œ', 'í”Œë­í¬ 30ì´ˆ', 'ë²„í”¼ 5ê°œ']
          };

          const missionList = missions[workoutType] || ['ìš´ë™í•˜ê¸°'];
          const randomMission = missionList[Math.floor(Math.random() * missionList.length)];

          // ê²°ê³¼ í‘œì‹œ
          if (resultEl) {
            resultEl.textContent = randomMission;
            resultEl.classList.add('workout-anim');
          }

          // ì™„ë£Œ ë²„íŠ¼ í‘œì‹œ
          if (completeBtn) {
            completeBtn.style.display = 'block';
          }

          petSay('í™”ì´íŒ…! ğŸ’ª');
        });
      }

      if (completeBtn) {
        completeBtn.addEventListener('click', async function () {
          if (!currentUserCache) return;

          sfx.play('success');
          safeConfetti();

          try {
            // ì½”ì¸ 3ë°° ì§€ê¸‰
            await updateDoc(userRef(currentUserCache.uid), {
              coins: increment(3),
              lastActiveAt: serverTimestamp()
            });

            toastAchievement('ìš´ë™ ì±Œë¦°ì§€ ì™„ë£Œ! ğŸ‹ï¸');
            petSay('ëŒ€ë‹¨í•´ìš”! +3 ì½”ì¸');

            // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            this.style.display = 'none';
            if (resultEl) {
              resultEl.textContent = 'âœ… ì™„ë£Œ!';
              resultEl.classList.remove('workout-anim');
            }

            appendTicker(`${currentUserCache.email} ë‹˜ì´ ìš´ë™ ì™„ë£Œ!`);
          } catch (err) {
            console.error('ìš´ë™ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:', err);
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
          }
        });
      }
    }

    // âœ… 4. Live Ticker ì´ˆê¸°í™”
    function initLiveTicker() {
      const track = document.getElementById('tickerContent');
      if (!track) return;

      // ì´ˆê¸° ë©”ì‹œì§€ ì¶”ê°€
      const initialMessages = [
        'ğŸ‰ HabitFlowì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
        'âš¡ ì˜¤ëŠ˜ë„ ì‘ì€ ìŠµê´€ í•˜ë‚˜ ì™„ë£Œí•´ë³´ì„¸ìš”',
        'ğŸ”¥ ì—°ì† ê¸°ë¡ì´ ìŒ“ì´ë©´ ë³´ìƒì´ ì»¤ì ¸ìš”',
        'ğŸ’ ë§¤ì¼ ì ‘ì†í•˜ë©´ ì½”ì¸ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”'
      ];

      initialMessages.forEach(msg => {
        const item = document.createElement('div');
        item.className = 'ticker-item';
        item.textContent = msg;
        track.appendChild(item);
      });
    }

    // âœ… 5. ë©”ëª¨ ì €ì¥ ë²„íŠ¼ (PRO+ ì „ìš©)
    function bindMemoButtons() {
      const saveBtn = document.getElementById('saveMemoBtn');
      const memoInput = document.getElementById('dailyMemo');

      if (saveBtn && memoInput) {
        saveBtn.addEventListener('click', async function () {
          if (!currentUserCache) return;

          const content = memoInput.value.trim();
          if (!content) return alert('ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

          sfx.play('click');

          try {
            const today = nowDateKey();
            await setDoc(userMemoRef(currentUserCache.uid, today), {
              content: content,
              timestamp: serverTimestamp()
            });

            alert('ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
            petSay('ê¸°ë¡ ì™„ë£Œ!');

          } catch (err) {
            console.error('ë©”ëª¨ ì €ì¥ ì‹¤íŒ¨:', err);
            alert('ë©”ëª¨ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + err.message);
          }
        });
      }
    }

    // âœ… 6. ì „ì—­ ì‘ì› ë²„íŠ¼
    function bindGlobalCheerButton() {
      const cheerBtn = document.getElementById('globalCheerBtn');

      if (cheerBtn) {
        cheerBtn.addEventListener('click', function () {
          if (!currentUserCache) return;

          sfx.play('click');

          // í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
          for (let i = 0; i < 5; i++) {
            setTimeout(() => {
              const heart = document.createElement('div');
              heart.className = 'cheer-heart';
              heart.textContent = 'ğŸ’–';
              heart.style.left = `${Math.random() * 90 + 5}%`;
              heart.style.bottom = '0px';
              document.body.appendChild(heart);

              setTimeout(() => heart.remove(), 3000);
            }, i * 100);
          }

          petSay('ì‘ì› ì „ì†¡!');
          appendTicker(`${currentUserCache.email} ë‹˜ì´ ëª¨ë‘ì—ê²Œ ì‘ì›ì„ ë³´ëƒˆì–´ìš”! ğŸ’–`);
        });
      }
    }

    // âœ… 7. Focus/Zen ëª¨ë“œ í† ê¸€ ë²„íŠ¼ ì¶”ê°€
    function bindFocusToggle() {
      const focusBtn = document.getElementById('focusToggleBtn');
      if (focusBtn) {
        focusBtn.addEventListener('click', () => {
          sfx.play('click');
          toggleZenMode();
        });
      }
    }

    // âœ… 8. í…Œë§ˆ í† ê¸€ ë²„íŠ¼ (í—¤ë”)
    function bindHeaderThemeToggle() {
      const themeBtn = document.getElementById('themeToggleBtn');
      if (themeBtn) {
        themeBtn.addEventListener('click', () => {
          sfx.play('click');
          document.body.classList.toggle('dark-mode');

          // ì•„ì´ì½˜ ë³€ê²½
          if (document.body.classList.contains('dark-mode')) {
            themeBtn.textContent = 'â˜€ï¸';
            localStorage.setItem('darkMode', 'on');
          } else {
            themeBtn.textContent = 'ğŸŒ™';
            localStorage.setItem('darkMode', 'off');
          }
        });
      }
    }

    // âœ… 9. ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ë²„íŠ¼
    function bindPasswordReset() {
      const resetBtn = document.getElementById('resetPwBtn');
      if (resetBtn) {
        resetBtn.addEventListener('click', async () => {
          const email = document.getElementById('email').value.trim();
          if (!email) return alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

          try {
            await sendPasswordResetEmail(auth, email);
            alert('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤! âœ…');
          } catch (err) {
            alert('ì˜¤ë¥˜: ' + err.message);
          }
        });
      }
    }
    // âœ… 11. í”Œë¡œíŒ… ë²„íŠ¼ (ìƒì , ë­í‚¹, íœ´ì§€í†µ) ì´ë²¤íŠ¸ ì—°ê²°
    function bindFloatingButtons() {
      // 1. ìƒì  ë²„íŠ¼ & íŒ¨ë„
      const shopBtn = document.getElementById('shopOpenBtn');
      const shopPanel = document.getElementById('shopPanel');
      const shopClose = document.getElementById('shopCloseBtn');

      if (shopBtn && shopPanel) {
        shopBtn.addEventListener('click', () => {
          sfx.play('click');
          shopPanel.style.display = 'block';
        });
      }
      if (shopClose && shopPanel) {
        shopClose.addEventListener('click', () => {
          sfx.play('click');
          shopPanel.style.display = 'none';
        });
      }

      // 2. ë­í‚¹ ë²„íŠ¼ & íŒ¨ë„
      const rankBtn = document.getElementById('rankOpenBtn');
      const rankPanel = document.getElementById('rankPanel');
      const rankClose = document.getElementById('rankCloseBtn');

      if (rankBtn && rankPanel) {
        rankBtn.addEventListener('click', () => {
          sfx.play('click');
          rankPanel.style.display = 'block';
        });
      }
      if (rankClose && rankPanel) {
        rankClose.addEventListener('click', () => {
          sfx.play('click');
          rankPanel.style.display = 'none';
        });
      }

      // 3. íœ´ì§€í†µ ë²„íŠ¼ (ê¸°ëŠ¥ ë¯¸ì •ì´ë¯€ë¡œ í´ë¦­ ë°˜ì‘ë§Œ ì—°ê²°)
      const trashBtn = document.getElementById('trashModeBtn');
      if (trashBtn) {
        trashBtn.addEventListener('click', () => {
          sfx.play('click');
          // ì¶”ì¸¡ì— ì˜í•œ ê¸°ëŠ¥ êµ¬í˜„ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì•Œë¦¼ì°½ë§Œ ë„ì›€
          alert('ğŸ—‘ï¸ íœ´ì§€í†µ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        });
      }
    }
    // âœ… 12. ìƒì  ê¸°ëŠ¥ ì—°ê²° (ë½‘ê¸° ë¡œì§)
    function bindShopEvents() {
      const gachaBtn = $("gachaBtn");

      if (gachaBtn) {
        gachaBtn.addEventListener("click", async () => {
          // 1. ë¡œê·¸ì¸ ì²´í¬
          if (!currentUserCache) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
          }

          try {
            // 2. í˜„ì¬ ì½”ì¸ í™•ì¸ (DB ì¡°íšŒ)
            const userDocRef = userRef(currentUserCache.uid);
            const snap = await getDoc(userDocRef);

            if (!snap.exists()) return;

            const data = snap.data();
            const currentCoins = data.coins || 0;

            if (currentCoins < 1) {
              alert("ğŸ’ ì½”ì¸ì´ ë¶€ì¡±í•´ìš”! (1ì½”ì¸ í•„ìš”)");
              return;
            }

            // 3. ëœë¤ ë½‘ê¸° ë° DB ì—…ë°ì´íŠ¸
            sfx.play("click");
            const randomSticker = STICKERS[Math.floor(Math.random() * STICKERS.length)];

            await updateDoc(userDocRef, {
              coins: increment(-1),           // ì½”ì¸ 1ê°œ ì°¨ê°
              inventory: arrayUnion(randomSticker), // ì¸ë²¤í† ë¦¬ì— ìŠ¤í‹°ì»¤ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€ë¨)
              lastActiveAt: serverTimestamp()
            });

            // 4. ê²°ê³¼ ì•Œë¦¼
            alert(`ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! [ ${randomSticker} ] ìŠ¤í‹°ì»¤ë¥¼ íšë“í–ˆì–´ìš”!`);

            // (ì°¸ê³ : ì½”ì¸ UIëŠ” ê¸°ì¡´ onSnapshotì´ ìë™ìœ¼ë¡œ ê°±ì‹ í•´ì¤ë‹ˆë‹¤)

          } catch (err) {
            console.error(err);
            alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + err.message);
          }
        });
      }
    }
    // âœ… 13. ë©”ëª¨ íˆìŠ¤í† ë¦¬ ê¸°ëŠ¥ (ë²„íŠ¼ ìƒì„± + ë¡œë“œ)
    function bindMemoHistory() {
      const saveBtn = document.getElementById("saveMemoBtn");
      
      let historyBtn = document.getElementById("openMemoHistoryBtn");
      if (saveBtn && !historyBtn) {
        historyBtn = document.createElement("button");
        historyBtn.id = "openMemoHistoryBtn";
        historyBtn.className = "btn";
        historyBtn.style.cssText = "margin-top:8px; background:#333; color:white; border:1px solid #555;";
        historyBtn.textContent = "ğŸ“‚ ì§€ë‚œ ê¸°ë¡ ë³´ê¸°";
        saveBtn.parentNode.insertBefore(historyBtn, saveBtn.nextSibling);
      }

      if (historyBtn) {
        historyBtn.addEventListener("click", async () => {
          if (!currentUserCache) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          sfx.play("click");

          const historyPanel = document.getElementById("memoHistoryPanel");
          const listContainer = document.getElementById("memoHistoryList");
          
          if (!historyPanel || !listContainer) return;

          const isHidden = historyPanel.style.display === "none";
          historyPanel.style.display = isHidden ? "flex" : "none";

          if (isHidden) {
            listContainer.innerHTML = "<div style='padding:10px; text-align:center;'>ğŸ”„ ë¡œë”© ì¤‘...</div>";
            try {
              const q = query(
                collection(db, "users", currentUserCache.uid, "memos"),
                orderBy("timestamp", "desc"),
                limit(10)
              );
              const snaps = await getDocs(q);
              listContainer.innerHTML = ""; 

              if (snaps.empty) {
                listContainer.innerHTML = "<div style='padding:10px; text-align:center; color:#888;'>ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
                return;
              }

              snaps.forEach(d => {
                const data = d.data();
                const item = document.createElement("div");
                item.className = "memo-item";
                item.innerHTML = `
                  <div class="memo-date" style="font-size:10px; color:#aaa; margin-bottom:4px;">${d.id}</div>
                  <div class="memo-text" style="white-space:pre-wrap;">${data.content || ""}</div>
                `;
                listContainer.appendChild(item);
              });
            } catch (err) {
              console.error(err);
              listContainer.innerHTML = "<div style='padding:10px; color:#ef4444;'>ì˜¤ë¥˜ ë°œìƒ</div>";
            }
          }
        });
      }
    }

    // âœ… 14. Log í…ìŠ¤íŠ¸ í´ë¦­ ê¸°ëŠ¥ (ë²„íŠ¼ì´ ì—†ì–´ì„œ í…ìŠ¤íŠ¸ì— ì—°ê²°)
    function bindLogButton() {
      let logTarget = document.getElementById("openLogBtn");

      if (!logTarget) {
        const heatmapContainer = document.querySelector(".heatmap-container");
        if (heatmapContainer) {
          const spans = heatmapContainer.querySelectorAll("span");
          spans.forEach(span => {
            if (span.textContent.trim() === "Log") {
              logTarget = span;
              logTarget.style.cursor = "pointer";
              logTarget.style.textDecoration = "underline";
              logTarget.style.color = "var(--primary)";
            }
          });
        }
      }

      const heatmapSection = document.querySelector(".heatmap-container");
      if (logTarget && heatmapSection) {
        logTarget.addEventListener("click", () => {
          sfx.play("click");
          heatmapSection.scrollIntoView({ behavior: "smooth", block: "center" });
          
          heatmapSection.style.transition = "0.3s";
          heatmapSection.style.transform = "scale(1.02)";
          setTimeout(() => heatmapSection.style.transform = "scale(1)", 300);
        });
      }
    }

    // âœ… í†µí•© ì´ˆê¸°í™” í•¨ìˆ˜
    function initAdditionalBindings() {
      bindWorkoutTabs();
      bindThemeTags();
      bindWorkoutButtons();
      bindMemoButtons();
      bindGlobalCheerButton();
      bindFocusToggle();
      bindHeaderThemeToggle();
      bindPasswordReset();
      initLiveTicker();

      bindFloatingButtons(); // ìƒì , ë­í‚¹ ë“±
      bindShopEvents();      // ìƒì  ë¡œì§
      bindMemoHistory();     // ë©”ëª¨ ê¸°ë¡
      bindLogButton();       // ë¡œê·¸ ì´ë™
    }

    // ===================================
    // ìµœì¢… ì´ˆê¸°í™” (DOMContentLoadedì— ì¶”ê°€)
    // ===================================
    document.addEventListener('DOMContentLoaded', () => {
      bindStaticUI();
      initAdditionalBindings();
      console.log('âœ… HabitFlow ì´ˆê¸°í™” ì™„ë£Œ');
    });
  </script>
  <div id="bottomTicker" class="bottom-ticker" aria-label="ì‹¤ì‹œê°„ í™œë™">
    <div class="ticker-track" id="tickerContent"></div>
  </div>

</body>

</html>