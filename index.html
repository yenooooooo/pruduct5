<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>HabitFlow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* ====== âœ¨ Color System (Variables) ====== */
    :root {
      /* Light Mode */
      --bg-color: #f8fafc;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --card-bg: rgba(255, 255, 255, 0.85);
      --card-border: rgba(255, 255, 255, 0.6);
      --panel-bg: #ffffff;
      --input-bg: rgba(241, 245, 249, 0.8);
      
      /* Theme Colors */
      --primary: #6366f1;
      --secondary: #a855f7;
      --accent: #f59e0b; /* Gold */
      
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.08);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    }

    /* ğŸŒ™ Dark Mode */
    body.dark-mode {
      --bg-color: #0f172a;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --card-bg: rgba(30, 41, 59, 0.75);
      --card-border: rgba(255, 255, 255, 0.08);
      --panel-bg: #1e293b;
      --input-bg: rgba(15, 23, 42, 0.6);
      
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--text-main);
      font-family: 'SUIT', sans-serif;
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
      min-height: 100vh;
      position: relative;
    }
    
    /* ì‚­ì œ ëª¨ë“œì¼ ë•Œ ìŠ¤í‹°ì»¤ ìŠ¤íƒ€ì¼ */
    body.is-delete-mode .sticker {
        cursor: no-drop !important;
        filter: hue-rotate(180deg) drop-shadow(0 0 5px red);
        animation: shake 0.3s infinite;
        z-index: 9999 !important;
    }
    @keyframes shake {
        0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 
        50% { transform: rotate(-5deg); } 75% { transform: rotate(5deg); } 100% { transform: rotate(0deg); }
    }

    ul { list-style: none; padding: 0; margin: 0; }
    button { font-family: inherit; }

    /* ====== Layout ====== */
    section { width: 100%; padding: 84px 20px; position: relative; z-index: 1; pointer-events: none; }
    .container, .glass, button, input, .card, .price-card, .workout-side-panel, .problem-card, .memo-panel { pointer-events: auto; }
    .container { width: 100%; max-width: 1080px; margin: 0 auto; }
    
    header { position: absolute; top: 0; left: 0; right: 0; padding: 20px 0; z-index: 10; pointer-events: auto; }
    .header-inner { display: flex; justify-content: space-between; align-items: center; }
    .logo { font-weight: 900; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; color: var(--text-main); }
    .logo-badge { width: 12px; height: 12px; background: var(--primary); border-radius: 50%; }
    
    nav { display: flex; gap: 12px; align-items: center; }
    .pc-only { display: block; }
    @media (max-width: 600px) { .pc-only { display: none; } }
    
    /* Glass Effect */
    .glass {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 24px;
      transition: transform 0.25s ease;
    }
    .glass:hover { transform: translateY(-4px); }

    /* ====== Hero Section ====== */
    .hero { padding-top: 140px; padding-bottom: 80px; }
    .hero-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 48px; align-items: center; }
    
    .hero-pill { display: inline-block; padding: 8px 14px; border-radius: 999px; font-size: 13px; font-weight: 800; background: rgba(99, 102, 241, 0.15); color: var(--primary); }
    .hero-title { font-size: 46px; line-height: 1.2; letter-spacing: -1px; margin: 18px 0; font-weight: 900; color: var(--text-main); }
    .hero-desc { font-size: 16px; color: var(--text-muted); line-height: 1.7; margin-bottom: 24px; }
    
    .hero-metrics { display: flex; gap: 14px; margin-top: 28px; }
    .metric-card { 
        padding: 14px 18px; border-radius: 16px; 
        background: var(--input-bg); 
        border: 1px solid var(--card-border); 
        display: flex; flex-direction: column; gap: 4px; font-size: 13px; color: var(--text-main);
    }
    /* ğŸ”¥ Rolling Card Style */
    .recommend-card { 
        background: var(--card-bg); border-radius: 24px; padding: 30px; 
        margin-top: 20px; display: flex; flex-direction: column; gap: 8px; 
        font-size: 15px; color: var(--text-main); border: 1px solid var(--card-border);
        box-shadow: var(--shadow); transition: opacity 0.5s ease-in-out;
        min-height: 140px; justify-content: center;
    }

    /* ====== Problem Section (Restored) ====== */
    .problem-section { padding-top: 40px; padding-bottom: 60px; }
    .section-head { text-align: center; margin-bottom: 36px; }
    .section-head .kicker { display: inline-block; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 800; background: rgba(99, 102, 241, 0.15); color: var(--primary); }
    .section-head h2 { margin: 12px 0 8px; font-size: 28px; color: var(--text-main); }
    .section-head p { color: var(--text-muted); }
    
    .problem-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 18px; }
    .problem-card { padding: 24px; text-align: left; display: flex; flex-direction: column; gap: 10px; background: var(--card-bg); border-radius: 24px; border: 1px solid var(--card-border); box-shadow: var(--shadow); }
    .problem-card h3 { margin:0; font-size: 18px; color: var(--text-main); }
    .problem-card p { margin:0; font-size: 14px; color: var(--text-muted); line-height: 1.5; }

    /* ====== Dashboard Layout (Main + Side Stack) ====== */
    .dashboard-layout { display: flex; justify-content: center; align-items: flex-start; gap: 24px; max-width: 960px; margin: 0 auto; display: none; }
    #app { flex: 1; max-width: 480px; padding: 30px; text-align: center; position: relative; z-index: 10; width: 100%; }

    /* Right Column Stack */
    .right-stack {
        display: flex; flex-direction: column; gap: 20px; width: 340px; flex-shrink: 0;
    }

    /* Workout Side Panel (Dark Themed for MASTER) */
    .workout-side-panel {
        width: 100%; 
        background: linear-gradient(145deg, #1e293b, #0f172a); 
        color: white;
        padding: 24px; border-radius: 24px; 
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5); 
        display: none; text-align: left; position: relative; overflow: hidden;
    }
    .master-badge-corner { position: absolute; top: 16px; right: 16px; background: rgba(251, 191, 36, 0.2); color: #fbbf24; border: 1px solid #fbbf24; font-size: 10px; font-weight: 800; padding: 4px 8px; border-radius: 6px; letter-spacing: 1px; }
    .w-title { font-size: 18px; font-weight: 800; margin-bottom: 20px; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    .workout-tabs { display: flex; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 12px; margin-bottom: 20px; }
    .w-tab { flex: 1; border: none; background: transparent; color: #94a3b8; padding: 8px; font-size: 13px; font-weight: 700; border-radius: 8px; cursor: pointer; transition: 0.2s; }
    .w-tab.active { background: #fbbf24; color: #000; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3); }
    
    .workout-display { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px 10px; text-align: center; margin-bottom: 20px; min-height: 100px; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    .wd-main { font-size: 20px; font-weight: 800; margin-bottom: 4px; color: #fff; }
    .wd-sub { font-size: 12px; color: #94a3b8; }
    .workout-anim { animation: pulse 0.5s infinite alternate; color: #fbbf24; font-size: 24px; font-weight: 900; }

    /* Memo Panels */
    .memo-panel {
        width: 100%; padding: 20px; text-align: left; position: relative;
        display: flex; flex-direction: column; gap: 10px; overflow: hidden;
    }
    .memo-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .memo-title { font-weight: 800; font-size: 16px; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
    .memo-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: var(--primary); color: white; font-weight: 700; }
    
    textarea.memo-input {
        width: 100%; height: 100px; border: none; border-radius: 12px;
        background: var(--input-bg); color: var(--text-main);
        padding: 12px; font-family: inherit; font-size: 14px; line-height: 1.5;
        resize: none; outline: none; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .memo-history-list {
        max-height: 150px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;
    }
    .memo-item {
        background: var(--input-bg); padding: 10px; border-radius: 10px; font-size: 13px; color: var(--text-main);
        border: 1px solid var(--card-border);
    }
    .memo-date { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; font-weight: 700; }

    /* Lock Overlay */
    .panel-lock {
        position: absolute; inset: 0; background: rgba(0,0,0,0.1); backdrop-filter: blur(8px);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        border-radius: 24px; z-index: 10; color: var(--text-main); font-weight: 800; text-align: center;
        padding: 20px;
    }

    /* ====== Pricing Grid ====== */
    .pricing-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 18px; }
    .price-card { padding: 24px; text-align: left; display:flex; flex-direction:column; justify-content: space-between; height: 100%; background: var(--card-bg); border-radius: 24px; border: 1px solid var(--card-border); box-shadow: var(--shadow); }
    .price-card .plan { font-size: 13px; font-weight: 800; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; }
    .price-card .amount { font-size: 24px; font-weight: 900; margin-bottom: 4px; letter-spacing: -1px; color: var(--text-main); }
    .price-card .desc { font-size: 12px; color: var(--text-muted); margin-bottom: 15px; min-height: 32px; }
    .price-card ul { margin-bottom: 15px; padding: 0; list-style: none; }
    .price-card li { display: flex; gap: 6px; font-size: 12px; margin-bottom: 6px; align-items: center; font-weight: 500; color: var(--text-main); }

    .price-card.pro { border: 2px solid var(--primary); }
    .price-card.ultra { border: 2px solid var(--accent); }
    .price-card.master { 
        border: 2px solid #333; background: linear-gradient(135deg, #1e1e1e, #0f172a); 
        box-shadow: 0 10px 30px rgba(0,0,0,0.3); transform: scale(1.03); z-index: 2; position: relative;
    }
    .price-card.master .plan { color: #ffd700; }
    .price-card.master .desc { color: #94a3b8; }
    .price-card.master .amount, .price-card.master li { color: #fff; }
    .price-card.master .btn { background: #ffd700; color: #000; border:none; font-weight: 900; }

    /* ====== Components ====== */
    .auth-card { max-width: 400px; margin: 0 auto; padding: 30px; text-align: center; }
    .btn { padding: 12px; border-radius: 12px; font-weight: 900; cursor: pointer; border:1px solid var(--card-border); background: var(--panel-bg); color: var(--text-main); width:100%; transition:0.2s; box-shadow: var(--shadow); }
    .btn:active { transform: scale(0.95); }
    .btn-primary { border:none; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #fff; }
    input { width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 12px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text-main); }

    .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center; }
    .theme-tag { padding: 6px 12px; border-radius: 20px; border: 1px solid var(--card-border); background: transparent; cursor: pointer; font-size: 13px; color: var(--text-main); }
    .theme-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* Aura & Pet */
    .aura-effect { position: relative; }
    .aura-effect::before { content: ''; position: absolute; top: -15px; left: -15px; right: -15px; bottom: -15px; border-radius: 50%; background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000); background-size: 400%; z-index: -1; filter: blur(25px); animation: glowing 20s linear infinite; opacity: 0.5; }
    @keyframes glowing { 0% { background-position: 0 0; } 50% { background-position: 400% 0; } 100% { background-position: 0 0; } }

    .pet-container { display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 20px 0; cursor: pointer; transition: transform 0.2s; }
    .pet-emoji { font-size: 80px; animation: bounce 2s infinite; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.15)); }
    .pet-bubble { background: var(--panel-bg); color: var(--text-main); padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: bold; position: relative; margin-bottom: 10px; opacity: 0; transition: opacity 0.3s; box-shadow: var(--shadow); }
    
    .sticker { position: absolute; font-size: 40px; cursor: grab; user-select: none; z-index: 50; transition: transform 0.1s; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.15)); }
    .sticker:active { cursor: grabbing; transform: scale(1.1); }

    .heatmap-grid { display: grid; grid-template-columns: repeat(20, 1fr); gap: 4px; margin-top: 10px; justify-content: center; }
    .grass { width: 100%; aspect-ratio: 1; border-radius: 3px; background: rgba(0,0,0,0.08); }
    .grass.active { background: #22c55e; }

    /* Background Blobs */
    .blob-cont { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 0; overflow: hidden; pointer-events: none; }
    .blob { position: absolute; border-radius: 50%; opacity: 0.6; filter: blur(60px); animation: float 10s infinite alternate; }
    .blob-1 { top: 10%; left: 10%; width: 300px; height: 300px; background: var(--secondary); animation-duration: 25s; }
    .blob-2 { bottom: 20%; right: 10%; width: 350px; height: 350px; background: var(--primary); animation-duration: 30s; }
    .blob-3 { bottom: 10%; left: 30%; width: 250px; height: 250px; background: #ec4899; animation-duration: 22s; }
    @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(40px, 60px); } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes pulse { 0% { transform: scale(0.95); opacity: 0.7; } 100% { transform: scale(1.05); opacity: 1; } }

    @media (max-width: 900px) {
        .hero-grid, .pricing-grid, .problem-grid, .dashboard-layout { grid-template-columns: 1fr; flex-direction: column; align-items: center; }
        .workout-side-panel, .right-stack { width: 100%; max-width: 480px; }
    }
  </style>
</head>
<body>

  <div class="blob-cont">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <div id="stickerLayer" style="position: absolute; top:0; left:0; width:100%; height:100%; overflow:hidden; pointer-events:none; z-index:5;"></div>

  <div id="coinDisplay" style="position: fixed; top: 20px; right: 20px; z-index: 500; background: var(--panel-bg); padding: 8px 12px; border-radius: 20px; font-weight: 800; font-size: 14px; display:none; border: 2px solid var(--accent); color: var(--text-main); box-shadow: var(--shadow);">
      <span>â­</span> <span id="coinCount">0</span>
  </div>

  <header>
    <div class="container header-inner">
      <div class="logo"><div class="logo-badge"></div>HabitFlow</div>
      <nav>
        <button class="btn btn-primary" onclick="scrollToAuth()" style="padding: 8px 16px; font-size: 14px; width:auto;">ì‹œì‘í•˜ê¸°</button>
        <button id="darkModeToggle" class="btn btn-ghost" style="padding: 8px; width:auto;">ğŸŒ“</button>
      </nav>
    </div>
  </header>  

  <section class="hero">
    <div class="container hero-grid">
      <div class="hero-left">
        <span class="hero-pill">âœ¨ í•˜ë£¨ í•˜ë‚˜ë¡œ ì¶©ë¶„í•´ìš”</span>
        <h1 class="hero-title">í•˜ë£¨ í•˜ë‚˜,<br />ì¸ìƒì„ ë°”ê¾¸ëŠ” ìŠµê´€</h1>
        <p class="hero-desc">ì‘ì‹¬ì‚¼ì¼ì„ ëë‚´ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°©ì‹.<br>ë²„íŠ¼ í•œ ë²ˆìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ì—°ì† ê¸°ë¡ìœ¼ë¡œ ë™ê¸°ë¶€ì—¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”.</p>
        <div class="hero-actions">
          <button class="btn btn-primary" style="width:auto;" onclick="scrollToAuth()">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
        </div>
        <div class="hero-metrics">
          <div class="metric-card"><b>1 Habit</b><span>í•˜ë£¨ ë”± í•˜ë‚˜</span></div>
          <div class="metric-card"><b>Streak</b><span>ì—°ì† ê¸°ë¡</span></div>
          <div class="metric-card"><b>Report</b><span>ì£¼ê°„ ë¦¬í¬íŠ¸</span></div>
        </div>
      </div>
      
      <div class="hero-right glass">
        <h3 style="margin-top:0;">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´</h3>
        <p style="color:var(--text-muted); font-size:14px;">ë¡œê·¸ì¸ í›„ í…Œë§ˆë¥¼ ì„ íƒí•˜ë©´ ë§¤ì¼ ë‹¤ë¥¸ ë£¨í‹´ì´ ì¶”ì²œë©ë‹ˆë‹¤.</p>
        
        <div id="heroRecommendCard" class="recommend-card fade-anim" style="transition: opacity 0.5s;">
          <div>ğŸš‘ <b>ìƒì¡´ ì²´ë ¥ íŒ©</b></div>
          <span style="font-size:12px; color:var(--text-muted);">ì§ì¥ì¸ì„ ìœ„í•œ "ì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™"</span>
        </div>
      </div>
    </div>
  </section>

  <section class="problem-section">
    <div class="container">
      <div class="section-head">
        <span class="kicker">WHY</span>
        <h2>ì™œ ìŠµê´€ì€ í•­ìƒ ì‹¤íŒ¨í• ê¹Œ?</h2>
        <p>HabitFlowëŠ” â€œë”± 1ê°œë§Œ, ë²„íŠ¼ 1ë²ˆâ€ìœ¼ë¡œ ì‹¤í–‰ ì¥ë²½ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.</p>
      </div>
      <div class="problem-grid">
        <div class="problem-card glass">
          <div class="p-icon" style="font-size:32px;">ğŸ¯</div>
          <h3>ëª©í‘œê°€ ë„ˆë¬´ ë§ë‹¤</h3>
          <p>ìš•ì‹¬ì´ ì»¤ì§ˆìˆ˜ë¡ ì‹œì‘ì´ ì–´ë ¤ì›Œì ¸ìš”. í•˜ë£¨ 1ê°œë§Œ ë‚¨ê¹ë‹ˆë‹¤.</p>
        </div>
        <div class="problem-card glass">
          <div class="p-icon" style="font-size:32px;">ğŸ“</div>
          <h3>ê¸°ë¡ì´ ê·€ì°®ë‹¤</h3>
          <p>ê¸°ë¡ì´ ë²ˆê±°ë¡œìš°ë©´ í¬ê¸° í™•ë¥ ì´ ì˜¬ë¼ê°€ìš”. ë²„íŠ¼ í•œ ë²ˆì´ë©´ ë.</p>
        </div>
        <div class="problem-card glass">
          <div class="p-icon" style="font-size:32px;">ğŸ“‰</div>
          <h3>ì„±ì·¨ê°€ ëˆˆì— ì•ˆ ë³´ì¸ë‹¤</h3>
          <p>ìŒ“ì´ëŠ” ëŠë‚Œì´ ì—†ìœ¼ë©´ ì§€ì†ì´ ì–´ë µì£ . ì—°ì† ê¸°ë¡ì„ ì¦‰ì‹œ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="authSection" style="padding-top: 40px; min-height: 80vh;">
    <div class="container" style="display:flex; justify-content:center;">
      
      <div id="auth" class="auth-card glass">
        <h2>HabitFlow ì‹œì‘í•˜ê¸°</h2>
        <input id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
        <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
        <div class="auth-actions">
           <button id="signupBtn" class="btn btn-primary">íšŒì›ê°€ì…</button>
           <button id="signinBtn" class="btn btn-ghost">ë¡œê·¸ì¸</button>
        </div>
        <div style="margin-top:10px;"><button id="resetPwBtn" class="link-btn">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button></div>
      </div>

      <div id="dashboardLayout" class="dashboard-layout">
          
          <div id="app" class="glass">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <h2 id="welcome" style="margin:0; font-size: 1.2rem;"></h2>
              <button id="logoutBtn" style="background:none; border:none; color:var(--text-muted); font-size:0.8rem; text-decoration:underline; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            
            <div style="margin: 10px 0 10px;">
              <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:5px;">
                <span id="levelBadge" style="font-weight:900; color:var(--primary); font-size:18px;">Lv.1</span>
                <span id="xpText" style="font-size:12px; color:var(--text-muted); font-weight:700;">0 / 100 XP</span>
              </div>
              <div style="background:rgba(0,0,0,0.08); border-radius:10px; height:10px; overflow:hidden; position:relative;">
                <div id="xpBar" style="background:linear-gradient(90deg, var(--primary), var(--secondary)); width:0%; height:100%; transition: width 0.6s; border-radius:10px;"></div>
              </div>
            </div>

            <div class="pet-container" id="petContainer">
                <div id="petBubble" class="pet-bubble">ì‘ì›í•©ë‹ˆë‹¤!</div>
                <div id="petEmoji" class="pet-emoji">ğŸ¥š</div>
            </div>

            <div class="heatmap-container" style="margin: 15px 0; padding: 15px; border-radius: 16px; background: rgba(0,0,0,0.05); border: 1px solid var(--card-border);">
               <div style="font-size:12px; font-weight:700; color:var(--text-muted); display:flex; justify-content:space-between; margin-bottom: 5px;">
                 <span>ğŸŒ¿ ìµœê·¼ 20ì¼</span><span>Log</span>
               </div>
               <div id="heatmapGrid" class="heatmap-grid"></div>
            </div>

            <div id="tierBadge" style="display:none; margin: 20px 0;">
              <span id="tierText" class="badge"></span>
              <p id="streakCount" style="font-size: 0.9rem; margin-top: 8px; font-weight:700;"></p>
            </div>

            <div id="themeSection" style="margin-top:24px;">
               <p style="font-size: 0.9rem; font-weight: 700; margin-bottom:10px;">ğŸ ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ©</p>
               <div class="tag-container">
                  <button class="theme-tag" onclick="selectTheme(this, 'survival')">ğŸš‘ ìƒì¡´</button>
                  <button class="theme-tag" onclick="selectTheme(this, 'godsaeng')">âœ¨ ê°“ìƒ</button>
                  <button class="theme-tag" onclick="selectTheme(this, 'detox')">ğŸ“± ë””í†¡ìŠ¤</button>
                  <button class="theme-tag" onclick="selectTheme(this, 'custom')">â• ì»¤ìŠ¤í…€</button>
               </div>
            </div>
            
            <div id="todaySuggestion" style="margin-top:16px; font-size:0.9rem; padding:12px; background:rgba(99,102,241,0.1); border-radius:12px; color:var(--text-main);">í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
            
            <input id="habitName" readonly value="í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”" style="margin-top: 20px; text-align: center; font-weight:700;">
            <div style="display:flex; gap:8px; margin-top:10px;">
                <button id="habitBtn" class="btn btn-primary">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ âœ…</button>
                <button id="timerBtn" class="btn" style="width:60px; background:#333; color:white; display:none;">â±ï¸</button>
            </div>
            <p id="status" style="margin-top:12px; font-size:14px; color:var(--primary); font-weight:700; min-height:20px;"></p>
            
            <div id="stats" style="display:none; margin-top:20px; padding:16px; background:rgba(0,0,0,0.05); border-radius:12px;">
              <h3 style="margin:0 0 10px; font-size:16px;">ğŸ“Š í†µê³„</h3>
              <p id="totalDays" style="margin:0; font-weight:700;"></p>
            </div>

            <button id="restoreStreakBtn" style="margin-top:10px; width:100%; padding:12px; border-radius:12px; background:var(--accent); color:white; border:none; display:none;">ğŸ”¥ ì—°ì† ê¸°ë¡ ë³µêµ¬</button>

            <div id="weeklyReport" style="display:none; width: 100%; margin-top: 30px; text-align: left;">
              <div id="weeklyReportBody"></div>
              <div id="weeklyReportLocked" style="display:none; padding: 24px; border: 2px dashed var(--card-border); border-radius: 16px; text-align: center;">
                 ğŸ”’ PRO íšŒì›ì´ ë˜ì–´ ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                 <button class="btn btn-primary" style="margin-top: 15px; font-size:13px;" onclick="showProModal('PRO')">ì ê¸ˆ í•´ì œ</button>
              </div>
            </div>

            <div id="calendarSection" style="display:none; margin-top:30px; text-align:left;">
              <h3 style="font-size:16px; margin-bottom:10px;">ğŸ“… ìº˜ë¦°ë”</h3>
              <div id="calendarGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px;"></div>
            </div>
          </div>

          <div class="right-stack">
              
              <div id="workoutSidePanel" class="workout-side-panel">
                  <span class="master-badge-corner">MASTER</span>
                  <div class="w-title">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì±Œë¦°ì§€</div>
                  
                  <div class="workout-tabs">
                      <button class="w-tab active" onclick="selectWorkoutTab('walk')">ğŸš¶ ê±·ê¸°</button>
                      <button class="w-tab" onclick="selectWorkoutTab('run')">ğŸƒ ë‹¬ë¦¬ê¸°</button>
                      <button class="w-tab" onclick="selectWorkoutTab('gym')">ğŸ‹ï¸ í—¬ìŠ¤</button>
                  </div>

                  <div class="workout-display">
                      <div id="workoutResult" class="wd-main">â“</div>
                      <div class="wd-sub">ì¢…ëª© ì„ íƒ í›„ ë¯¸ì…˜ ë½‘ê¸°!</div>
                  </div>

                  <button id="startWorkoutBtn" class="btn" style="background:var(--accent); color:#000; border:none; font-weight:900; box-shadow:0 4px 15px rgba(251,191,36,0.4);">ğŸ° ë¯¸ì…˜ ëœë¤ ë½‘ê¸°</button>
                  <button id="completeWorkoutBtn" class="btn" style="background:linear-gradient(to right, #22c55e, #16a34a); color:#fff; border:none; display:none;">âœ… ì™„ë£Œ (ì½”ì¸ 3ë°°)</button>
                  
                  <div style="margin-top:15px; font-size:11px; opacity:0.6; text-align:center;">
                      * ë§ˆìŠ¤í„° ì±Œë¦°ì§€ ì„±ê³µ ì‹œ ê²½í—˜ì¹˜/ì½”ì¸ 3ë°°
                  </div>
              </div>

              <div id="memoPanel" class="glass memo-panel" style="display:none;">
                  <div class="memo-header">
                      <div class="memo-title">ğŸ“ ì˜¤ëŠ˜ì˜ ë©”ëª¨</div>
                      <span class="memo-badge">PRO+</span>
                  </div>
                  
                  <div id="memoLocked" class="panel-lock">
                      <div style="font-size:30px; margin-bottom:10px;">ğŸ”’</div>
                      <div>PRO ë“±ê¸‰ë¶€í„° ì‚¬ìš© ê°€ëŠ¥</div>
                      <button class="btn btn-primary" style="margin-top:15px; width:auto; padding:8px 16px; font-size:12px;" onclick="showProModal('PRO')">ì ê¸ˆ í•´ì œ</button>
                  </div>

                  <textarea id="dailyMemo" class="memo-input" placeholder="ì˜¤ëŠ˜ì˜ ë‹¤ì§ì´ë‚˜ í•  ì¼ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea>
                  <button id="saveMemoBtn" class="btn btn-primary" style="margin-top:10px;">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
              </div>

              <div id="memoHistoryPanel" class="glass memo-panel" style="display:none;">
                  <div class="memo-header">
                      <div class="memo-title">ğŸ“‚ ì§€ë‚œ ë©”ëª¨ ê¸°ë¡</div>
                  </div>
                  <div id="memoHistoryList" class="memo-history-list">
                      <div style="text-align:center; padding:10px; color:var(--text-muted); font-size:13px;">ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                  </div>
              </div>

          </div> </div>
    </div>
  </section>

  <section id="pricing">
    <div class="container">
      <div class="section-head">
        <span class="kicker">PRICING</span>
        <h2>ê°€ê²©</h2>
        <p>ë‹¹ì‹ ì˜ ì„±ì¥ì„ ê°€ì†í™”í•  ìµœì ì˜ í”Œëœì„ ì„ íƒí•˜ì„¸ìš”.</p>
      </div>
      
      <div class="pricing-grid">
        <div class="price-card glass">
          <div>
            <div class="plan">ë¬´ë£Œ</div>
            <div class="amount">â‚©0</div>
            <div class="desc">ê°€ë³ê²Œ ì‹œì‘í•˜ëŠ” ì…ë¬¸ììš©</div>
            <ul>
              <li>âœ… í•˜ë£¨ 1ìŠµê´€ ê¸°ë¡</li>
              <li>âœ… ê¸°ë³¸ í…Œë§ˆ ì¶”ì²œ</li>
            </ul>
          </div>
        </div>

        <div class="price-card glass pro">
          <div>
            <div class="plan" style="color:var(--primary);">PRO</div>
            <div class="amount">â‚©3,900</div>
            <div class="desc">ìŠµê´€ íŒ¨í„´ì„ ì¡ê³  ì‹¶ì€ ë¶„</div>
            <ul>
              <li>âœ¨ ìŠµê´€ ë¬´ì œí•œ + ì»¤ìŠ¤í…€</li>
              <li>âœ¨ ì£¼ê°„ AI ë¶„ì„ ë¦¬í¬íŠ¸</li>
              <li>âœ¨ ìº˜ë¦°ë” ë·° / ë³µêµ¬ê¶Œ</li>
              <li>ğŸ“ <b>ì˜¤ëŠ˜ì˜ ë©”ëª¨ & íˆìŠ¤í† ë¦¬</b></li>
            </ul>
          </div>
          <button class="btn btn-primary" onclick="showProModal('PRO')">PRO ì—…ê·¸ë ˆì´ë“œ</button>
        </div>

        <div class="price-card glass ultra">
          <div>
            <div class="plan" style="color:var(--accent);">ULTRA</div>
            <div class="amount">â‚©5,900</div>
            <div class="desc">ë‚˜ë§Œì˜ ê°ì„±ìœ¼ë¡œ ê¾¸ë¯¸ê¸°</div>
            <ul>
              <li>ğŸŒˆ ì•± ì»¬ëŸ¬ í…Œë§ˆ ë³€ê²½</li>
              <li>ğŸµ BGM ì„ ê³¡ê¶Œ (ë¹—ì†Œë¦¬ ë“±)</li>
              <li>ğŸ’° ì½”ì¸ íšë“ 2ë°°</li>
              <li>ğŸ‘‘ PRO ê¸°ëŠ¥ ëª¨ë‘ í¬í•¨</li>
            </ul>
          </div>
          <button class="btn btn-primary" style="background:linear-gradient(135deg, #f59e0b, #d97706);" onclick="showProModal('ULTRA')">ULTRA ì—…ê·¸ë ˆì´ë“œ</button>
        </div>

        <div class="price-card glass master">
          <div>
            <div class="plan">MASTER</div>
            <div class="amount">â‚©7,900</div>
            <div class="desc">ê·¹í•œì˜ ì„±ì¥ì„ ìœ„í•œ ì™„ì „ì²´</div>
            <ul>
              <li>ğŸ’ª <b>ë§¤ì¼ ìš´ë™ ì±Œë¦°ì§€ íŒ¨ë„</b></li>
              <li>â±ï¸ í¬ëª¨ë„ë¡œ ì§‘ì¤‘ íƒ€ì´ë¨¸</li>
              <li>âœ¨ ë§ˆìŠ¤í„° ì „ìš© ì˜¤ë¼ ì´í™íŠ¸</li>
              <li>ğŸ’° ì½”ì¸ íšë“ 3ë°°</li>
            </ul>
          </div>
          <button class="btn" onclick="showProModal('MASTER')">MASTER ì—…ê·¸ë ˆì´ë“œ</button>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="text-align:center; padding-bottom:40px; color:var(--text-muted); font-size:14px;">
      <p>Â© 2026 HabitFlow. All rights reserved.</p>
      <p>support@habitflow.app</p>
    </div>
  </footer>

  <button id="trashModeBtn" style="display:none; position:fixed; bottom:20px; right:140px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ—‘ï¸</button>
  <button id="themeBtn" style="display:none; position:fixed; bottom:20px; right:200px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#ec4899; color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ¨</button>
  <button id="shopOpenBtn" style="display:none; position:fixed; bottom:20px; right:80px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#8b5cf6; color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ</button>
  <button id="rankOpenBtn" style="display:none; position:fixed; bottom:20px; right:20px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:24px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ†</button>
  <button id="adminOpenBtn" style="display:none; position:fixed; bottom:20px; left:20px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#ef4444; color:white; font-size:24px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ‘‘</button>
  <button id="bgmOpenBtn" style="display:none; position:fixed; bottom:20px; left:80px; z-index:99999; width:40px; height:40px; border-radius:50%; border:none; background:var(--panel-bg); color:var(--text-main); font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.2); backdrop-filter: blur(5px);">ğŸµ</button>

  <div id="shopPanel" class="glass" style="display:none; position:fixed; bottom:80px; right:20px; width:300px; padding:20px; z-index:10000; border:2px solid #8b5cf6; background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><h3 style="margin:0; color:#7c3aed;">ğŸ ìƒì </h3><button class="close-btn" onclick="this.parentElement.parentElement.style.display='none'">âœ–</button></div>
    <div style="text-align:center; margin-bottom:20px;"><div style="font-size:60px;">ğŸ”®</div><button id="gachaBtn" class="btn btn-primary" style="margin-top:10px;">1ì½”ì¸ ë½‘ê¸°! (ë³´ìœ : <span id="shopCoinCount">0</span>)</button></div>
    <div style="font-size:12px; font-weight:bold; margin-bottom:5px;">ğŸ’ ë‚´ ìŠ¤í‹°ì»¤</div>
    <div id="inventoryList" style="height:150px; overflow-y:auto; background:var(--input-bg); padding:10px; border-radius:8px; display:grid; grid-template-columns:repeat(4,1fr); gap:10px;"></div>
  </div>

  <div id="themePanel" class="glass" style="display:none; position:fixed; bottom:80px; right:120px; width:200px; padding:20px; z-index:10000; background:var(--panel-bg);">
    <div style="margin-bottom:10px; font-weight:bold;">ğŸ¨ í…Œë§ˆ (ULTRA+)</div>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <button onclick="changeTheme('purple')" style="background:#6366f1; height:40px; border-radius:8px; border:none;"></button>
        <button onclick="changeTheme('blue')" style="background:#3b82f6; height:40px; border-radius:8px; border:none;"></button>
        <button onclick="changeTheme('pink')" style="background:#ec4899; height:40px; border-radius:8px; border:none;"></button>
        <button onclick="changeTheme('gold')" style="background:#d97706; height:40px; border-radius:8px; border:none;"></button>
    </div>
  </div>

  <div id="rankPanel" class="glass" style="display:none; position:fixed; bottom:80px; right:20px; width:340px; padding:20px; z-index:10000; border:2px solid var(--accent); background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><h3 style="margin:0; color:var(--accent);">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h3><button class="close-btn" onclick="this.parentElement.parentElement.style.display='none'">âœ–</button></div>
    <div id="rankList" style="height:300px; overflow-y:auto; background:var(--input-bg); padding:10px; border-radius:8px;"></div>
  </div>

  <div id="adminPanel" class="glass" style="display:none; position:fixed; bottom:80px; left:20px; width:340px; padding:20px; z-index:10000; border:2px solid #ef4444; background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><h3 style="margin:0; color:#ef4444;">ğŸ‘‘ ê´€ë¦¬ì</h3><button class="close-btn" onclick="this.parentElement.parentElement.style.display='none'">âœ–</button></div>
    <button id="cheatStreakBtn" style="padding:8px; width:100%;">ì¹˜íŠ¸í‚¤(5ì¼)</button>
    <div id="userList" style="height:250px; overflow-y:auto; background:var(--input-bg); padding:10px; margin-top:10px; border-radius:8px;"></div>
  </div>

  <div id="timerModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:20000; align-items:center; justify-content:center;">
      <div class="glass" style="padding:40px; text-align:center; background:var(--panel-bg); width:300px;">
          <h2 style="margin:0;">â±ï¸ ì§‘ì¤‘ íƒ€ì´ë¨¸</h2>
          <div id="timerDisplay" style="font-size:60px; font-weight:900; margin:20px 0;">25:00</div>
          <div style="display:flex; gap:10px;">
              <button id="startTimerBtn" class="btn btn-primary">ì‹œì‘</button>
              <button id="stopTimerBtn" class="btn">ì¤‘ì§€</button>
          </div>
          <button onclick="document.getElementById('timerModal').style.display='none'" style="margin-top:20px; border:none; background:none; text-decoration:underline;">ë‹«ê¸°</button>
      </div>
  </div>

  <div id="adminUserDetailModal" style="display:none; position:fixed; inset:0; z-index:10001; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
    <div style="background:var(--panel-bg); width:90%; max-width:500px; height:80vh; border-radius:16px; display:flex; flex-direction:column; overflow:hidden;">
      <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;"><h3 style="margin:0;">ìœ ì € ì •ë³´</h3><button onclick="this.closest('#adminUserDetailModal').style.display='none'">âœ–</button></div>
      <div id="detailContent" style="padding:20px; overflow-y:auto; flex:1; font-size:13px; line-height:1.6;"></div>
    </div>
  </div>

  <div id="proModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001; backdrop-filter:blur(5px);">
    <div class="glass" style="padding:40px; max-width:360px; width:90%; text-align:center; background:var(--panel-bg);">
      <h2 style="margin-top:0;" id="modalTitle">ğŸ‘‘ ì—…ê·¸ë ˆì´ë“œ</h2>
      <p style="color:var(--text-muted); margin-bottom:20px;">ë” ê°•ë ¥í•œ ê¸°ëŠ¥ìœ¼ë¡œ ì„±ì¥í•˜ì„¸ìš”.</p>
      <button class="btn btn-primary" onclick="alert('ê²°ì œ ê¸°ëŠ¥ ì¤€ë¹„ì¤‘!')">ì‹œì‘í•˜ê¸°</button>
      <p style="margin-top:16px; font-size:13px; cursor:pointer; color:var(--text-muted);" onclick="this.closest('#proModal').style.display='none'">ë‹«ê¸°</p>
    </div>
  </div>

  <div id="bgm" class="glass" style="display:none; position:fixed; bottom:70px; left:20px; padding:15px; width:240px; z-index:10000; background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><b>ğŸµ BGM</b><button onclick="this.parentElement.parentElement.style.display='none'">âœ–</button></div>
    <select id="bgmSelect" style="width:100%; padding:5px; margin-bottom:10px; display:none;"><option value="./bgm.mp3">ê¸°ë³¸</option><option value="rain">ë¹„ì˜¤ëŠ” ë‚ </option><option value="forest">ìˆ²ì†</option></select>
    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;"><button id="bgmToggle" style="flex:1; padding:6px; border-radius:6px; background:var(--primary); color:white; border:none;">ì¬ìƒ</button></div>
    <input id="bgmVol" type="range" min="0" max="1" step="0.01" value="0.25" style="width:100%;">
  </div>

  <audio id="bgmAudio" src="./bgm.mp3" preload="auto" loop></audio>

<script>
  function scrollToAuth() { document.getElementById("authSection").scrollIntoView({ behavior: "smooth" }); }
  function safeText(id, value) { const el = document.getElementById(id); if (el) el.textContent = value; }
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, getIdTokenResult, sendPasswordResetEmail, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs, updateDoc, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAIaroNs2VsMamnnNJV1cP9LdXqIDhl3Ig",
    authDomain: "giiiddd-36340523-3f595.firebaseapp.com",
    projectId: "giiiddd-36340523-3f595",
    storageBucket: "giiiddd-36340523-3f595.firebasestorage.app",
    messagingSenderId: "698901018936",
    appId: "1:698901018936:web:2fb12a7a03cbd844c1e9cd"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const STICKERS = ["ğŸ","ğŸ’Š","ğŸ“š","ğŸ¸","ğŸ’","ğŸ‘‘","ğŸš€","ğŸ¦„","ğŸ¦–","ğŸ•","ğŸŒˆ","ğŸ”¥","ğŸ’§","â­","ğŸ€","ğŸ„"];
  const themeData = {
    survival: ["ğŸ›Œ ë°¤ 11ì‹œ í° ë„ê¸°", "ğŸ’§ ê³µë³µ ë¬¼ í•œ ì”", "ğŸ’Š ì˜ì–‘ì œ ì±™ê²¨ë¨¹ê¸°", "ğŸ¢ ê±°ë¶ëª© ìŠ¤íŠ¸ë ˆì¹­", "ğŸ‘ï¸ ë¨¼ ì‚° ë³´ê¸°", "ğŸ§¹ ì±…ìƒ ìœ„ ë¦¬ì…‹"],
    godsaeng: ["ğŸ“… ì£¼ê°„ ê³„íš", "ğŸ›ï¸ ì´ë¶ˆ ì •ë¦¬", "ğŸ’° ê°€ê³„ë¶€", "ğŸ“š ë…ì„œ 2p", "ğŸ—£ï¸ ì˜ë‹¨ì–´ 1ê°œ", "ğŸ“ ê°ì‚¬ì¼ê¸°"],
    detox: ["ğŸ“ ì†ê¸°ë¡", "ğŸ“µ ê¸°ìƒí›„ ë…¸í°", "ğŸ½ï¸ ë°¥ë¨¹ì„ë•Œ í°X", "ğŸ§ ì´ì–´í° ë¹¼ê¸°", "ğŸ§˜ ëª…ìƒ 5ë¶„"],
    custom: [] 
  };
  
  // ğŸ”¥ Rotating Recommendation Animation
  const recommendations = [
      { t: "ğŸš‘ ìƒì¡´ ì²´ë ¥ íŒ©", d: 'ì§ì¥ì¸ì„ ìœ„í•œ "ì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™"' },
      { t: "âœ¨ ê°“ìƒ ì…ë¬¸ íŒ©", d: 'ì„±ê³µ ë£¨í‹´ì„ 2ë¶„ì§œë¦¬ë¡œ ìª¼ê°œê¸°' },
      { t: "ğŸ§˜ ë””í†¡ìŠ¤ íë§ íŒ©", d: 'ìŠ¤ë§ˆíŠ¸í° ë‚´ë ¤ë†“ê³  ë‡Œ íœ´ì‹í•˜ê¸°' }
  ];
  let recIdx = 0;
  setInterval(() => {
      const card = document.getElementById('heroRecommendCard');
      if(card) {
          recIdx = (recIdx + 1) % recommendations.length;
          card.style.opacity = 0;
          setTimeout(() => {
              card.innerHTML = `<div><b>${recommendations[recIdx].t}</b></div><span style="font-size:12px; color:var(--text-muted)">${recommendations[recIdx].d}</span>`;
              card.style.opacity = 1;
          }, 500);
      }
  }, 4000);

  // ğŸ”¥ Workout Challenge Logic
  window.selectWorkoutTab = (type) => {
      document.querySelectorAll('.w-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('startWorkoutBtn').dataset.type = type;
      document.getElementById('workoutResult').innerHTML = '<span class="wd-main">â“</span><div class="wd-sub">ì¢…ëª© ì„ íƒ í›„ ë¯¸ì…˜ ë½‘ê¸°!</div>';
      document.getElementById('completeWorkoutBtn').style.display = 'none';
      document.getElementById('startWorkoutBtn').style.display = 'inline-block';
  }

  document.getElementById("startWorkoutBtn").onclick = () => {
      const type = document.getElementById('startWorkoutBtn').dataset.type;
      if(!type) return alert("ì¢…ëª©ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!");
      
      const res = document.getElementById("workoutResult");
      res.innerHTML = '<span class="workout-anim">...ë‘êµ¬ë‘êµ¬...</span>';
      
      setTimeout(() => {
          let mainText = "";
          let subText = "í™”ì´íŒ…!";
          if(type === 'walk') {
              const times = [30, 60, 90, 120];
              const t = times[Math.floor(Math.random()*times.length)];
              mainText = `ğŸš¶ ê±·ê¸° ${t}ë¶„`;
              subText = "ê°€ë³ê²Œ ì‹œì‘í•´ë³´ì„¸ìš”!";
          } else if(type === 'run') {
              const times = [20, 30, 40, 60];
              const t = times[Math.floor(Math.random()*times.length)];
              mainText = `ğŸƒ ë‹¬ë¦¬ê¸° ${t}ë¶„`;
              subText = "ì‹¬ì¥ì´ í„°ì§ˆ ë•Œê¹Œì§€!";
          } else {
              const routines = ["ìŠ¤ì¿¼íŠ¸ 100ê°œ", "í‘¸ì‰¬ì—… 50ê°œ + í”Œë­í¬ 3ë¶„", "ë“± ìš´ë™ 5ì„¸íŠ¸", "í•˜ì²´ ì§‘ì¤‘ íƒ€ê²©", "ë²„í”¼ 50íšŒ"];
              mainText = `ğŸ‹ï¸ ${routines[Math.floor(Math.random()*routines.length)]}`;
              subText = "ê·¼ì„±ì¥ ê°€ì¦ˆì•„!";
          }
          res.innerHTML = `<div class="wd-main">${mainText}</div><div class="wd-sub">${subText}</div>`;
          document.getElementById('startWorkoutBtn').style.display = 'none';
          document.getElementById('completeWorkoutBtn').style.display = 'inline-block';
      }, 1000);
  };

  document.getElementById("completeWorkoutBtn").onclick = async () => {
      const user = auth.currentUser;
      if(!user) return;
      const ref = doc(db,"users",user.uid);
      const snap = await getDoc(ref);
      let coins = snap.data().coins || 0;
      coins += 3; // 3x Reward
      await updateDoc(ref, { coins });
      alert("ğŸ”¥ ì±Œë¦°ì§€ ì™„ë£Œ! ì½”ì¸ 3ê°œ íšë“!");
      updateLevelUI(user.uid);
      confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
      document.getElementById('completeWorkoutBtn').style.display = 'none';
      document.getElementById('startWorkoutBtn').style.display = 'inline-block';
      document.getElementById('workoutResult').innerHTML = '<div class="wd-main">âœ… ì™„ë£Œ</div><div class="wd-sub">ë‚´ì¼ ë˜ ë„ì „í•˜ì„¸ìš”!</div>';
  };

  function dateKeyFromOffset(n) { const d = new Date(); d.setDate(d.getDate()-n); return d.toISOString().slice(0,10); }
  async function getConsecutiveStreak(uid) {
    let c = 0, d = new Date();
    while(true) {
      if(!(await getDoc(doc(db,"users",uid,"habits",d.toISOString().slice(0,10)))).exists()) break;
      c++; d.setDate(d.getDate()-1);
    }
    return c;
  }

  async function updateLevelUI(uid) {
    const d = (await getDoc(doc(db,"users",uid))).data() || {};
    document.getElementById("levelBadge").innerText = `Lv.${d.level||1}`;
    document.getElementById("xpText").innerText = `${d.xp||0} / 100 XP`;
    document.getElementById("xpBar").style.width = `${(d.xp||0)}%`;
    document.getElementById("coinDisplay").style.display = 'flex';
    document.getElementById("coinCount").innerText = d.coins||0;
    
    const petC = document.getElementById("petContainer");
    if(d.isMaster) petC.classList.add("aura-effect");
    else petC.classList.remove("aura-effect");

    let emoji = "ğŸ¥š";
    if((d.level||1)>=16) emoji="ğŸ‘‘"; else if((d.level||1)>=8) emoji="ğŸ²"; else if((d.level||1)>=4) emoji="ğŸ¥"; else if((d.level||1)>=2) emoji="ğŸ£";
    document.getElementById("petEmoji").innerText = emoji;
  }

  // --- Sticker Logic ---
  let isDeleteMode = false;
  const trashBtn = document.getElementById("trashModeBtn");
  trashBtn.onclick = () => {
      isDeleteMode = !isDeleteMode;
      trashBtn.style.background = isDeleteMode ? "#ef4444" : "var(--accent)";
      document.body.classList.toggle("is-delete-mode");
      alert(isDeleteMode ? "ğŸ—‘ï¸ ì‚­ì œ ëª¨ë“œ ON: ìŠ¤í‹°ì»¤ë¥¼ í´ë¦­í•´ì„œ ì§€ìš°ì„¸ìš”." : "âœ¨ ì‚­ì œ ëª¨ë“œ OFF");
  };

  async function loadInventory(uid) {
      const d = (await getDoc(doc(db,"users",uid))).data() || {};
      const list = document.getElementById("inventoryList"); list.innerHTML = "";
      (d.inventory||[]).forEach(s => {
          const div = document.createElement("div"); div.innerText = s;
          div.style.cssText = "font-size:30px; cursor:grab; background:white; border-radius:8px; text-align:center;";
          div.onmousedown = (e) => startDrag(e,s,uid,true);
          div.ontouchstart = (e) => startDrag(e,s,uid,true);
          list.appendChild(div);
      });
  }

  async function loadPlacedStickers(uid) {
      const d = (await getDoc(doc(db,"users",uid))).data() || {};
      const layer = document.getElementById("stickerLayer"); layer.innerHTML = "";
      (d.placedStickers||[]).forEach(s => createStickerEl(s, uid));
  }

  function createStickerEl(data, uid) {
      const el = document.createElement("div"); el.className = "sticker"; el.innerText = data.char;
      el.style.left = data.x+"%"; el.style.top = data.y+"%"; el.id = data.id;
      
      const dragStart = (e) => {
          if(isDeleteMode) return; 
          startDrag(e, el, uid, false); 
      };
      el.addEventListener('mousedown', dragStart);
      el.addEventListener('touchstart', dragStart, {passive:false});
      
      el.addEventListener('click', async (e) => {
          if(!isDeleteMode) return;
          e.stopPropagation(); e.preventDefault();
          if(confirm("ì´ ìŠ¤í‹°ì»¤ë¥¼ ì‚­ì œí• ê¹Œìš”?")) {
              el.remove();
              const r = doc(db,"users",uid);
              const p = (await getDoc(r)).data().placedStickers || [];
              await updateDoc(r, { placedStickers: p.filter(s => s.id !== data.id) });
          }
      });
      document.getElementById("stickerLayer").appendChild(el);
  }

  let dragCtx = null;
  function startDrag(e, target, uid, isNew) {
      if(isDeleteMode) return;
      e.preventDefault();
      const el = isNew ? document.createElement("div") : target;
      if(isNew) { el.className = "sticker"; el.innerText = target; el.style.pointerEvents="none"; document.body.appendChild(el); }
      
      dragCtx = { el, isNew, char: isNew?target:null, uid };
      const cx = e.clientX||e.touches[0].clientX;
      const cy = e.clientY||e.touches[0].clientY;
      
      if(!isNew) {
          const r = el.getBoundingClientRect();
          dragCtx.ox = cx - r.left; dragCtx.oy = cy - r.top;
          el.style.zIndex = 1000;
      } else {
          el.style.left = (cx-20)+"px"; el.style.top = (cy-20)+"px";
      }

      document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onEnd);
      document.addEventListener('touchmove', onMove, {passive:false}); document.addEventListener('touchend', onEnd);
  }

  function onMove(e) {
      if(!dragCtx) return;
      e.preventDefault();
      const cx = e.clientX||e.touches[0].clientX; const cy = e.clientY||e.touches[0].clientY;
      if(dragCtx.isNew) { dragCtx.el.style.left=(cx-20)+"px"; dragCtx.el.style.top=(cy-20)+"px"; }
      else { dragCtx.el.style.left=(cx-dragCtx.ox)+"px"; dragCtx.el.style.top=(cy-dragCtx.oy)+"px"; }
  }

  async function onEnd(e) {
      document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onEnd);
      document.removeEventListener('touchmove', onMove); document.removeEventListener('touchend', onEnd);
      if(!dragCtx) return;

      const layer = document.getElementById("stickerLayer");
      const r = layer.getBoundingClientRect();
      const cx = e.clientX||(e.changedTouches?e.changedTouches[0].clientX:0);
      const cy = e.clientY||(e.changedTouches?e.changedTouches[0].clientY:0);
      
      let x, y;
      if(dragCtx.isNew) {
          x = ((cx - r.left)/r.width)*100; y = ((cy - r.top)/r.height)*100;
          dragCtx.el.remove();
      } else {
          const er = dragCtx.el.getBoundingClientRect();
          x = ((er.left - r.left)/r.width)*100; y = ((er.top - r.top)/r.height)*100;
          dragCtx.el.style.zIndex="";
      }

      const ref = doc(db,"users",dragCtx.uid);
      const placed = (await getDoc(ref)).data().placedStickers || [];
      
      if(dragCtx.isNew) {
          const s = { id: Date.now().toString(), char: dragCtx.char, x, y };
          placed.push(s); createStickerEl(s, dragCtx.uid);
      } else {
          const i = placed.findIndex(s => s.id === dragCtx.el.id);
          if(i>-1) { placed[i].x=x; placed[i].y=y; dragCtx.el.style.left=x+"%"; dragCtx.el.style.top=y+"%"; }
      }
      await updateDoc(ref, { placedStickers: placed });
      dragCtx = null;
  }

  window.selectTheme = async (el, type) => {
      const user = auth.currentUser; if(!user) return alert("ë¡œê·¸ì¸ í•„ìš”");
      const input = document.getElementById("habitName");
      document.querySelectorAll('.theme-tag').forEach(t=>t.classList.remove('active'));
      
      if(type==='custom') {
          const t = await getIdTokenResult(user);
          if(!t.claims.pro && !t.claims.admin) return alert("ğŸ”’ PRO ì „ìš©");
          input.readOnly=false; input.value=""; input.focus();
      } else {
          input.readOnly=true;
          const pool = themeData[type];
          input.value = pool[Math.floor(Math.random()*pool.length)]; // ğŸ”¥ Random
      }
      if(el) el.classList.add('active');
  };

  window.showProModal = (type) => {
      document.getElementById("modalTitle").innerText = `ğŸ‘‘ ${type} ì—…ê·¸ë ˆì´ë“œ`;
      document.getElementById("proModal").style.display = 'flex';
  };

  window.changeTheme = async (c) => {
      const user = auth.currentUser; if(!user) return;
      const d = (await getDoc(doc(db,"users",user.uid))).data();
      if(!d.isUltra && !d.isMaster && user.email!=="test@gmail.com") return alert("ğŸ’ ULTRA ì „ìš©");
      
      let p, s;
      if(c==='blue') { p='#3b82f6'; s='#60a5fa'; }
      else if(c==='pink') { p='#ec4899'; s='#f472b6'; }
      else if(c==='gold') { p='#d97706'; s='#fbbf24'; }
      else { p='#6366f1'; s='#a855f7'; }
      document.documentElement.style.setProperty('--primary', p);
      document.documentElement.style.setProperty('--secondary', s);
      document.querySelector('.blob-1').style.background = s;
      document.querySelector('.blob-2').style.background = p;
  };

  async function loadStats(uid) {
      const snap = await getDocs(collection(db,"users",uid,"habits"));
      let successCount = 0;
      snap.forEach(doc => {
          if(doc.data().done) successCount++;
      });
      safeText("totalDays", `ì´ ëˆ„ì  ì„±ê³µ: ${successCount}ì¼`);
  }

  // ğŸ”¥ Memo Saving & History Logic
  document.getElementById("saveMemoBtn").onclick = async () => {
      const user = auth.currentUser; if(!user) return;
      const memo = document.getElementById("dailyMemo").value;
      if(!memo.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
      
      const today = dateKeyFromOffset(0);
      await setDoc(doc(db,"users",user.uid,"habits",today), { memo: memo }, { merge: true });
      alert("âœ… ë©”ëª¨ ì €ì¥ ì™„ë£Œ!");
      renderMemoHistory(user.uid);
  };

  async function renderMemoHistory(uid) {
      const listDiv = document.getElementById("memoHistoryList");
      listDiv.innerHTML = "ë¡œë”© ì¤‘...";
      
      const snap = await getDocs(collection(db,"users",uid,"habits"));
      let memos = [];
      snap.forEach(doc => {
          const d = doc.data();
          if(d.memo) memos.push({date: doc.id, text: d.memo});
      });
      
      memos.sort((a,b) => new Date(b.date) - new Date(a.date)); // Sort DESC
      
      if(memos.length === 0) {
          listDiv.innerHTML = '<div style="text-align:center; padding:10px; color:var(--text-muted); font-size:13px;">ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
      }
      
      listDiv.innerHTML = "";
      memos.forEach(m => {
          const div = document.createElement("div");
          div.className = "memo-item";
          div.innerHTML = `<div class="memo-date">${m.date}</div><div>${m.text}</div>`;
          listDiv.appendChild(div);
      });
  }

  onAuthStateChanged(auth, async user => {
      if(!user) {
          document.getElementById("auth").style.display='block';
          document.getElementById("dashboardLayout").style.display='none';
          document.getElementById("coinDisplay").style.display = 'none';
          ['adminOpenBtn','rankOpenBtn','shopOpenBtn','trashModeBtn','bgmOpenBtn','themeBtn'].forEach(id=>document.getElementById(id).style.display='none');
          return;
      }
      if(!user.emailVerified && user.email!=="test@gmail.com") { alert("ì¸ì¦ í•„ìš”"); await signOut(auth); return; }

      document.getElementById("auth").style.display='none';
      document.getElementById("dashboardLayout").style.display='flex'; // Show Dashboard
      document.getElementById("welcome").textContent = `ğŸ‘‹ ${user.email.split('@')[0]}ë‹˜`;

      // Init Buttons
      ['rankOpenBtn','shopOpenBtn','trashModeBtn','bgmOpenBtn'].forEach(id=>document.getElementById(id).style.display='block');
      
      const adminEmail = "test@gmail.com";
      const uDoc = await getDoc(doc(db,"users",user.uid));
      let { isPro, isUltra, isMaster } = uDoc.data() || {};
      
      if(user.email === adminEmail) { isPro=true; isUltra=true; isMaster=true; document.getElementById("adminOpenBtn").style.display='block'; }

      // PRO/ULTRA/MASTER Checks
      if(isUltra || isMaster) {
          document.getElementById("themeBtn").style.display='block';
          document.getElementById("bgmSelect").style.display='block';
      }
      if(isMaster) {
          document.getElementById("workoutSidePanel").style.display='block'; // Show Master Panel
          document.getElementById("timerBtn").style.display='block';
      } else {
          document.getElementById("workoutSidePanel").style.display='none';
          document.getElementById("timerBtn").style.display='none';
      }

      // Memo Feature (PRO+)
      document.getElementById("memoPanel").style.display = 'flex';
      document.getElementById("memoHistoryPanel").style.display = 'flex';
      
      if(isPro || isUltra || isMaster) {
          document.getElementById("memoLocked").style.display='none';
          // Load today's memo
          const today = dateKeyFromOffset(0);
          const snap = await getDoc(doc(db,"users",user.uid,"habits",today));
          if(snap.exists() && snap.data().memo) {
              document.getElementById("dailyMemo").value = snap.data().memo;
          }
          // Load History
          renderMemoHistory(user.uid);
      } else {
          document.getElementById("memoLocked").style.display='flex';
          document.getElementById("memoHistoryPanel").style.display='none'; // Hide history if not PRO
      }

      if(isPro||isUltra||isMaster) {
          document.getElementById("stats").style.display='block';
          safeText("status", isMaster?"ğŸ‘‘ MASTER":isUltra?"ğŸ’ ULTRA":"ğŸŒŸ PRO");
          loadStats(user.uid);
      } else {
          safeText("status", "ğŸŒ± ë¬´ë£Œ íšŒì›");
      }

      // Load Data
      updateLevelUI(user.uid);
      loadPlacedStickers(user.uid);
      updateTierUI(await getConsecutiveStreak(user.uid));
      renderCalendar(user.uid, (isPro||isUltra||isMaster));
      
      // Heatmap
      const grid=document.getElementById("heatmapGrid"); grid.innerHTML="";
      for(let i=19; i>=0; i--) {
          const d = dateKeyFromOffset(i);
          const div=document.createElement("div"); div.className="grass"; div.title=d;
          if((await getDoc(doc(db,"users",user.uid,"habits",d))).exists()) div.classList.add("active");
          grid.appendChild(div);
      }
  });

  // Buttons Logic
  document.getElementById("habitBtn").onclick = async () => {
      const user=auth.currentUser; if(!user) return;
      const name = document.getElementById("habitName").value;
      if(!name || name==="í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”") return alert("ìŠµê´€ ì…ë ¥");
      
      await setDoc(doc(db,"users",user.uid,"habits",dateKeyFromOffset(0)), {done:true, name, timestamp:new Date()}, {merge:true});
      
      const ref = doc(db,"users",user.uid);
      const snap = await getDoc(ref);
      let { level=1, xp=0, coins=0, isUltra, isMaster, email } = snap.data() || {};
      if(user.email === "test@gmail.com") { isUltra=true; isMaster=true; } // Admin Admin

      xp+=20;
      coins += isMaster ? 3 : (isUltra ? 2 : 1);
      
      let lvlUp=false;
      if(xp>=100) { level++; xp-=100; lvlUp=true; }
      
      await setDoc(ref, {level, xp, coins, email: user.email}, {merge:true});
      updateLevelUI(user.uid);
      
      // Celebrate
      const btn = document.getElementById("habitBtn");
      btn.innerHTML = "ì™„ë£Œí•¨ âœ¨"; btn.disabled=true;
      confetti({particleCount: lvlUp?200:100, origin:{y:0.7}});
      new Audio(lvlUp ? "https://cdn.pixabay.com/download/audio/2022/03/15/audio_7368884964.mp3" : "https://cdn.pixabay.com/download/audio/2021/08/04/audio_bb630cc098.mp3").play().catch(()=>{});
  };

  document.getElementById("gachaBtn").onclick = async () => {
      const user=auth.currentUser; if(!user) return;
      const ref = doc(db,"users",user.uid);
      const snap = await getDoc(ref);
      let coins = snap.data().coins||0;
      if(coins<1) return alert("ì½”ì¸ ë¶€ì¡±");
      
      coins--;
      const p = STICKERS[Math.floor(Math.random()*STICKERS.length)];
      await updateDoc(ref, { coins, inventory: arrayUnion(p) });
      
      alert(`ğŸ‰ [${p}] íšë“!`);
      updateLevelUI(user.uid); loadInventory(user.uid);
  };

  // Timer Logic
  let timer=null, timeLeft=1500;
  document.getElementById("timerBtn").onclick = () => document.getElementById("timerModal").style.display='flex';
  document.getElementById("startTimerBtn").onclick = () => {
      if(timer) return;
      timer = setInterval(() => {
          if(timeLeft<=0) { clearInterval(timer); alert("ì§‘ì¤‘ ë!"); return; }
          timeLeft--;
          const m = Math.floor(timeLeft/60), s = timeLeft%60;
          document.getElementById("timerDisplay").innerText = `${m}:${s<10?'0':''}${s}`;
      }, 1000);
  };
  document.getElementById("stopTimerBtn").onclick = () => { clearInterval(timer); timer=null; };

  // Helper UIs
  ['rank','shop','admin'].forEach(k => {
      document.getElementById(k+'OpenBtn').onclick = () => {
          document.getElementById(k+'Panel').style.display = document.getElementById(k+'Panel').style.display==='none'?'block':'none';
          if(k==='rank') loadLeaderboard();
          if(k==='shop') loadInventory(auth.currentUser.uid);
          if(k==='admin') loadAllUsers();
      }
  });

  // Admin & Leaderboard functions same as before (omitted to save space, but logic is included above)
  async function loadAllUsers() {
      const listDiv = document.getElementById("userList"); listDiv.innerHTML = "ë¡œë”©...";
      const snap = await getDocs(collection(db, "users")); listDiv.innerHTML = "";
      snap.forEach(d => {
          const item = document.createElement("div"); item.style.padding="5px"; item.style.borderBottom="1px solid #ccc";
          const data = d.data();
          item.innerHTML = `<span>${d.id.slice(0,5)} (${data.isMaster?'MASTER':data.isUltra?'ULTRA':data.isPro?'PRO':'FREE'})</span> <button onclick="changeUserGrade('${d.id}')">ë³€ê²½</button>`;
          listDiv.appendChild(item);
      });
  }
  window.changeUserGrade = async (uid) => {
      const g = prompt("ë“±ê¸‰(free/pro/ultra/master):");
      if(g) await updateDoc(doc(db,"users",uid), { isPro: g!=='free', isUltra: g==='ultra'||g==='master', isMaster: g==='master' });
  };
  
  async function loadLeaderboard() {
      const list = document.getElementById("rankList"); list.innerHTML="ë¡œë”©...";
      const snap = await getDocs(collection(db,"users"));
      let u = []; snap.forEach(d=>u.push(d.data()));
      u.sort((a,b)=>b.level-a.level);
      list.innerHTML = u.slice(0,10).map((x,i)=>`<div style="padding:5px; border-bottom:1px solid #eee;">${i+1}. ${x.email?.slice(0,3)}*** Lv.${x.level}</div>`).join('');
  }

  // Auth Buttons
  const emailInput=document.getElementById("email"), passInput=document.getElementById("password");
  document.getElementById("signupBtn").onclick = async () => {
      try {
          const c = await createUserWithEmailAndPassword(auth, emailInput.value, passInput.value);
          await sendEmailVerification(c.user); alert("ì¸ì¦ ë©”ì¼ í™•ì¸í•˜ì„¸ìš”");
      } catch(e) { alert(e.message); }
  };
  document.getElementById("signinBtn").onclick = async () => {
      try { await signInWithEmailAndPassword(auth, emailInput.value, passInput.value); } catch(e) { alert(e.message); }
  };
  document.getElementById("logoutBtn").onclick = () => signOut(auth);

  // BGM Logic
  const audio = document.getElementById("bgmAudio");
  document.getElementById("bgmOpenBtn").onclick = () => document.getElementById("bgm").style.display='block';
  document.getElementById("bgmToggle").onclick = () => { audio.paused ? audio.play() : audio.pause(); };
  document.getElementById("bgmSelect").onchange = (e) => { audio.src = e.target.value; audio.play(); };
  
  // Theme Toggle Logic
  const toggle = document.getElementById("darkModeToggle");
  toggle.onclick = () => {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "on" : "off");
  };
  if (localStorage.getItem("darkMode") === "on") document.body.classList.add("dark-mode");
</script>
</body>
</html>