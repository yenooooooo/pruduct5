<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>HabitFlow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&amp;display=swap" rel="stylesheet">

  <style>
ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
/* ====== Layout Container Fix ====== */
:root{
  --bg-color:#f8fafc;
  --text-main:#0f172a;
  --muted:#64748b;
  --card-bg: rgba(255,255,255,0.72);
  --card-border: rgba(15,23,42,0.08);
  --primary:#6366f1;
  --secondary:#a855f7;
  --shadow: 0 20px 25px -5px rgb(0 0 0 / .08), 0 8px 10px -6px rgb(0 0 0 / .06);
}

.dark-mode{
  --bg-color:#020617;
  --text-main:#f8fafc;
  --muted:#94a3b8;
  --card-bg: rgba(2,6,23,0.55);
  --card-border: rgba(148,163,184,0.12);
  --shadow: 0 20px 25px -5px rgb(0 0 0 / .45), 0 8px 10px -6px rgb(0 0 0 / .35);
}

*{ box-sizing:border-box; }
body{
  margin:0;
  background:var(--bg-color);
  color:var(--text-main);
  font-family:'Pretendard',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  overflow-x:hidden;
}

/* âœ… í•µì‹¬: sectionì€ ì „ì²´í­, ì‹¤ì œ ë‚´ìš©í­ì€ .containerê°€ ë‹´ë‹¹ */
section{
  width:100%;
  padding: 84px 20px;
}
.container{
  width:100%;
  max-width: 1080px;
  margin: 0 auto;
}

/* Titles */
.section-head{
  text-align:center;
  margin-bottom: 26px;
}
.section-head .kicker{
  display:inline-block;
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
  letter-spacing:-0.2px;
  background: rgba(99,102,241,0.12);
  color: var(--primary);
}
.section-head h2{
  margin:12px 0 8px;
  font-size: 28px;
  letter-spacing:-0.6px;
}
.section-head p{
  margin:0;
  color: var(--muted);
  font-size: 15px;
  line-height:1.7;
}

/* Glass card */
.glass{
  background: var(--card-bg);
  border:1px solid var(--card-border);
  box-shadow: var(--shadow);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  border-radius: 22px;
}
.glass:hover {
  transform: translateY(-4px);
  transition: 0.25s ease;
}

/* ====== Problem Cards ====== */
.problem-grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 16px;
  margin-top: 18px;
}
.problem-card{
  padding: 18px 18px;
  text-align:left;
}
.problem-card h3{
  margin:0 0 8px;
  font-size: 16px;
}
.problem-card p{
  margin:0;
  color: var(--muted);
  font-size: 13px;
  line-height:1.6;
}
.problem-bottom{
  margin-top: 18px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 12px;
}
.problem-pill{
  padding: 12px 14px;
  border-radius: 16px;
  border:1px dashed var(--card-border);
  background: rgba(255,255,255,0.35);
  color: var(--text-main);
  font-weight:800;
  text-align:center;
}
.dark-mode .problem-pill{ background: rgba(2,6,23,0.35); }

/* ====== Features ====== */
.features-grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 18px;
  margin-top: 18px;
}
.feature-card{
  padding: 22px;
  text-align:left;
  position:relative;
  overflow:hidden;
}
.feature-icon{
  width:44px; height:44px;
  display:grid; place-items:center;
  border-radius: 14px;
  background: rgba(99,102,241,0.12);
  color: var(--primary);
  font-size: 20px;
  margin-bottom: 12px;
}
.feature-card h3{
  margin:0 0 8px;
  font-size:16px;
}
.feature-card p{
  margin:0;
  color:var(--muted);
  font-size:14px;
  line-height:1.6;
}
.feature-card::after{
  content:"";
  position:absolute;
  right:-60px; top:-60px;
  width:160px; height:160px;
  background: radial-gradient(circle at 30% 30%, rgba(168,85,247,.22), transparent 60%);
  transform: rotate(10deg);
}

/* ====== PRO Section ====== */
.pro-wrap{
  padding: 28px;
  background: linear-gradient(135deg, rgba(99,102,241,0.16), rgba(168,85,247,0.16));
  border: 1px solid var(--card-border);
}
.pro-grid{
  display:grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 18px;
  align-items:center;
  margin-top: 18px;
}
.pro-list{
  list-style:none;
  padding:0;
  margin:0;
  display:grid;
  gap:10px;
  text-align:left;
}
.pro-list li{
  display:flex;
  gap:10px;
  align-items:flex-start;
  color: var(--text-main);
  font-weight:700;
}
.pro-list li span{
  color: var(--primary);
}
.pro-badge{
  padding: 18px;
  text-align:left;
}
.pro-badge .price{
  font-size: 28px;
  font-weight: 900;
  letter-spacing:-0.6px;
}
.pro-badge .sub{
  color: var(--muted);
  margin-top: 6px;
  font-size: 13px;
}

/* ====== Flow ====== */
.flow-grid{
  display:grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap: 14px;
  margin-top: 18px;
}
.step-card{
  padding: 18px;
  text-align:left;
}
.step-no{
  width:30px; height:30px;
  border-radius: 10px;
  display:grid; place-items:center;
  background: rgba(99,102,241,0.14);
  color: var(--primary);
  font-weight: 900;
  margin-bottom: 10px;
}
.step-card h3{ margin:0 0 6px; font-size:15px; }
.step-card p{ margin:0; color:var(--muted); font-size:13px; line-height:1.6; }

/* ====== Pricing ====== */
.pricing-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 16px;
  margin-top: 18px;
}
.price-card{
  padding: 22px;
  text-align:left;
}
.price-card .plan{
  font-weight: 900;
  font-size: 16px;
  margin-bottom: 8px;
}
.price-card .amount{
  font-size: 30px;
  font-weight: 900;
  letter-spacing:-0.6px;
  margin-bottom: 8px;
}
.price-card .desc{
  color: var(--muted);
  font-size: 13px;
  line-height:1.7;
  margin-bottom: 14px;
}
.price-card ul{
  margin:0;
  padding-left: 18px;
  color: var(--text-main);
  font-size: 13px;
  line-height:1.7;
}
.price-card.pro{
  border: 2px solid rgba(99,102,241,0.45);
  position:relative;
}
.price-card.pro::before{
  content:"ì¶”ì²œ";
  position:absolute;
  top: 14px; right: 14px;
  font-size:12px;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  background: rgba(99,102,241,0.14);
  color: var(--primary);
}

/* Responsive */
 @media (max-width: 900px){
  .problem-grid{ grid-template-columns: 1fr; }
  .problem-bottom{ grid-template-columns: 1fr; }
  .features-grid{ grid-template-columns: 1fr; }
  .pro-grid{ grid-template-columns: 1fr; }
  .flow-grid{ grid-template-columns: 1fr 1fr; }
  .pricing-grid{ grid-template-columns: 1fr; }
}
 @media (max-width: 520px){
  .flow-grid{ grid-template-columns: 1fr; }
}
button {
  border-radius: 14px;
  font-weight: 800;
}
.hero {
  padding: 120px 20px 80px;
  background: radial-gradient(
    800px circle at 80% -20%,
    rgba(168, 85, 247, 0.15),
    transparent 60%
  );
}

.hero-grid {
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 48px;
  align-items: center;
}

.hero-pill {
  display: inline-block;
  padding: 8px 14px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 800;
  background: rgba(99, 102, 241, 0.12);
  color: var(--primary);
}

.hero-title {
  font-size: 46px;
  line-height: 1.2;
  letter-spacing: -1px;
  margin: 18px 0;
}

.hero-desc {
  font-size: 16px;
  color: var(--muted);
  line-height: 1.7;
}

.hero-actions {
  margin-top: 24px;
  display: flex;
  gap: 12px;
}

.btn-primary {
  padding: 14px 22px;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: #fff;
  font-weight: 900;
  border: none;
  cursor: pointer;
}

.btn-ghost {
  padding: 14px 22px;
  border-radius: 14px;
  border: 1px solid #e5e7eb;
  font-weight: 800;
  text-decoration: none;
  color: var(--text-main);
}

.hero-metrics {
  display: flex;
  gap: 14px;
  margin-top: 28px;
}

.metric-card {
  padding: 14px 18px;
  border-radius: 16px;
  background: #fff;
  border: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: 13px;
}

.hero-right {
  padding: 26px;
}

.recommend-card {
  background: #fff;
  border-radius: 16px;
  padding: 16px;
  margin-top: 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 14px;
}
.auth-actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.auth-hint{
  margin:12px 0 0;
  font-size:13px;
  color: var(--muted);
  text-align:center;
}
.btn{
  appearance:none;
  border:1px solid var(--card-border);
  background: rgba(255,255,255,0.8);
  color: var(--text-main);
  padding:14px 14px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
  width:100%;
  transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
}
.btn:active{ transform: scale(.98); }
.btn-primary{
  border:none;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color:#fff;
  box-shadow: 0 14px 30px rgba(99,102,241,0.25);
}
.btn-ghost{
  background: transparent;
}
/* ===== Auth Actions (íšŒì›ê°€ì…/ë¡œê·¸ì¸/ë¹„ë²ˆì°¾ê¸°) ===== */
.auth-actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}

.auth-actions .btn{
  flex:1;
  padding:14px 14px;
  border-radius:14px;
  font-weight:900;
  border:1px solid rgba(15,23,42,0.10);
  cursor:pointer;
}

.btn-primary{
  border:none !important;
  color:#fff;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
}

.btn-ghost{
  background: transparent;
  color: var(--text-main);
}

.auth-links{
  margin-top:10px;
  text-align:center;
}

.link-btn{
  border:none;
  background:transparent;
  color: var(--muted);
  font-weight:800;
  cursor:pointer;
  text-decoration: underline;
}

.auth-hint{
  margin-top:12px;
  font-size:12px;
  color: var(--muted);
  line-height:1.6;
  text-align:center;
}

</style>
</head>
<body>

  <header>
    <div class="container header-inner">
      <div class="logo">
        <div class="logo-badge"></div>
        HabitFlow
      </div>
  
      <nav>
        <a href="#features">ê¸°ëŠ¥</a>
        <a href="#pro">PRO</a>
        <a href="#pricing">ê°€ê²©</a>
        <button class="btn btn-primary" onclick="scrollToAuth()">ì‹œì‘í•˜ê¸°</button>
        <button id="darkModeToggle" class="btn btn-ghost">ğŸŒ“</button>
      </nav>
    </div>
  </header>  

<section class="hero">
  <div class="container hero-grid">
    <!-- LEFT -->
    <div class="hero-left">
      <span class="hero-pill">âœ¨ í•˜ë£¨ í•˜ë‚˜ë¡œ ì¶©ë¶„í•´ìš”</span>

      <h1 class="hero-title">
        í•˜ë£¨ í•˜ë‚˜,<br />
        ì¸ìƒì„ ë°”ê¾¸ëŠ” ìŠµê´€
      </h1>

      <p class="hero-desc">
        ì‘ì‹¬ì‚¼ì¼ì„ ëë‚´ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°©ì‹.<br />
        ë²„íŠ¼ í•œ ë²ˆìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ì—°ì† ê¸°ë¡ê³¼ ë¦¬í¬íŠ¸ë¡œ ë™ê¸°ë¶€ì—¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”.
      </p>

      <div class="hero-actions">
        <button class="btn-primary" onclick="scrollToAuth()">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
        <a href="#pricing" class="btn-ghost">ê°€ê²© ë³´ê¸°</a>
      </div>

      <div class="hero-metrics">
        <div class="metric-card">
          <b>1 Habit</b>
          <span>í•˜ë£¨ ë”± í•˜ë‚˜</span>
        </div>
        <div class="metric-card">
          <b>Streak</b>
          <span>ì—°ì† ê¸°ë¡</span>
        </div>
        <div class="metric-card">
          <b>Report</b>
          <span>ì£¼ê°„ ë¦¬í¬íŠ¸</span>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="hero-right glass">
      <h3>ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´</h3>
      <p>ë¡œê·¸ì¸ í›„ í…Œë§ˆë¥¼ ì„ íƒí•˜ë©´ ì˜¤ëŠ˜ ìŠµê´€ì´ ìë™ìœ¼ë¡œ ì¶”ì²œë¼ìš”.</p>

      <div class="recommend-card">
        ğŸš‘ <b>ìƒì¡´ ì²´ë ¥ íŒ©</b>
        <span>ì§ì¥ì¸ì„ ìœ„í•œ â€œì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™â€</span>
      </div>

      <div class="recommend-card">
        âœ¨ <b>ê°“ìƒ ì…ë¬¸ íŒ©</b>
        <span>ì„±ê³µ ë£¨í‹´ì„ 2ë¶„ì§œë¦¬ë¡œ ìª¼ê°œê¸°</span>
      </div>
    </div>
  </div>
</section>


<section class="problem">
  <div class="container">
    <div class="section-head">
      <span class="kicker">WHY</span>
      <h2>ì™œ ìŠµê´€ì€ í•­ìƒ ì‹¤íŒ¨í• ê¹Œ?</h2>
      <p>HabitFlowëŠ” â€œë”± 1ê°œë§Œ, ë²„íŠ¼ 1ë²ˆâ€ìœ¼ë¡œ ì‹¤í–‰ ì¥ë²½ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="problem-grid">
      <div class="problem-card glass">
        <h3>ğŸ¯ ëª©í‘œê°€ ë„ˆë¬´ ë§ë‹¤</h3>
        <p>ìš•ì‹¬ì´ ì»¤ì§ˆìˆ˜ë¡ ì‹œì‘ì´ ì–´ë ¤ì›Œì ¸ìš”. ìš°ë¦¬ëŠ” í•˜ë£¨ 1ê°œë§Œ ë‚¨ê¹ë‹ˆë‹¤.</p>
      </div>
      <div class="problem-card glass">
        <h3>ğŸ“ ê¸°ë¡ì´ ê·€ì°®ë‹¤</h3>
        <p>ê¸°ë¡ì´ ë²ˆê±°ë¡œìš°ë©´ ì¤‘ë„ í¬ê¸° í™•ë¥ ì´ ì˜¬ë¼ê°€ìš”. ë²„íŠ¼ í•œ ë²ˆì´ë©´ ë.</p>
      </div>
      <div class="problem-card glass">
        <h3>ğŸ“‰ ì„±ì·¨ê°€ ëˆˆì— ì•ˆ ë³´ì¸ë‹¤</h3>
        <p>ìŒ“ì´ëŠ” ëŠë‚Œì´ ì—†ìœ¼ë©´ ì§€ì†ì´ ì–´ë µì£ . ì—°ì† ê¸°ë¡ì„ ì¦‰ì‹œ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
      </div>
    </div>

    <div class="problem-bottom">
      <div class="problem-pill">âœ… í•˜ë£¨ ë”± í•˜ë‚˜</div>
      <div class="problem-pill">âœ… ë²„íŠ¼ í•œ ë²ˆ</div>
      <div class="problem-pill">âœ… ì—°ì† ê¸°ë¡ ì‹œê°í™”</div>
    </div>
  </div>
</section>

<!-- FEATURES -->
<section id="features">
  <div class="container">
    <div class="section-head">
      <span class="kicker">FEATURES</span>
      <h2>í•µì‹¬ ê¸°ëŠ¥</h2>
      <p>ìŠµê´€ì„ â€œí•  ìˆ˜ ìˆê²Œ ë§Œë“œëŠ”â€ ìµœì†Œ ê¸°ëŠ¥ë§Œ ë‚¨ê²¼ìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="features-grid">
      <div class="feature-card glass">
        <div class="feature-icon">ğŸ“…</div>
        <h3>í•˜ë£¨ 1ìŠµê´€</h3>
        <p>ì˜¤ëŠ˜ í•  ë‹¨ í•˜ë‚˜ë§Œ ì„ íƒ. ëª©í‘œ ê³¼ë¶€í•˜ë¥¼ ëŠìŠµë‹ˆë‹¤.</p>
      </div>

      <div class="feature-card glass">
        <div class="feature-icon">ğŸ”¥</div>
        <h3>ì—°ì† ê¸°ë¡</h3>
        <p>ì„±ê³µì´ ìŒ“ì´ëŠ” ëŠë‚Œì´ ê³§ ë™ê¸°ì…ë‹ˆë‹¤. ìŠ¤íŠ¸ë¦­ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”.</p>
      </div>

      <div class="feature-card glass">
        <div class="feature-icon">â˜ï¸</div>
        <h3>ìë™ ì €ì¥</h3>
        <p>í´ë¼ìš°ë“œì— ì €ì¥ë˜ì–´ ì–´ë””ì„œë“  ì´ì–´ì„œ í•  ìˆ˜ ìˆì–´ìš”.</p>
      </div>
    </div>
  </div>
</section>

<!-- PRO -->
<section id="pro">
  <div class="container">
    <div class="section-head">
      <span class="kicker">PRO</span>
      <h2>HabitFlow PRO</h2>
      <p>â€œìŠµê´€ì´ ë¬´ë„ˆì§€ëŠ” íŒ¨í„´â€ì„ ì¡ì•„ì£¼ëŠ” ë¶„ì„ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
    </div>

    <div class="pro-wrap glass">
      <div class="pro-grid">
        <ul class="pro-list">
          <li><span>âœ”</span> ìŠµê´€ ë¬´ì œí•œ (ì»¤ìŠ¤í…€ í¬í•¨)</li>
          <li><span>âœ”</span> ì£¼ê°„ ë¦¬í¬íŠ¸ (AI ë¶„ì„/íŒ¨í„´)</li>
          <li><span>âœ”</span> íˆìŠ¤í† ë¦¬/í†µê³„ í™•ì¥</li>
        </ul>

        <div class="pro-badge glass">
          <div class="price">â‚©3,900 <span style="font-size:14px; font-weight:800; color:var(--muted)">/ ì›”</span></div>
          <div class="sub">ì—°ì† ê¸°ë¡ì´ 7ì¼ì„ ë„˜ëŠ” ìˆœê°„, íš¨ê³¼ê°€ í™•ì‹¤íˆ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FLOW -->
<section class="flow">
  <div class="container">
    <div class="section-head">
      <span class="kicker">HOW</span>
      <h2>ì‚¬ìš© ë°©ë²•</h2>
      <p>ë”± 4ë‹¨ê³„. ë³µì¡í•œ ê¸°ëŠ¥ì€ ì˜ë„ì ìœ¼ë¡œ ì—†ì•´ìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="flow-grid">
      <div class="step-card glass">
        <div class="step-no">1</div>
        <h3>ë¡œê·¸ì¸</h3>
        <p>ì´ë©”ì¼ë¡œ ê°„í¸ ì‹œì‘</p>
      </div>
      <div class="step-card glass">
        <div class="step-no">2</div>
        <h3>ì˜¤ëŠ˜ì˜ ìŠµê´€ ì„ íƒ</h3>
        <p>í…Œë§ˆì—ì„œ ì¶”ì²œì„ ê³ ë¥´ê±°ë‚˜(PROëŠ” ì»¤ìŠ¤í…€)</p>
      </div>
      <div class="step-card glass">
        <div class="step-no">3</div>
        <h3>ë²„íŠ¼ í´ë¦­</h3>
        <p>ì™„ë£Œ í•œ ë²ˆìœ¼ë¡œ ê¸°ë¡ ë</p>
      </div>
      <div class="step-card glass">
        <div class="step-no">4</div>
        <h3>ì—°ì† ê¸°ë¡ í™•ì¸</h3>
        <p>ìŠ¤íŠ¸ë¦­/í‹°ì–´/ë¦¬í¬íŠ¸ë¡œ ë™ê¸° ìœ ì§€</p>
      </div>
    </div>
  </div>
</section>

<!-- PRICING -->
<section id="pricing">
  <div class="container">
    <div class="section-head">
      <span class="kicker">PRICING</span>
      <h2>ê°€ê²©</h2>
      <p>ë¬´ë£Œë¡œ ì‹œì‘í•˜ê³ , íŒ¨í„´ ë¶„ì„ì´ í•„ìš”í•  ë•Œ PROë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”.</p>
    </div>

    <div class="pricing-grid">
      <div class="price-card glass">
        <div class="plan">ë¬´ë£Œ</div>
        <div class="amount">â‚©0</div>
        <div class="desc">ê°€ë³ê²Œ ë£¨í‹´ì„ ë§Œë“¤ê³  ì‹¶ì€ ë¶„ì—ê²Œ</div>
        <ul>
          <li>í•˜ë£¨ 1ìŠµê´€</li>
          <li>ê¸°ë³¸ í…Œë§ˆ ì¶”ì²œ</li>
          <li>ê¸°ë³¸ ìŠ¤íŠ¸ë¦­ í™•ì¸</li>
        </ul>
      </div>

      <div class="price-card glass pro" id="proCard">
        <div class="plan">PRO</div>
        <div class="amount">â‚©3,900</div>
        <div class="desc">ìŠµê´€ì´ ë¬´ë„ˆì§€ëŠ” â€œíŒ¨í„´â€ì„ ì¡ê³  ì‹¶ì€ ë¶„ì—ê²Œ</div>
        <ul>
          <li>ìŠµê´€ ë¬´ì œí•œ + ì»¤ìŠ¤í…€</li>
          <li>ì£¼ê°„ ë¦¬í¬íŠ¸/ë¶„ì„</li>
          <li>í™•ì¥ í†µê³„/íˆìŠ¤í† ë¦¬</li>
        </ul>
        <button id="goProBtn" style="
          margin-top:14px; width:100%; border:none; cursor:pointer;
          padding:14px 14px; border-radius:14px;
          background: linear-gradient(135deg, var(--primary), var(--secondary));
          color:#fff; font-weight:900;
        ">PROë¡œ ì—…ê·¸ë ˆì´ë“œ</button>
      </div>
    </div>
  </div>
</section>

<section id="authSection" style="padding-top: 0;"> <div id="mainContainer">
    
    <div class="auth-card glass-card">
      <div id="auth">
 ...
        <div style="margin-top: 24px;">
           <input id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
           <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
           <div class="auth-actions">
            <button id="signupBtn" class="btn btn-primary" type="button">íšŒì›ê°€ì…</button>
            <button id="signinBtn" class="btn btn-ghost" type="button">ë¡œê·¸ì¸</button>
          </div>
          
          <div class="auth-links">
            <button id="resetPwBtn" class="link-btn" type="button">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
          </div>
          
          <p id="authHint" class="auth-hint">
            ì²˜ìŒì´ë©´ <b>íšŒì›ê°€ì…</b> â†’ ë©”ì¼ ì¸ì¦ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.
          </p>
        </div>
      </div>

      <div id="app" class="glass" style="width:100%; max-width:420px; display:none">
        <h2 id="welcome" style="font-size: 1.5rem;"></h2>
        <div id="tierBadge" style="display:none; margin: 10px 0;">
          <span id="tierText" style="padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.85rem;"></span>
          <p id="streakCount" style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;"></p>
        </div>
        <div id="themeSection">
           <p style="font-size: 0.9rem; font-weight: 700;">ğŸ ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ©</p>
           <div class="tag-container">
              <button class="theme-tag" onclick="selectTheme(this, 'survival')">ğŸš‘ ìƒì¡´</button>
              <button class="theme-tag" onclick="selectTheme(this, 'godsaeng')">âœ¨ ê°“ìƒ</button>
              <button class="theme-tag" onclick="selectTheme(this, 'detox')">ğŸ“± ë””í†¡ìŠ¤</button>
              <button class="theme-tag" onclick="selectTheme(this, 'custom')">â• ì»¤ìŠ¤í…€</button>
           </div>
        </div>
        
        <div id="todaySuggestion" style="
          margin-top:12px;
          font-size:0.85rem;
          opacity:0.75;
        ">
        </div>
        
        <input id="habitName" readonly value="í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”" style="margin-top: 20px; text-align: center;">
        <button id="habitBtn" class="habit">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ</button>
        <p id="status"></p>
        
        <div id="stats" style="display:none;">
          <h3>ğŸ“Š ë‚˜ì˜ ìŠµê´€ í†µê³„</h3>
          <p id="totalDays"></p>
        </div>

        <button id="restoreStreakBtn"
          style="margin-top:10px; padding:10px; border-radius:10px;
                 background:#f59e0b; color:white; border:none; display:none;">
          ğŸ”¥ ì—°ì† ê¸°ë¡ ë³µêµ¬ (PRO)
        </button>
        <div id="weeklyReport" style="display:none; width: 100%; margin-top: 20px; text-align: left;">
          <div id="weeklyReportBody"></div>
          <div id="weeklyReportLocked" style="display:none; padding: 20px; border: 2px dashed #ddd; border-radius: 15px; text-align: center;">
              <div>
                  <span style="font-size: 2rem;">ğŸ”’</span>
                  <div>
                      <b>-ì¼ ì—°ì† ì„±ê³µ</b> ì¤‘ì…ë‹ˆë‹¤!<br>
                      AIê°€ ë¶„ì„í•œ <b>'ì‹¤íŒ¨ íŒ¨í„´ ë¦¬í¬íŠ¸'</b>ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.<br>
                      PRO íšŒì›ì´ ë˜ì–´ í™•ì¸í•´ë³´ì„¸ìš”.
                  </div>
                  <button id="weeklyGoProBtn" style="margin-top: 15px; padding: 10px 20px; border: none; background: var(--primary); color: white; border-radius: 10px; cursor: pointer;">ë¦¬í¬íŠ¸ ì ê¸ˆ í•´ì œí•˜ê¸°</button>
              </div>
          </div>
        </div>

        <button class="logout" id="logoutBtn" style="background:none; color:#94a3b8; font-size:0.8rem; text-decoration:underline;">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div id="adminPanel" class="glass-card" style="display:none;">
      <h3 style="margin-top:0;">ğŸ‘‘ ê´€ë¦¬ì íŒ¨ë„</h3>
      <button id="adminTestBtn">ê´€ë¦¬ì í…ŒìŠ¤íŠ¸</button>
      <button id="cheatStreakBtn">5ì¼ ì—°ì† ì„±ê³µ ì¹˜íŠ¸</button>
      <div id="userList" style="margin-top:20px; max-height: 200px; overflow-y:auto;"></div>
    </div>

  </div>
</section>

<footer>
  <p>Â© 2026 HabitFlow</p>
  <p>support @habitflow.app</p>
</footer>

<div id="bgm">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
    <div style="font-weight:700; font-size:14px;">ğŸµ BGM</div>
    <button id="bgmToggle" style="
      padding: 8px 10px; border-radius: 10px; border: none; cursor:pointer;
      background:#667eea; color:#fff; font-weight:700; font-size:12px;
    ">ì¬ìƒ</button>
  </div>

  <div style="margin-top:10px;">
    <input id="bgmVol" type="range" min="0" max="1" step="0.01" value="0.25" style="width:100%;">
    <div style="display:flex; justify-content:space-between; font-size:12px; opacity:0.7;">
      <span>ë³¼ë¥¨</span><span id="bgmVolText">25%</span>
    </div>
  </div>
  <audio id="bgmAudio" src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lo-fi-116528.mp3" preload="auto" loop></audio>
</div>

<script>
function scrollToAuth() {
  document.getElementById("authSection")
    .scrollIntoView({ behavior: "smooth" });
}

function safeText(id, value) {
  const el = document.getElementById(id);
  if (el) el.textContent = value;
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signOut,
  getIdTokenResult,
  sendPasswordResetEmail,
  sendEmailVerification
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIaroNs2VsMamnnNJV1cP9LdXqIDhl3Ig",
  authDomain: "giiiddd-36340523-3f595.firebaseapp.com",
  projectId: "giiiddd-36340523-3f595",
  storageBucket: "giiiddd-36340523-3f595.firebasestorage.app",
  messagingSenderId: "698901018936",
  appId: "1:698901018936:web:2fb12a7a03cbd844c1e9cd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

// 1. í…Œë§ˆë³„ ìš”ì¼ ìŠµê´€ ë°ì´í„° (0:ì¼ ~ 6:í† )
const themeData = {
  survival: [
    "ğŸ›Œ ë°¤ 11ì‹œ í° ë„ê¸°", "ğŸ’§ ê³µë³µ ë¬¼ í•œ ì”", "ğŸ’Š ì˜ì–‘ì œ ì±™ê²¨ë¨¹ê¸°", 
    "ğŸ¢ ê±°ë¶ëª© ìŠ¤íŠ¸ë ˆì¹­", "ğŸ‘ï¸ ë¨¼ ì‚° ë³´ê¸°", "ğŸ§¹ ì±…ìƒ ìœ„ ë¦¬ì…‹", "ğŸš¶ 30ë¶„ ì‚°ì±…"
  ],
  godsaeng: [
    "ğŸ“… ë‹¤ìŒ ì£¼ ê³„íš ì§œê¸°", "ğŸ›ï¸ ì´ë¶ˆ ì •ë¦¬í•˜ê¸°", "ğŸ’° ê°€ê³„ë¶€ ì ê¸°", 
    "ğŸ“š ì±… 2í˜ì´ì§€ ì½ê¸°", "ğŸ—£ï¸ ì˜ë‹¨ì–´ 1ê°œ ì™¸ìš°ê¸°", "ğŸ“ ê°ì‚¬ ì¼ê¸° 3ì¤„", "ğŸ§¹ ë°© ì²­ì†Œí•˜ê¸°"
  ],
  detox: [
    "ğŸ“ ë‚´ì¼ í•  ì¼ ì†ê¸°ë¡", "ğŸ“µ ê¸°ìƒ í›„ 10ë¶„ ë…¸í°", "ğŸ½ï¸ ì‹ì‚¬ ì¤‘ ì˜ìƒ ê¸ˆì§€", 
    "ğŸ§ ì´ì–´í° ì—†ì´ ê±·ê¸°", "ğŸ“± ìŠ¤í¬ë¦° íƒ€ì„ í™•ì¸", "ğŸ§˜ 5ë¶„ ëª…ìƒ", "ğŸ“µ ë””ì§€í„¸ í”„ë¦¬ 1ì‹œê°„"
  ]
};

// 2. í…Œë§ˆ ì„ íƒ í•¨ìˆ˜ (ì „ì—­ ë²”ìœ„ í˜¸ì¶œì„ ìœ„í•´ windowì— í• ë‹¹)
window.selectTheme = async (el, themeType) => {
  const user = auth.currentUser;
  const tokenResult = await user.getIdTokenResult();
  const isPro = tokenResult.claims.pro === true;
  const habitInput = document.getElementById("habitName");
  const dayIdx = new Date().getDay();

  // ê¸°ì¡´ í™œì„±í™” ì œê±°
  document.querySelectorAll('.theme-tag')
    .forEach(tag => tag.classList.remove('active'));

  if (themeType === 'custom') {
    if (!isPro) {
      alert("ğŸ”’ ì»¤ìŠ¤í…€ ìŠµê´€ì€ PRO ì „ìš©ì…ë‹ˆë‹¤.");
      return;
    }
    habitInput.readOnly = false;
    habitInput.value = "";
    habitInput.placeholder = "ì›í•˜ëŠ” ìŠµê´€ì„ ì…ë ¥í•˜ì„¸ìš”";
    habitInput.style.background = "#fff";
    habitInput.focus();
  } else {
    habitInput.readOnly = true;
    habitInput.style.background = "#eee";
    habitInput.value = themeData[themeType][dayIdx];
  }

  if (el) el.classList.add('active');
};

function showTodaySuggestion() {
  const dayIdx = new Date().getDay();
  const suggestion =
    themeData.survival[dayIdx]; // ê¸°ë³¸ ì¶”ì²œì€ ìƒì¡´íŒ©

  const el = document.getElementById("todaySuggestion");
  if (!el) return;

  el.innerHTML = `
    ğŸ‘‰ ì˜¤ëŠ˜ ì¶”ì²œ ìŠµê´€: <b>${suggestion}</b><br>
    <span style="font-size:0.75rem;">(ì˜¤ëŠ˜ ìš”ì¼ ê¸°ì¤€ ìë™ ì¶”ì²œ)</span>
  `;
}

// DOM Elements
const email = document.getElementById("email");
const password = document.getElementById("password");

const signinBtn = document.getElementById("signinBtn");
const resetPwBtn = document.getElementById("resetPwBtn");
const authHint = document.getElementById("authHint");
const authDiv = document.getElementById('auth');
const appDiv = document.getElementById('app');
const habitBtn = document.getElementById('habitBtn');
const status = document.getElementById('status');
const welcome = document.getElementById('welcome');
const logoutBtn = document.getElementById('logoutBtn');
const proCard = document.getElementById("proCard");
const goProBtn = document.getElementById("goProBtn");
const statsDiv = document.getElementById("stats");
const totalDays = document.getElementById("totalDays");
const adminPanel = document.getElementById("adminPanel");
const adminTestBtn = document.getElementById("adminTestBtn");
const userListDiv = document.getElementById("userList");
const darkModeToggle = document.getElementById("darkModeToggle");
const restoreBtn = document.getElementById("restoreStreakBtn");

async function updateStreakProtectionUI(uid, isPro) {
  if (!restoreBtn) return;

  if (!isPro) {
    restoreBtn.style.display = "none";
    return;
  }

  const snap = await getDoc(doc(db, "users", uid));
  const left = snap.data()?.streakProtectionLeft ?? 2;

  restoreBtn.style.display = left > 0 ? "block" : "none";
  restoreBtn.textContent = `ğŸ”¥ ì—°ì† ê¸°ë¡ ë³µêµ¬ (${left}íšŒ ë‚¨ìŒ)`;
}

restoreBtn.onclick = async () => {
  const user = auth.currentUser;
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);
  let left = snap.data()?.streakProtectionLeft ?? 2;

  if (left <= 0) {
    alert("ì´ë²ˆ ë‹¬ ë³µêµ¬ê¶Œì„ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.");
    return;
  }

  const yesterday = dateKeyFromOffset(1);
  await setDoc(doc(db, "users", user.uid, "habits", yesterday), {
    done: true,
    restored: true
  });

  await updateDoc(ref, { streakProtectionLeft: left - 1 });
  alert("ğŸ”¥ ì–´ì œ ê¸°ë¡ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  location.reload();
};

// âœ… ì£¼ê°„ ë¦¬í¬íŠ¸ ìš”ì†Œ
const weeklyReport = document.getElementById("weeklyReport");
const weeklyReportBody = document.getElementById("weeklyReportBody");
const weeklyReportLocked = document.getElementById("weeklyReportLocked");
const weeklyGoProBtn = document.getElementById("weeklyGoProBtn");

const todayEl = document.getElementById("today");
const todayStr = new Date().toISOString().slice(0, 10);
if (todayEl) todayEl.textContent = `ğŸ“… const email =${todayStr}`;

function requireEmailPass() {
  if (!email?.value || !password?.value) {
    alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return false;
  }
  if (password.value.length < 6) {
    alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
    return false;
  }
  return true;
}

// 1) íšŒì›ê°€ì… (ê°€ì… í›„ ì¸ì¦ë©”ì¼ ë°œì†¡)
signupBtn?.addEventListener("click", async () => {
  if (!requireEmailPass()) return;

  try {
    const cred = await createUserWithEmailAndPassword(auth, email.value, password.value);
    await sendEmailVerification(cred.user);

    alert("âœ… íšŒì›ê°€ì… ì™„ë£Œ!\nğŸ“© ì¸ì¦ ë©”ì¼ì„ ë³´ëƒˆì–´ìš”.\në©”ì¼ ì¸ì¦ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
    if (authHint) authHint.innerHTML = "ğŸ“© ì¸ì¦ ë©”ì¼ ë°œì†¡ ì™„ë£Œ! ë©”ì¼í•¨ì—ì„œ ì¸ì¦ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.";

    await signOut(auth);
  } catch (error) {
    if (error.code === "auth/email-already-in-use") alert("ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
    else if (error.code === "auth/invalid-email") alert("ì˜ëª»ëœ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.");
    else {
      console.error("Signup error:", error.code, error.message);
      alert("íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.code);
    }
  }
});

// 2) ë¡œê·¸ì¸ (ì´ë©”ì¼ ì¸ì¦ ì•ˆ í–ˆìœ¼ë©´ ì°¨ë‹¨)
signinBtn?.addEventListener("click", async () => {
  if (!requireEmailPass()) return;

  try {
    const cred = await signInWithEmailAndPassword(auth, email.value, password.value);

    if (!cred.user.emailVerified) {
      alert("ğŸ“© ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.\në©”ì¼í•¨ì—ì„œ ì¸ì¦ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì„¸ìš”.");
      await signOut(auth);
      return;
    }

    alert("âœ… ë¡œê·¸ì¸ ì„±ê³µ!");
  } catch (error) {
    if (error.code === "auth/user-not-found") alert("ê°€ì…ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
    else if (error.code === "auth/wrong-password") alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    else {
      console.error("Signin error:", error.code, error.message);
      alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.code);
    }
  }
});

// 3) ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
resetPwBtn?.addEventListener("click", async () => {
  if (!email?.value) {
    alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ì´ë©”ì¼ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  try {
    await sendPasswordResetEmail(auth, email.value);
    alert("ğŸ“© ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤. ë©”ì¼í•¨ì„ í™•ì¸í•˜ì„¸ìš”!");
  } catch (error) {
    if (error.code === "auth/invalid-email") alert("ì˜ëª»ëœ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.");
    else if (error.code === "auth/user-not-found") alert("í•´ë‹¹ ì´ë©”ì¼ë¡œ ê°€ì…ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.");
    else {
      console.error("ResetPW error:", error.code, error.message);
      alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì¤‘ ì˜¤ë¥˜: " + error.code);
    }
  }
});

// Logout Handler
logoutBtn.onclick = () => signOut(auth);

// Auth State Monitor
onAuthStateChanged(auth, async user => {
  if (!user) {
    authDiv.style.display = 'block';
    appDiv.style.display = 'none';
    if (adminPanel) adminPanel.style.display = 'none'; // ë¡œê·¸ì•„ì›ƒì‹œ ê´€ë¦¬ì íŒ¨ë„ ìˆ¨ê¹€
    return;}
    if (user && !user.emailVerified) {
  alert("ğŸ“© ì´ë©”ì¼ ì¸ì¦ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë©”ì¼í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
  await signOut(auth);
  return;
}

  authDiv.style.display = 'none';
  appDiv.style.display = 'block';
  showTodaySuggestion(); // Call the new function here

  try {
    const tokenResult = await getIdTokenResult(user, true);
    const isAdmin = tokenResult.claims.admin === true;
    const isPro = tokenResult.claims.pro === true;

    console.log("admin?", isAdmin, "pro?", isPro);

    // Admin UI
    if (isAdmin) {
      if (adminPanel) adminPanel.style.display = "block";
      welcome.innerText = `ğŸ‘‘ ê´€ë¦¬ì ${user.email}`;
      loadAllUsers();
    } else {
      if (adminPanel) adminPanel.style.display = "none";
      welcome.innerText = `ğŸ‘‹ ${user.email}`;
    }

    // PRO UI
    if (isPro) {
      if (proCard) proCard.style.display = "none";
      if (statsDiv) statsDiv.style.display = "block";
      safeText("status", "ğŸŒŸ PRO íšŒì›ì…ë‹ˆë‹¤");
      loadStats(user.uid); // PROì¸ ê²½ìš° í†µê³„ ë¡œë“œ
    } else {
      if (proCard) proCard.style.display = "block";
      if (statsDiv) statsDiv.style.display = "none";
      safeText("status", "ë¬´ë£Œ íšŒì› (í•˜ë£¨ 1ìŠµê´€)");
    }

    // âœ… ì£¼ê°„ ë¦¬í¬íŠ¸ ì—…ë°ì´íŠ¸
    await updateWeeklyReport(user.uid, isPro);

    // âœ… 7ì¼ ì—°ì† ë‹¬ì„± ì‹œ PRO íŒì—…(ë¬´ë£Œ ìœ ì €ë§Œ)
    await maybeShow7DayPopup(user.uid, isPro);
    
    // í‹°ì–´ UI ì—…ë°ì´íŠ¸
    const streak = await getConsecutiveStreak(user.uid);
    updateTierUI(streak);

    // âœ… ì—°ì† ê¸°ë¡ ë³µêµ¬ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
    await updateStreakProtectionUI(user.uid, isPro);

    // âœ… ì´ë²ˆ ë‹¬ ìŠµê´€ ìº˜ë¦°ë” ë Œë”ë§
    await renderCalendar(user.uid, isPro);
  } catch (e) {
    console.error("Token error:", e);
  }
});

// 2. ìŠµê´€ ì™„ë£Œ ë²„íŠ¼ ë¡œì§ í™•ì¥
if (habitBtn) {
  habitBtn.onclick = async () => {
  const user = auth.currentUser;
  if(!user) return;

  const habitName = document.getElementById("habitName").value;
  if(habitName === "í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”" || !habitName) {
    alert("ìŠµê´€ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }

  const ref = doc(db, "users", user.uid, "habits", todayStr);
  
  await setDoc(ref, {
    done: true,
    name: habitName, // ì–´ë–¤ ìŠµê´€ì„ ì™„ë£Œí–ˆëŠ”ì§€ ì´ë¦„ ì €ì¥
    timestamp: new Date()
  });

  // [ì¶”ê°€] ì—°ì† ì„±ê³µ íšŸìˆ˜ ê°€ì ¸ì˜¤ê¸° ë° í‹°ì–´ ì—…ë°ì´íŠ¸
  const streak = await getConsecutiveStreak(user.uid); // ê¸°ì¡´ì— ë§Œë“  í•¨ìˆ˜ í˜¸ì¶œ
  updateTierUI(streak);
  
  // [ì¶”ê°€] ì§€ëŠ¥í˜• ë¦¬ë§ˆì¸ë“œ ì˜ˆì•½ (ìŠ¤ì¼€ì¤„ëŸ¬ í˜¸ì¶œ)
  // ì‚¬ìš©ìê°€ 'ì§€ê¸ˆ' ì™„ë£Œí–ˆë‹¤ë©´, ë‚´ì¼ ì´ ì‹œê°„ì—ë„ ì™„ë£Œí•  í™•ë¥ ì´ ë†’ìŒ!
  const now = new Date();
  const nextTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
  
  // ì•„ë˜ëŠ” ì œê°€(ëª¨ë¸ì´) ë‚˜ì¤‘ì— ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìŠ¤ì¼€ì¤„ë§ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.
  // ì‹¤ì œ ì„œë¹„ìŠ¤ ì‹œì—ëŠ” ë°±ì—”ë“œ ì•Œë¦¼ APIë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ ì•„ë˜ ë„êµ¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  scheduleNextReminder(habitName);

  celebrate(); // íŒŒí‹° íš¨ê³¼
};

if (goProBtn) {
  goProBtn.onclick = () => {
    alert("ğŸ‘‘ ì´ ë²„íŠ¼ì€ ê´€ë¦¬ì í™•ì¸ìš©ì…ë‹ˆë‹¤.\nPRO ê¶Œí•œì€ ì„œë²„(ê´€ë¦¬ì)ì—ì„œë§Œ ë¶€ì—¬ë©ë‹ˆë‹¤.");
  };
}

if (adminTestBtn) {
  adminTestBtn.onclick = () => alert("ğŸ‘‘ ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥ ì •ìƒ ì‘ë™!");
}

// Dark Mode Logic
function setDarkMode(isDark) {
  if (isDark) {
    document.body.classList.add('dark-mode');
    localStorage.setItem('darkMode', 'enabled');
  } else {
    document.body.classList.remove('dark-mode');
    localStorage.setItem('darkMode', 'disabled');
  }
}

const savedDarkMode = localStorage.getItem('darkMode');
if (savedDarkMode === 'enabled') {
  setDarkMode(true);
} else if (savedDarkMode === 'disabled') {
  setDarkMode(false);
} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  setDarkMode(true);
}

darkModeToggle.onclick = () => {
  setDarkMode(!document.body.classList.contains('dark-mode'));
};

// Functions
function dateKeyFromOffset(daysAgo) {
  const d = new Date();
  d.setDate(d.getDate() - daysAgo);
  return d.toISOString().slice(0, 10);
}

async function getConsecutiveStreak(uid) {
  let count = 0;
  let date = new Date();

  while (true) {
    const key = date.toISOString().slice(0, 10);
    const snap = await getDoc(doc(db, "users", uid, "habits", key));
    if (!snap.exists()) break;
    count++;
    date.setDate(date.getDate() - 1);
  }
  return count;
}

// [ìˆ˜ì •ë¨] AI ë¶„ì„ ë¡œì§ì´ í¬í•¨ëœ ë¦¬í¬íŠ¸ í•¨ìˆ˜
async function updateWeeklyReport(uid, isPro) {
  if (!weeklyReport || !weeklyReportBody || !weeklyReportLocked) return;

  // 1. ìµœê·¼ 7ì¼ ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„ ì¤€ë¹„
  let successCount = 0;
  const days = [];
  const dayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
  
  // ìš”ì¼ë³„ ì‹¤íŒ¨ íšŸìˆ˜ ì¹´ìš´íŒ… (0:ì¼ ~ 6:í† )
  const failCountsPerDay = [0, 0, 0, 0, 0, 0, 0]; 

  for (let i = 0; i < 7; i++) {
    const key = dateKeyFromOffset(i);
    const snap = await getDoc(doc(db, "users", uid, "habits", key));
    const done = snap.exists();
    
    // ë‚ ì§œ ê°ì²´ ìƒì„±í•˜ì—¬ ìš”ì¼ ì¸ë±ìŠ¤ ì¶”ì¶œ
    const dateObj = new Date(key);
    const dayIdx = dateObj.getDay(); 

    if (done) {
      successCount++;
    } else {
      failCountsPerDay[dayIdx]++; // ì‹¤íŒ¨í•œ ìš”ì¼ ì¹´ìš´íŠ¸ ì¦ê°€
    }
    
    days.push({ key, done, dayName: dayNames[dayIdx] });
  }

  const streak = await getConsecutiveStreak(uid);

  // 2. í‘œì‹œ ì¡°ê±´: 3ì¼ ì´ìƒ ì—°ì† ì„±ê³µ ì‹œ 'ë§›ë³´ê¸°'ë¡œë¼ë„ í‹€ì„ ë³´ì—¬ì¤Œ (ë™ê¸°ë¶€ì—¬ ìœ„í•´ 7ì¼->3ì¼ë¡œ ì™„í™” ì¶”ì²œ)
  if (streak < 3) {
    weeklyReport.style.display = "none";
    return;
  }
  weeklyReport.style.display = "block";

  // 3. ë¬´ë£Œ íšŒì›ì¼ ê²½ìš° (ì ê¸ˆ í™”ë©´)
  if (!isPro) {
    weeklyReportBody.innerHTML = "";
    weeklyReportLocked.style.display = "block";

    // í…ìŠ¤íŠ¸ë¥¼ ë” ìê·¹ì ìœ¼ë¡œ ë³€ê²½
    weeklyReportLocked.querySelector("div > div:nth-child(2)").innerHTML = 
      `<b>${streak}ì¼ ì—°ì† ì„±ê³µ</b> ì¤‘ì…ë‹ˆë‹¤!<br>
      AIê°€ ë¶„ì„í•œ <b>'ì‹¤íŒ¨ íŒ¨í„´ ë¦¬í¬íŠ¸'</b>ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.<br>
      PRO íšŒì›ì´ ë˜ì–´ í™•ì¸í•´ë³´ì„¸ìš”.`;

    if (weeklyGoProBtn) {
      weeklyGoProBtn.onclick = () => {
        showProModal();
      };
    }
    return;
  }

  // 4. PRO íšŒì›ì¼ ê²½ìš° (AI ë¶„ì„ ê²°ê³¼ ì¶œë ¥)
  weeklyReportLocked.style.display = "none";

  const rate = Math.round((successCount / 7) * 100);
  
  // ê°€ì¥ ë§ì´ ì‹¤íŒ¨í•œ ìš”ì¼ ì°¾ê¸° (ìµœëŒ€ê°’ ì¸ë±ìŠ¤ ì°¾ê¸°)
  let maxFailures = -1;
  let worstDayIdx = -1;
  
  failCountsPerDay.forEach((count, idx) => {
    if (count > maxFailures) {
      maxFailures = count;
      worstDayIdx = idx;
    }
  });
  
  const worstDayName = (maxFailures > 0) ? dayNames[worstDayIdx] : null;

  // AI ì¡°ì–¸ ìƒì„± ë¡œì§
  let aiAdvice = "";
  if (rate === 100) {
    aiAdvice = "ì™„ë²½í•©ë‹ˆë‹¤! ì´ëŒ€ë¡œë©´ <b>'ìŠµê´€ ë§ˆìŠ¤í„°'</b> ì¹­í˜¸ê¹Œì§€ ì–¼ë§ˆ ì•ˆ ë‚¨ì•˜ì–´ìš”.";
  } else if (worstDayName) {
    if (worstDayName === "ê¸ˆ") aiAdvice = "<b>ë¶ˆê¸ˆ</b>ì´ë¼ ë§ˆìŒì´ ëœ¨ê¸° ì‰½êµ°ìš”. ê¸ˆìš”ì¼ ëª©í‘œëŠ” ì¡°ê¸ˆ ë” ì‘ê²Œ ì¡ì•„ë³¼ê¹Œìš”?";
    else if (worstDayName === "ì›”") aiAdvice = "<b>ì›”ìš”ë³‘</b>ì´ ìŠµê´€ê¹Œì§€ ë°©í•´í•˜ê³  ìˆì–´ìš”. ì¼ìš”ì¼ ë°¤ì— ë¯¸ë¦¬ ì¤€ë¹„í•´ë‘ë©´ ì–´ë–¨ê¹Œìš”?";
    else if (worstDayName === "í† " || worstDayName === "ì¼") aiAdvice = "ì£¼ë§ì—ëŠ” ë£¨í‹´ì´ ê¹¨ì§€ê¸° ì‰½ì£ . <b>ì˜¤ì „ ì¤‘ì— ë¯¸ë¦¬ í•´ì¹˜ìš°ëŠ” ì „ëµ</b>ì´ í•„ìš”í•©ë‹ˆë‹¤!";
    else aiAdvice = `íšŒì›ë‹˜ì€ ì£¼ë¡œ <b>${worstDayName}ìš”ì¼</b>ì— ì—ë„ˆì§€ê°€ ë–¨ì–´ì§‘ë‹ˆë‹¤. ì´ë‚ ì€ ì•Œë¦¼ì„ 10ë¶„ ì¼ì° ë§ì¶°ë³´ì„¸ìš”.`;
  } else {
    aiAdvice = "ì¡°ê¸ˆë§Œ ë” ë¶„ë°œí•˜ì„¸ìš”! ê¾¸ì¤€í•¨ì´ ì¬ëŠ¥ì„ ì´ê¹ë‹ˆë‹¤.";
  }

  // ë¦¬ìŠ¤íŠ¸ HTML ìƒì„±
  const listHTML = days.reverse().map(d => 
    `<div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:4px; color:var(--text-color);">
       <span>${d.key} (${d.dayName})</span>
       <span>${d.done ? "âœ… ì„±ê³µ" : "<span style='color:#e53e3e; opacity:0.6;'>ì‹¤íŒ¨</span>"}</span>
     </div>`
  ).join("");

  // ìµœì¢… HTML ì£¼ì…
  weeklyReportBody.innerHTML = `
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
      <span style="font-weight:900; font-size:16px;">ì´ë²ˆ ì£¼ ì„±ê³µë¥  <span style="color:#6366f1;">${rate}%</span></span>
      <span style="font-size:12px; opacity:0.7;">ğŸ”¥ ${streak}ì¼ ì—°ì†</span>
    </div>

    <div class="ai-coach-card">
      <div class="ai-coach-badge">ğŸ¤– AI Habit Coach</div>
      <div class="ai-advice-text">
        ${rate === 100 
          ? aiAdvice 
          : `íšŒì›ë‹˜ì€ íŠ¹íˆ <span class="worst-day-highlight">${worstDayName}ìš”ì¼</span>ì— ì•½í•˜ì‹œë„¤ìš”.<br>ğŸ‘‰ ${aiAdvice}`}
      </div>
    </div>
    <div style="margin-top:12px; padding:12px; border-radius:10px; background:var(--bg-color); border:1px solid var(--input-border);">
      <div style="font-size:12px; opacity:0.6; margin-bottom:8px;">ìƒì„¸ ê¸°ë¡</div>
      ${listHTML}
    </div>
  `;
}

async function maybeShow7DayPopup(uid, isPro) {
  if (isPro) return;

  const streak = await getConsecutiveStreak(uid);
  if (streak < 7) return;

  // âœ… ê°™ì€ ì£¼ì— íŒì—… ë°˜ë³µ ë°©ì§€ (ì£¼ì°¨ í‚¤)
  const now = new Date();
  const weekKey = `${now.getFullYear()}-${Math.ceil((now.getDate()) / 7)}-${now.getMonth()+1}`;
  const storageKey = `hf_7day_popup_${uid}_${weekKey}`;

  if (localStorage.getItem(storageKey) === "shown") return;
  localStorage.setItem(storageKey, "shown");

  showProModal();

  // ìŠ¤í¬ë¡¤ë¡œ ë¦¬í¬íŠ¸ ì˜ì—­ ë³´ì—¬ì£¼ê¸°
  if (weeklyReport) weeklyReport.scrollIntoView({ behavior: "smooth", block: "center" });
}

async function loadStats(uid){
  let count=0;
  let date=new Date();
  while(true){
    const key=date.toISOString().slice(0,10);
    const snap=await getDoc(doc(db,"users",uid,"habits",key));
    if(!snap.exists()) break;
    count++; date.setDate(date.getDate()-1);
  }
  safeText("totalDays", `ğŸ”¥ ì—°ì† ì„±ê³µ ${count}ì¼`);
}

async function loadAllUsers() {
  if (!userListDiv) return;

  userListDiv.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

  try {
    const snap = await getDocs(collection(db, "users"));
    userListDiv.innerHTML = "";

    snap.forEach(docSnap => {
      const data = docSnap.data();
      const uid = docSnap.id;

      const box = document.createElement("div");
      box.style.background = "#fff";
      box.style.padding = "12px";
      box.style.borderRadius = "10px";
      box.style.marginBottom = "10px";
      box.style.color = "#333";

      box.innerHTML = `
        <div style="font-size:12px; word-break:break-all;"><b>UID</b>: ${uid}</div>
        <div style="margin:5px 0;"><b>PRO</b>: ${data.isPro ? "âœ…" : "âŒ"}</div>
        <button class="toggleProBtn" style="padding:5px 10px; cursor:pointer;">
          ${data.isPro ? "PRO í•´ì œ" : "PRO ë¶€ì—¬"}
        </button>
      `;

      box.querySelector(".toggleProBtn").onclick = async () => {
        await updateDoc(doc(db, "users", uid), {
          isPro: !data.isPro
        });
        alert("ë³€ê²½ ì™„ë£Œ");
        loadAllUsers();
      };

      userListDiv.appendChild(box);
    });
  } catch (error) {
    console.error("User load error:", error);
          userListDiv.innerHTML = "ê¶Œí•œì´ ì—†ê±°ë‚˜ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
      }
    }
    
    async function renderCalendar(uid, isPro) {
      const grid = document.getElementById("calendarGrid");
      const section = document.getElementById("calendarSection");
      if (!grid || !section) return;
    
      if (!isPro) {
        section.style.display = "none";
        alert("PROë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”");
        return;
      }    
      section.style.display = "block";
      grid.innerHTML = "";
    
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
    
      for (let d = 1; d <= 31; d++) {
        const date = new Date(year, month, d);
        if (date.getMonth() !== month) break;
    
        const key = date.toISOString().slice(0, 10);
        const snap = await getDoc(doc(db, "users", uid, "habits", key));
    
        const cell = document.createElement("div");
        cell.style.padding = "10px";
        cell.style.borderRadius = "8px";
        cell.style.textAlign = "center";
        cell.style.fontSize = "12px";
        cell.style.background = snap.exists() ? "#22c55e" : "#e5e7eb";
        cell.style.color = snap.exists() ? "white" : "#64748b";
        cell.textContent = d;
    
        grid.appendChild(cell);
      }
    }
// ìŠµê´€ ì™„ë£Œ ì‹œ ê°„ë‹¨í•œ ì´í™íŠ¸ í•¨ìˆ˜
function celebrate() {
  const btn = document.getElementById("habitBtn");
  btn.style.transform = "scale(1.1)";
  setTimeout(() => { btn.style.transform = "scale(1)"; }, 200);
  
  // ë¸Œë¼ìš°ì € ê¸°ë³¸ ì•Œë¦¼ ëŒ€ì‹  ì»¤ìŠ¤í…€ ë©”ì‹œì§€
  status.innerHTML = `<span style="color:#22c55e; font-weight:bold; font-size:1.2em;">ğŸ‰ ë¯¸ì…˜ ì™„ë£Œ! ë‚´ì¼ë„ í•¨ê»˜í•´ìš”.</span>`;
}

// ===== í‹°ì–´ UI =====
  function updateTierUI(streak){
    const tierBadge = document.getElementById("tierBadge");
    const tierText = document.getElementById("tierText");
    const streakCount = document.getElementById("streakCount");
    if (!tierBadge || !tierText || !streakCount) return;

    tierBadge.style.display = "block";
    streakCount.textContent = `ğŸ”¥ í˜„ì¬ ${streak}ì¼ ì—°ì† ì„±ê³µ ì¤‘!`;

    let label = "ğŸ¥‰ BRONZE";
    let cls = "tier-bronze";
    if (streak >= 30) { label = "ğŸ† GRANDMASTER"; cls = "tier-master"; }
    else if (streak >= 20) { label = "ğŸ’ DIAMOND"; cls = "tier-diamond"; }
    else if (streak >= 14) { label = "âœ¨ PLATINUM"; cls = "tier-platinum"; }
    else if (streak >= 7) { label = "ğŸ¥‡ GOLD"; cls = "tier-gold"; }
    else if (streak >= 3) { label = "ğŸ¥ˆ SILVER"; cls = "tier-silver"; }

    tierText.textContent = label;
    tierText.className = ""; // reset
    tierText.classList.add("badge", cls);
  }

// ìŠµê´€ ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ ì•Œë¦¼ ì˜ˆì•½ (ê°€ìƒ ë¡œì§)
function scheduleNextReminder(habitName) {
  console.log(`[AI ì•Œë¦¼ ì˜ˆì•½] ë‚´ì¼ ì´ ì‹œê°„ì— '${habitName}' ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.`);
  // ì‹¤ì œ ì„œë¹„ìŠ¤ ì‹œ ì•Œë¦¼ API í˜¸ì¶œ ìœ„ì¹˜
}

function showProModal() {
  const modal = document.getElementById("proModal");
  if (modal) modal.style.display = "flex";
}

// [ì¶”ê°€ ì½”ë“œ] 5ì¼ ì—°ì† ì„±ê³µ ì¹˜íŠ¸í‚¤ ë¡œì§
const cheatStreakBtn = document.getElementById("cheatStreakBtn");

if (cheatStreakBtn) {
  cheatStreakBtn.onclick = async () => {
    const user = auth.currentUser;
    if (!user) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
      return;
    }

    const confirmCheat = confirm("ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ì§€ë‚œ 5ì¼ê°„ì˜ ë°ì´í„°ë¥¼ 'ì„±ê³µ'ìœ¼ë¡œ ê°•ì œ ì¡°ì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if (!confirmCheat) return;

    try {
      // 0ì¼ì „(ì˜¤ëŠ˜) ~ 4ì¼ì „(ê³¼ê±°)ê¹Œì§€ ì´ 5ì¼ ë£¨í”„
      for (let i = 0; i < 5; i++) {
        // dateKeyFromOffset í•¨ìˆ˜ëŠ” ê¸°ì¡´ ì½”ë“œì— ìˆìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        const dateStr = dateKeyFromOffset(i); 
        
        // Firestoreì— { done: true } ì €ì¥
        await setDoc(doc(db, "users", user.uid, "habits", dateStr), {
          done: true
        });
        console.log(`${dateStr} ì²˜ë¦¬ ì™„ë£Œ`);
      }

      alert("ğŸ‰ 5ì¼ ì—°ì† ì„±ê³µ ë°ì´í„° ìƒì„± ì™„ë£Œ!\nìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
      location.reload(); // í™”ë©´ ìƒˆë¡œê³ ì¹¨í•´ì„œ ê²°ê³¼ ë°”ë¡œ ë°˜ì˜

    } catch (error) {
      console.error("ì¹˜íŠ¸í‚¤ ì—ëŸ¬:", error);
      alert("ì—ëŸ¬ ë°œìƒ: " + error.message);
    }
  };
}
</script>

<script>
(() => {
  const audio = document.getElementById("bgmAudio");
  const btn = document.getElementById("bgmToggle");
  const vol = document.getElementById("bgmVol");
  const volText = document.getElementById("bgmVolText");

  if (!audio || !btn || !vol || !volText) return;

  // Set initial volume
  audio.volume = Number(vol.value);

  btn.addEventListener("click", async () => {
    try {
      if (audio.paused) {
        await audio.play();
        btn.textContent = "ì¼ì‹œì •ì§€";
      } else {
        audio.pause();
        btn.textContent = "ì¬ìƒ";
      }
    } catch (e) {
      alert("ë¸Œë¼ìš°ì € ì •ì±…ìƒ ìë™ì¬ìƒì´ ë§‰í˜€ìˆì–´ìš”. ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ì£¼ì„¸ìš”!");
      console.log(e);
    }
  });

  vol.addEventListener("input", () => {
    audio.volume = Number(vol.value);
    volText.textContent = Math.round(audio.volume * 100) + "%" ;
  });
})();
</script>
<div id="proModal" style="
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,0.5);
  align-items:center; justify-content:center;
  z-index:999;">
  <div style="
    background:white; padding:30px;
    border-radius:20px; max-width:360px; width:90%;
    text-align:center;">
    <h2>ğŸ‘‘ PROë¡œ ì„±ì¥ ê°€ì†</h2>
    <p style="opacity:0.7;">
      ì—°ì† ê¸°ë¡ ë³´í˜¸<br>
      ì›”ê°„ ìº˜ë¦°ë”<br>
      AI ì£¼ê°„ ë¦¬í¬íŠ¸
    </p>
    <button id="proModalBtn"
      style="margin-top:15px; width:100%;
      padding:14px; border-radius:12px;
      background:#6366f1; color:white; border:none;">
      PRO ì‹œì‘í•˜ê¸°
    </button>
    <p style="margin-top:10px; font-size:12px; cursor:pointer;"
       onclick="document.getElementById('proModal').style.display='none'">
      ë‚˜ì¤‘ì—
    </p>
  </div>
</div>
</body>
</html>