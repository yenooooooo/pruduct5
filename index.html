<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>HabitFlow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@latest/dist/web/static/pretendard.css">
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* ====== Base Variables & Reset ====== */
    :root {
      --bg-color: #f8fafc;
      --text-main: #0f172a;
      --muted: #64748b;
      --card-bg: rgba(255, 255, 255, 0.72);
      --card-border: rgba(15, 23, 42, 0.08);
      --primary: #6366f1;
      --secondary: #a855f7;
      --shadow: 0 20px 25px -5px rgb(0 0 0 / .08), 0 8px 10px -6px rgb(0 0 0 / .06);
    }

    .dark-mode {
      --bg-color: #020617;
      --text-main: #f8fafc;
      --muted: #94a3b8;
      --card-bg: rgba(2, 6, 23, 0.55);
      --card-border: rgba(148, 163, 184, 0.12);
      --shadow: 0 20px 25px -5px rgb(0 0 0 / .45), 0 8px 10px -6px rgb(0 0 0 / .35);
    }

    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg-color); color: var(--text-main); font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; transition: background 0.3s, color 0.3s; }

    /* ====== Layout ====== */
    section { width: 100%; padding: 84px 20px; }
    .container { width: 100%; max-width: 1080px; margin: 0 auto; }
    
    /* Header */
    header { position: absolute; top: 0; left: 0; right: 0; padding: 20px 0; z-index: 10; }
    .header-inner { display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
    .logo { font-weight: 900; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
    .logo-badge { width: 12px; height: 12px; background: var(--primary); border-radius: 50%; }
    
    nav { display: flex; gap: 10px; align-items: center; }
    .pc-only { display: none; }
    @media(min-width: 768px) { .pc-only { display: block; text-decoration: none; color: var(--text-main); font-weight: 700; font-size: 14px; margin-right: 10px; } }

    /* Section Head */
    .section-head { text-align: center; margin-bottom: 36px; }
    .section-head .kicker { display: inline-block; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 800; letter-spacing: -0.2px; background: rgba(99, 102, 241, 0.12); color: var(--primary); }
    .section-head h2 { margin: 12px 0 8px; font-size: 28px; letter-spacing: -0.6px; }
    .section-head p { margin: 0; color: var(--muted); font-size: 15px; line-height: 1.7; }

    /* Glass Effect */
    .glass { background: var(--card-bg); border: 1px solid var(--card-border); box-shadow: var(--shadow); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); border-radius: 22px; transition: 0.25s ease; }
    .glass:hover { transform: translateY(-4px); }

    /* ====== Hero ====== */
    .hero { padding: 140px 20px 80px; background: radial-gradient(800px circle at 80% -20%, rgba(168, 85, 247, 0.15), transparent 60%); }
    .hero-grid { display: grid; grid-template-columns: 1fr; gap: 48px; align-items: center; }
    @media(min-width: 900px) { .hero-grid { grid-template-columns: 1.2fr 1fr; } }

    .hero-pill { display: inline-block; padding: 8px 14px; border-radius: 999px; font-size: 13px; font-weight: 800; background: rgba(99, 102, 241, 0.12); color: var(--primary); }
    .hero-title { font-size: 40px; line-height: 1.2; letter-spacing: -1px; margin: 18px 0; }
    .hero-desc { font-size: 16px; color: var(--muted); line-height: 1.7; margin-bottom: 24px; }
    
    .hero-actions { display: flex; gap: 12px; }
    .hero-metrics { display: flex; gap: 14px; margin-top: 28px; }
    .metric-card { padding: 14px 18px; border-radius: 16px; background: rgba(255,255,255,0.5); border: 1px solid var(--card-border); display: flex; flex-direction: column; gap: 4px; font-size: 13px; }
    .hero-right { padding: 26px; }
    .recommend-card { background: rgba(255,255,255,0.8); border-radius: 16px; padding: 16px; margin-top: 14px; display: flex; flex-direction: column; gap: 6px; font-size: 14px; color: #000; }

    /* ====== Problems & Features ====== */
    .problem-grid, .pricing-grid { display: grid; grid-template-columns: 1fr; gap: 16px; margin-top: 18px; }
    @media(min-width: 900px) { .problem-grid, .pricing-grid { grid-template-columns: repeat(3, 1fr); } .pricing-grid { grid-template-columns: repeat(2, 1fr); } }
    .problem-card { padding: 18px; text-align: left; }

    /* ====== Pricing ====== */
    .price-card { padding: 22px; text-align: left; }
    .price-card.pro { border: 2px solid rgba(99, 102, 241, 0.45); position: relative; }
    .price-card.pro::before { content: "ì¶”ì²œ"; position: absolute; top: 14px; right: 14px; font-size: 12px; font-weight: 900; padding: 6px 10px; border-radius: 999px; background: rgba(99, 102, 241, 0.14); color: var(--primary); }
    .price-card ul { padding-left: 20px; line-height: 1.8; font-size: 14px; }

    /* ====== Buttons & Inputs ====== */
    .btn { appearance: none; border: 1px solid var(--card-border); background: rgba(255, 255, 255, 0.8); color: var(--text-main); padding: 14px; border-radius: 14px; font-weight: 900; cursor: pointer; transition: all 0.2s ease; }
    .btn:active { transform: scale(0.98); }
    .btn-primary { border: none !important; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #fff; box-shadow: 0 14px 30px rgba(99, 102, 241, 0.25); }
    .btn-ghost { background: transparent; color: var(--text-main); border: 1px solid var(--card-border); }
    
    input { width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 12px; border: 1px solid var(--card-border); background: rgba(255, 255, 255, 0.5); color: var(--text-main); }

    /* ====== Auth & App UI ====== */
    .auth-card { width: 100%; max-width: 400px; margin: 0 auto; padding: 30px; text-align: center; }
    .auth-actions { display: flex; gap: 10px; margin-top: 14px; }
    .auth-actions .btn { flex: 1; }
    .link-btn { border: none; background: transparent; color: var(--muted); font-weight: 800; cursor: pointer; text-decoration: underline; margin-top: 10px; }
    
    .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center; }
    .theme-tag { padding: 6px 12px; border-radius: 20px; border: 1px solid var(--card-border); background: transparent; color: var(--text-main); cursor: pointer; font-size: 13px; }
    .theme-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

    .habit { width: 100%; padding: 20px; font-size: 18px; font-weight: 900; margin-top: 16px; border: none; border-radius: 16px; background: var(--text-main); color: var(--bg-color); cursor: pointer; }

    /* ====== Badges ====== */
    .badge { padding: 4px 10px; border-radius: 999px; font-size: 12px; font-weight: 800; color: #fff; display: inline-block; }
    .tier-bronze { background: #cd7f32; }
    .tier-silver { background: #c0c0c0; color: #333; }
    .tier-gold { background: #ffd700; color: #333; }
    .tier-platinum { background: #e5e4e2; color: #333; border: 1px solid #ccc; }
    .tier-diamond { background: #b9f2ff; color: #333; }
    .tier-master { background: linear-gradient(135deg, #ff00cc, #333399); }

    /* ========================= */
    /* âœ… ADMIN CONSOLE CSS */
    /* ========================= */
    #adminFab { position: fixed; right: 20px; bottom: 20px; z-index: 9995; width: 56px; height: 56px; border-radius: 999px; border: none; cursor: pointer; font-size: 22px; font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #fff; box-shadow: 0 12px 28px rgba(0,0,0,0.25); transition: transform .2s ease; display: none; }
    #adminFab:active { transform: scale(.96); }
    .admin-overlay { position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,.55); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; padding: 18px; }
    .admin-shell { width: min(1200px, 96vw); height: min(760px, 92vh); border-radius: 22px; overflow: hidden; display: grid; grid-template-columns: 260px 1fr; background: rgba(255,255,255,.95); border: 1px solid rgba(15,23,42,0.12); box-shadow: 0 30px 80px rgba(0,0,0,.35); }
    .dark-mode .admin-shell { background: rgba(2,6,23,.90); border: 1px solid rgba(148,163,184,0.18); }
    .admin-sidebar { padding: 16px; border-right: 1px solid rgba(15,23,42,.08); background: rgba(255,255,255,.55); }
    .dark-mode .admin-sidebar { background: rgba(2,6,23,.45); border-right: 1px solid rgba(148,163,184,0.12); }
    .admin-main { padding: 16px; overflow: auto; }
    @media (max-width: 980px) { .admin-shell { grid-template-columns: 1fr; } .admin-sidebar { display:none; } }
    
    .admin-tab { width: 100%; text-align: left; padding: 10px 12px; border-radius: 14px; border: 1px solid rgba(15,23,42,.08); background: rgba(255,255,255,.6); cursor: pointer; font-weight: 900; color: var(--text-main); margin-bottom: 8px; }
    .admin-tab.active { border: none; color: #fff; background: linear-gradient(135deg, var(--primary), var(--secondary)); }
    .admin-grid-kpi { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px; margin-bottom: 20px; }
    .admin-kpi { padding: 14px; }
    .admin-table-row { display: grid; grid-template-columns: 1.6fr .5fr .7fr .6fr .6fr .6fr; gap: 10px; padding: 10px; border-bottom: 1px solid rgba(15,23,42,.06); align-items: center; font-size: 13px; }
    
    /* PRO Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 10001; }
    .modal-card { width: 90%; max-width: 400px; background: var(--bg-color); padding: 30px; border-radius: 20px; text-align: center; }

  </style>
</head>
<body>

  <header>
    <div class="container header-inner">
      <div class="logo">
        <div class="logo-badge"></div>
        HabitFlow
      </div>
      <nav>
        <a href="#features" class="pc-only">ê¸°ëŠ¥</a>
        <a href="#pricing" class="pc-only">ê°€ê²©</a>
        <button class="btn btn-primary" onclick="scrollToAuth()" style="padding: 8px 16px; font-size: 14px;">ì‹œì‘í•˜ê¸°</button>
        <button id="darkModeToggle" class="btn btn-ghost" style="padding: 8px;">ğŸŒ“</button>
      </nav>
    </div>
  </header>  

  <section class="hero">
    <div class="container hero-grid">
      <div class="hero-left">
        <span class="hero-pill">âœ¨ í•˜ë£¨ í•˜ë‚˜ë¡œ ì¶©ë¶„í•´ìš”</span>
        <h1 class="hero-title">í•˜ë£¨ í•˜ë‚˜,<br />ì¸ìƒì„ ë°”ê¾¸ëŠ” ìŠµê´€</h1>
        <p class="hero-desc">
          ì‘ì‹¬ì‚¼ì¼ì„ ëë‚´ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°©ì‹.<br />
          ë²„íŠ¼ í•œ ë²ˆìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ì—°ì† ê¸°ë¡ìœ¼ë¡œ ë™ê¸°ë¶€ì—¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”.
        </p>
        <div class="hero-actions">
          <button class="btn btn-primary" onclick="scrollToAuth()">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
          <a href="#pricing" class="btn btn-ghost">ê°€ê²© ë³´ê¸°</a>
        </div>
        <div class="hero-metrics">
          <div class="metric-card"><b>1 Habit</b><span>í•˜ë£¨ ë”± í•˜ë‚˜</span></div>
          <div class="metric-card"><b>Streak</b><span>ì—°ì† ê¸°ë¡</span></div>
          <div class="metric-card"><b>Report</b><span>ì£¼ê°„ ë¦¬í¬íŠ¸</span></div>
        </div>
      </div>

      <div class="hero-right glass">
        <h3>ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´</h3>
        <p>ë¡œê·¸ì¸ í›„ í…Œë§ˆë¥¼ ì„ íƒí•˜ë©´ ì˜¤ëŠ˜ ìŠµê´€ì´ ìë™ìœ¼ë¡œ ì¶”ì²œë¼ìš”.</p>
        <div class="recommend-card">
          <div>ğŸš‘ <b>ìƒì¡´ ì²´ë ¥ íŒ©</b></div>
          <span style="font-size:12px; color:#555">ì§ì¥ì¸ì„ ìœ„í•œ â€œì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™â€</span>
        </div>
        <div class="recommend-card">
          <div>âœ¨ <b>ê°“ìƒ ì…ë¬¸ íŒ©</b></div>
          <span style="font-size:12px; color:#555">ì„±ê³µ ë£¨í‹´ì„ 2ë¶„ì§œë¦¬ë¡œ ìª¼ê°œê¸°</span>
        </div>
      </div>
    </div>
  </section>

  <section id="authSection" style="padding-top: 40px; min-height: 80vh;">
    <div class="container" style="display:flex; justify-content:center;">
      
      <div id="auth" class="auth-card glass">
        <h2>HabitFlow ì‹œì‘í•˜ê¸°</h2>
        <p style="color:var(--muted); margin-bottom:24px;">ì´ë©”ì¼ë¡œ ê°„í¸í•˜ê²Œ ì‹œì‘í•˜ì„¸ìš”</p>
        
        <input id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
        <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
        
        <div class="auth-actions">
           <button id="signupBtn" class="btn btn-primary" type="button">íšŒì›ê°€ì…</button>
           <button id="signinBtn" class="btn btn-ghost" type="button">ë¡œê·¸ì¸</button>
        </div>
        
        <div style="margin-top:16px;">
          <button id="resetPwBtn" class="link-btn" type="button">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
        </div>
        
        <p id="authHint" style="margin-top:20px; font-size:13px; color:var(--muted);">
          ì²˜ìŒì´ë©´ <b>íšŒì›ê°€ì…</b> â†’ ë©”ì¼ ì¸ì¦ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.
        </p>
      </div>

      <div id="app" class="glass" style="width:100%; max-width:480px; padding:30px; display:none; text-align:center;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2 id="welcome" style="margin:0; font-size: 1.2rem;"></h2>
          <button id="logoutBtn" style="background:none; border:none; color:var(--muted); font-size:0.8rem; text-decoration:underline; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div id="tierBadge" style="display:none; margin: 20px 0;">
          <span id="tierText" class="badge"></span>
          <p id="streakCount" style="font-size: 0.9rem; margin-top: 8px; font-weight:700;"></p>
        </div>

        <div id="themeSection" style="margin-top:24px;">
           <p style="font-size: 0.9rem; font-weight: 700; margin-bottom:10px;">ğŸ ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ© ì„ íƒ</p>
           <div class="tag-container">
              <button class="theme-tag" onclick="selectTheme(this, 'survival')">ğŸš‘ ìƒì¡´</button>
              <button class="theme-tag" onclick="selectTheme(this, 'godsaeng')">âœ¨ ê°“ìƒ</button>
              <button class="theme-tag" onclick="selectTheme(this, 'detox')">ğŸ“± ë””í†¡ìŠ¤</button>
              <button class="theme-tag" onclick="selectTheme(this, 'custom')">â• ì»¤ìŠ¤í…€</button>
           </div>
        </div>
        
        <div id="todaySuggestion" style="margin-top:16px; font-size:0.9rem; padding:12px; background:rgba(99,102,241,0.1); border-radius:12px; color:var(--text-main);">
          í…Œë§ˆë¥¼ ì„ íƒí•˜ë©´ ì˜¤ëŠ˜ í•  ì¼ì´ ì¶”ì²œë©ë‹ˆë‹¤.
        </div>
        
        <input id="habitName" readonly value="í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”" style="margin-top: 20px; text-align: center; font-weight:700;">
        <button id="habitBtn" class="habit">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ âœ…</button>
        <p id="status" style="margin-top:12px; font-size:14px; color:var(--primary); font-weight:700; min-height:20px;"></p>
        
        <div id="stats" style="display:none; margin-top:20px; padding:16px; background:rgba(255,255,255,0.5); border-radius:12px;">
          <h3 style="margin:0 0 10px; font-size:16px;">ğŸ“Š ë‚˜ì˜ ìŠµê´€ í†µê³„</h3>
          <p id="totalDays" style="margin:0; font-weight:700;"></p>
        </div>

        <button id="restoreStreakBtn" style="margin-top:10px; width:100%; padding:12px; border-radius:12px; background:#f59e0b; color:white; border:none; font-weight:800; display:none; cursor:pointer;">
          ğŸ”¥ ì—°ì† ê¸°ë¡ ë³µêµ¬ (PRO)
        </button>

        <div id="weeklyReport" style="display:none; width: 100%; margin-top: 30px; text-align: left;">
          <div id="weeklyReportBody"></div>
          <div id="weeklyReportLocked" style="display:none; padding: 24px; border: 2px dashed var(--card-border); border-radius: 16px; text-align: center;">
             <span style="font-size: 2rem; display:block; margin-bottom:10px;">ğŸ”’</span>
             <div>
               <b>-ì¼ ì—°ì† ì„±ê³µ</b> ì¤‘ì…ë‹ˆë‹¤!<br>
               AIê°€ ë¶„ì„í•œ <b>'ì‹¤íŒ¨ íŒ¨í„´ ë¦¬í¬íŠ¸'</b>ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.<br>
               PRO íšŒì›ì´ ë˜ì–´ í™•ì¸í•´ë³´ì„¸ìš”.
             </div>
             <button id="weeklyGoProBtn" class="btn btn-primary" style="margin-top: 15px; font-size:13px;" onclick="showProModal()">ë¦¬í¬íŠ¸ ì ê¸ˆ í•´ì œí•˜ê¸°</button>
          </div>
        </div>

        <div id="calendarSection" style="display:none; margin-top:30px; text-align:left;">
          <h3 style="font-size:16px; margin-bottom:10px;">ğŸ“… ì´ë²ˆ ë‹¬ ê¸°ë¡</h3>
          <div id="calendarGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px;"></div>
        </div>

      </div>

    </div>
  </section>

  <section id="pricing">
    <div class="container">
      <div class="section-head">
        <span class="kicker">PRICING</span>
        <h2>ê°€ê²©</h2>
        <p>ë¬´ë£Œë¡œ ì‹œì‘í•˜ê³ , íŒ¨í„´ ë¶„ì„ì´ í•„ìš”í•  ë•Œ PROë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”.</p>
      </div>
      <div class="pricing-grid">
        <div class="price-card glass">
          <div class="plan">ë¬´ë£Œ</div>
          <div class="amount">â‚©0</div>
          <div class="desc">ê°€ë³ê²Œ ë£¨í‹´ì„ ë§Œë“¤ê³  ì‹¶ì€ ë¶„ì—ê²Œ</div>
          <ul>
            <li>âœ… í•˜ë£¨ 1ìŠµê´€</li>
            <li>âœ… ê¸°ë³¸ í…Œë§ˆ ì¶”ì²œ</li>
            <li>âœ… ê¸°ë³¸ ìŠ¤íŠ¸ë¦­ í™•ì¸</li>
          </ul>
        </div>
        <div class="price-card glass pro" id="proCard">
          <div class="plan">PRO</div>
          <div class="amount">â‚©3,900</div>
          <div class="desc">ìŠµê´€ì´ ë¬´ë„ˆì§€ëŠ” â€œíŒ¨í„´â€ì„ ì¡ê³  ì‹¶ì€ ë¶„ì—ê²Œ</div>
          <ul>
            <li>âœ¨ ìŠµê´€ ë¬´ì œí•œ + ì»¤ìŠ¤í…€</li>
            <li>âœ¨ ì£¼ê°„ ë¦¬í¬íŠ¸/AI ë¶„ì„</li>
            <li>âœ¨ ìº˜ë¦°ë”/í†µê³„/ë³µêµ¬ê¶Œ</li>
          </ul>
          <button id="goProBtn" class="btn btn-primary" style="width:100%; margin-top:14px;" onclick="showProModal()">PROë¡œ ì—…ê·¸ë ˆì´ë“œ</button>
        </div>
      </div>
    </div>
  </section>

  <div id="proModal" class="modal-overlay">
    <div class="modal-card">
        <h3>ğŸš€ PRO ì—…ê·¸ë ˆì´ë“œ</h3>
        <p>ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ ê²°ì œ ì‹œìŠ¤í…œ ì ê²€ ì¤‘ì…ë‹ˆë‹¤.</p>
        <button class="btn btn-ghost" onclick="document.getElementById('proModal').style.display='none'">ë‹«ê¸°</button>
    </div>
  </div>

  <footer>
    <div class="container" style="text-align:center; padding-bottom:40px; color:var(--muted); font-size:14px;">
      <p>Â© 2026 HabitFlow. All rights reserved.</p>
    </div>
  </footer>

<button id="adminFab" aria-label="Admin Console">ğŸ‘‘</button>

<div id="adminOverlay" class="admin-overlay" style="display:none;">
  <div class="admin-shell">
    <aside class="admin-sidebar">
      <div class="admin-brand" style="margin-bottom:20px;">
        <div class="admin-title" style="font-weight:900;">HabitFlow Admin</div>
        <div id="adminMe" class="admin-sub" style="font-size:12px; color:var(--muted);">â€”</div>
      </div>
      <nav class="admin-nav">
        <button class="admin-tab active" data-tab="dash">ëŒ€ì‹œë³´ë“œ</button>
        <button class="admin-tab" data-tab="users">ìœ ì € ê´€ë¦¬</button>
      </nav>
      <div style="margin-top:auto;">
        <button id="adminRefresh" class="btn btn-ghost" style="width:100%;">ìƒˆë¡œê³ ì¹¨</button>
        <button id="adminClose" class="btn" style="width:100%; margin-top:10px;">ë‹«ê¸°</button>
      </div>
    </aside>

    <main class="admin-main">
      <div class="admin-topbar" style="margin-bottom:20px;">
        <div id="adminSectionTitle" style="font-size:24px; font-weight:800;">ëŒ€ì‹œë³´ë“œ</div>
      </div>

      <section class="admin-panel" data-panel="dash">
        <div class="admin-grid-kpi">
          <div class="admin-kpi glass">
            <div class="admin-kpi-label" style="font-size:12px; color:var(--muted);">ì´ ìœ ì €</div>
            <div id="kpiTotal" class="admin-kpi-value" style="font-size:24px; font-weight:900;">â€”</div>
          </div>
          <div class="admin-kpi glass">
            <div class="admin-kpi-label" style="font-size:12px; color:var(--muted);">PRO ìœ ì €</div>
            <div id="kpiPRO" class="admin-kpi-value" style="font-size:24px; font-weight:900;">â€”</div>
          </div>
        </div>
      </section>

      <section class="admin-panel" data-panel="users" style="display:none;">
        <div class="glass" style="padding:12px; margin-top:12px;">
          <div class="admin-table-head" style="display:grid; grid-template-columns: 1.6fr 0.5fr 1fr; font-weight:700; color:var(--muted); padding-bottom:10px; border-bottom:1px solid #eee;">
            <div>ìœ ì € (Email)</div>
            <div>ë“±ê¸‰</div>
            <div>UID</div>
          </div>
          <div id="userTable" class="admin-table-body" style="margin-top:10px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </section>

    </main>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, getIdTokenResult, sendPasswordResetEmail, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // 1. Firebase ì„¤ì •
  const firebaseConfig = {
    apiKey: "AIzaSyAIaroNs2VsMamnnNJV1cP9LdXqIDhl3Ig",
    authDomain: "giiiddd-36340523-3f595.firebaseapp.com",
    projectId: "giiiddd-36340523-3f595",
    storageBucket: "giiiddd-36340523-3f595.firebasestorage.app",
    messagingSenderId: "698901018936",
    appId: "1:698901018936:web:2fb12a7a03cbd844c1e9cd"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // 2. ì „ì—­ ë³€ìˆ˜ ì„¤ì • (HTML onclick í˜¸í™˜ì„±)
  window.db = db;
  window.auth = auth;
  
  // 3. Admin ì„¤ì •
  const ADMIN_EMAIL_ALLOWLIST = ["test@gmail.com"]; 
  let _isAdminUser = false;

  // --- Theme Data ---
  const themeData = {
    survival: ["ğŸ›Œ ë°¤ 11ì‹œ í° ë„ê¸°", "ğŸ’§ ê³µë³µ ë¬¼ í•œ ì”", "ğŸ’Š ì˜ì–‘ì œ ì±™ê²¨ë¨¹ê¸°", "ğŸ¢ ê±°ë¶ëª© ìŠ¤íŠ¸ë ˆì¹­", "ğŸ‘ï¸ ë¨¼ ì‚° ë³´ê¸°", "ğŸ§¹ ì±…ìƒ ìœ„ ë¦¬ì…‹", "ğŸš¶ 30ë¶„ ì‚°ì±…"],
    godsaeng: ["ğŸ“… ë‹¤ìŒ ì£¼ ê³„íš ì§œê¸°", "ğŸ›ï¸ ì´ë¶ˆ ì •ë¦¬í•˜ê¸°", "ğŸ’° ê°€ê³„ë¶€ ì ê¸°", "ğŸ“š ì±… 2í˜ì´ì§€ ì½ê¸°", "ğŸ—£ï¸ ì˜ë‹¨ì–´ 1ê°œ ì™¸ìš°ê¸°", "ğŸ“ ê°ì‚¬ ì¼ê¸° 3ì¤„", "ğŸ§¹ ë°© ì²­ì†Œí•˜ê¸°"],
    detox: ["ğŸ“ ë‚´ì¼ í•  ì¼ ì†ê¸°ë¡", "ğŸ“µ ê¸°ìƒ í›„ 10ë¶„ ë…¸í°", "ğŸ½ï¸ ì‹ì‚¬ ì¤‘ ì˜ìƒ ê¸ˆì§€", "ğŸ§ ì´ì–´í° ì—†ì´ ê±·ê¸°", "ğŸ“± ìŠ¤í¬ë¦° íƒ€ì„ í™•ì¸", "ğŸ§˜ 5ë¶„ ëª…ìƒ", "ğŸ“µ ë””ì§€í„¸ í”„ë¦¬ 1ì‹œê°„"]
  };

  // --- Helper Functions ---
  function dateKeyFromOffset(daysAgo) {
    const d = new Date();
    d.setDate(d.getDate() - daysAgo);
    return d.toISOString().slice(0, 10);
  }

  async function getConsecutiveStreak(uid) {
    let count = 0;
    let date = new Date();
    while (true) {
      const key = date.toISOString().slice(0, 10);
      const snap = await getDoc(doc(db, "users", uid, "habits", key));
      if (!snap.exists()) break;
      count++;
      date.setDate(date.getDate() - 1);
    }
    return count;
  }

  // --- Window Global Functions (HTMLì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡) ---
  window.scrollToAuth = () => {
    document.getElementById("authSection").scrollIntoView({ behavior: "smooth" });
  };

  window.selectTheme = async (el, themeType) => {
    const user = auth.currentUser;
    if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

    const tokenResult = await getIdTokenResult(user);
    const isPro = tokenResult.claims.pro === true;
    const habitInput = document.getElementById("habitName");
    const dayIdx = new Date().getDay();

    document.querySelectorAll('.theme-tag').forEach(tag => tag.classList.remove('active'));

    if (themeType === 'custom') {
      if (!isPro) {
        alert("ğŸ”’ ì»¤ìŠ¤í…€ ìŠµê´€ì€ PRO ì „ìš©ì…ë‹ˆë‹¤.");
        return;
      }
      habitInput.readOnly = false;
      habitInput.value = "";
      habitInput.placeholder = "ì›í•˜ëŠ” ìŠµê´€ì„ ì…ë ¥í•˜ì„¸ìš”";
      habitInput.style.background = "#fff";
      habitInput.focus();
    } else {
      habitInput.readOnly = true;
      habitInput.style.background = "var(--bg-color)";
      habitInput.value = themeData[themeType][dayIdx];
    }
    if (el) el.classList.add('active');
  };
  
  window.showProModal = () => document.getElementById("proModal").style.display = "flex";

  // --- DOM Elements ---
  const authDiv = document.getElementById('auth');
  const appDiv = document.getElementById('app');
  const emailInput = document.getElementById("email");
  const passInput = document.getElementById("password");
  const signupBtn = document.getElementById("signupBtn");
  const signinBtn = document.getElementById("signinBtn");
  const resetPwBtn = document.getElementById("resetPwBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const habitBtn = document.getElementById('habitBtn');
  
  // PRO & Admin UI
  const proCard = document.getElementById("proCard");
  const statsDiv = document.getElementById("stats");
  const restoreBtn = document.getElementById("restoreStreakBtn");
  const weeklyReport = document.getElementById("weeklyReport");

  // --- Auth Logic ---
  signupBtn.onclick = async () => {
    if (!emailInput.value || !passInput.value) return alert("ì…ë ¥í•´ì£¼ì„¸ìš”");
    try {
      const cred = await createUserWithEmailAndPassword(auth, emailInput.value, passInput.value);
      // ìœ ì € ë¬¸ì„œ ìƒì„±
      await setDoc(doc(db, "users", cred.user.uid), {
          email: cred.user.email,
          createdAt: new Date(),
          isPro: false
      });
      await sendEmailVerification(cred.user);
      alert("âœ… íšŒì›ê°€ì… ì™„ë£Œ! ì¸ì¦ ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
      await signOut(auth);
    } catch (e) {
      alert("ê°€ì… ì‹¤íŒ¨: " + e.message);
    }
  };

  signinBtn.onclick = async () => {
    if (!emailInput.value || !passInput.value) return alert("ì…ë ¥í•´ì£¼ì„¸ìš”");
    try {
      await signInWithEmailAndPassword(auth, emailInput.value, passInput.value);
    } catch (e) {
      alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message);
    }
  };

  resetPwBtn.onclick = async () => {
    if (!emailInput.value) return alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    try {
      await sendPasswordResetEmail(auth, emailInput.value);
      alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.");
    } catch(e) { alert("ì˜¤ë¥˜: " + e.message); }
  };

  logoutBtn.onclick = () => signOut(auth);

  // --- Auth Monitor ---
  onAuthStateChanged(auth, async user => {
    if (!user) {
      authDiv.style.display = 'block';
      appDiv.style.display = 'none';
      document.getElementById("adminFab").style.display = 'none';
      return;
    }

    // ê´€ë¦¬ì í™•ì¸
    const tokenResult = await getIdTokenResult(user, true);
    const isAdmin = tokenResult.claims.admin === true || ADMIN_EMAIL_ALLOWLIST.includes(user.email);
    _isAdminUser = isAdmin;

    if (isAdmin) {
        document.getElementById("adminFab").style.display = 'block';
        document.getElementById("adminMe").textContent = user.email;
    }

    // UI ì „í™˜
    authDiv.style.display = 'none';
    appDiv.style.display = 'block';
    
    // DB ì—…ë°ì´íŠ¸ (ìµœê·¼ í™œë™)
    await setDoc(doc(db, "users", user.uid), { 
        lastActiveAt: new Date(),
        email: user.email 
    }, { merge: true });

    const isPro = tokenResult.claims.pro === true;
    document.getElementById("welcome").textContent = `ğŸ‘‹ ${user.email.split('@')[0]}ë‹˜`;

    // PRO Check
    if (isPro) {
      proCard.style.display = "none";
      statsDiv.style.display = "block";
      document.getElementById("status").textContent = "ğŸŒŸ PRO ë©¤ë²„ì‹­ ì´ìš© ì¤‘";
      loadStats(user.uid);
    } else {
      proCard.style.display = "block";
      statsDiv.style.display = "none";
      document.getElementById("status").textContent = "ğŸŒ± ë¬´ë£Œ íšŒì› (í•˜ë£¨ 1ìŠµê´€)";
    }

    // ë°ì´í„° ë¡œë“œ
    const streak = await getConsecutiveStreak(user.uid);
    updateTierUI(streak);
    await updateWeeklyReport(user.uid, isPro);
    await renderCalendar(user.uid, isPro);
    await updateStreakProtectionUI(user.uid, isPro);
  });

  // --- Habit Actions ---
  habitBtn.onclick = async () => {
    const user = auth.currentUser;
    if (!user) return;
    
    const habitName = document.getElementById("habitName").value;
    if (habitName === "í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”" || !habitName.trim()) {
      alert("í…Œë§ˆë¥¼ ì„ íƒí•˜ê±°ë‚˜ ìŠµê´€ì„ ì…ë ¥í•˜ì„¸ìš”!");
      return;
    }
    
    const todayStr = new Date().toISOString().slice(0, 10);
    const ref = doc(db, "users", user.uid, "habits", todayStr);
    
    await setDoc(ref, {
      done: true,
      name: habitName,
      timestamp: new Date()
    });

    celebrate();
    
    // ìœ ì € ë¬¸ì„œì— ì„±ê³µ íšŸìˆ˜ ì—…ë°ì´íŠ¸
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);
    const currentCount = userSnap.data()?.totalSuccess || 0;
    await updateDoc(userRef, { totalSuccess: currentCount + 1 });

    const streak = await getConsecutiveStreak(user.uid);
    updateTierUI(streak);
  };

  function celebrate() {
    const btn = document.getElementById("habitBtn");
    btn.style.transform = "scale(0.95)";
    setTimeout(() => { btn.style.transform = "scale(1)"; }, 150);
    
    document.getElementById("status").textContent = "ğŸ‰ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜ í´ë¦¬ì–´!";
    btn.innerHTML = "ì™„ë£Œí•¨ âœ¨";
    btn.style.background = "#ddd";
    btn.style.color = "#888";
    btn.style.cursor = "default";
    btn.disabled = true;

    if (typeof confetti === 'function') {
        confetti({ origin: { y: 0.7 }, spread: 26, startVelocity: 55 });
    }
  }

  // --- UI Update Helpers ---
  function updateTierUI(streak) {
    const tierBadge = document.getElementById("tierBadge");
    const tierText = document.getElementById("tierText");
    const streakCount = document.getElementById("streakCount");

    tierBadge.style.display = "block";
    streakCount.textContent = `ğŸ”¥ í˜„ì¬ ${streak}ì¼ ì—°ì† ì„±ê³µ ì¤‘!`;

    let label = "ğŸ¥‰ BRONZE";
    let cls = "tier-bronze";
    if (streak >= 30) { label = "ğŸ† GRANDMASTER"; cls = "tier-master"; }
    else if (streak >= 20) { label = "ğŸ’ DIAMOND"; cls = "tier-diamond"; }
    else if (streak >= 14) { label = "âœ¨ PLATINUM"; cls = "tier-platinum"; }
    else if (streak >= 7) { label = "ğŸ¥‡ GOLD"; cls = "tier-gold"; }
    else if (streak >= 3) { label = "ğŸ¥ˆ SILVER"; cls = "tier-silver"; }

    tierText.textContent = label;
    tierText.className = "badge " + cls;
  }

  async function updateWeeklyReport(uid, isPro) {
    const reportBody = document.getElementById("weeklyReportBody");
    const lockedDiv = document.getElementById("weeklyReportLocked");
    const reportDiv = document.getElementById("weeklyReport");
    
    let successCount = 0;
    const days = [];
    const dayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
    
    for (let i = 0; i < 7; i++) {
       const key = dateKeyFromOffset(i);
       const snap = await getDoc(doc(db, "users", uid, "habits", key));
       const done = snap.exists();
       const d = new Date(key);
       if (done) successCount++;
       days.push({ key, done, dayName: dayNames[d.getDay()] });
    }

    const streak = await getConsecutiveStreak(uid);
    if (streak < 3) {
      reportDiv.style.display = "none";
      return;
    }
    reportDiv.style.display = "block";

    if (!isPro) {
      reportBody.innerHTML = "";
      lockedDiv.style.display = "block";
      document.querySelector("#weeklyReportLocked b").textContent = `${streak}ì¼ ì—°ì† ì„±ê³µ`;
      return;
    }

    lockedDiv.style.display = "none";
    const rate = Math.round((successCount/7)*100);
    const listHTML = days.reverse().map(d => `
       <div style="display:flex; justify-content:space-between; margin-bottom:6px; font-size:13px;">
         <span>${d.dayName} (${d.key.slice(5)})</span>
         <span>${d.done ? "âœ…" : "âŒ"}</span>
       </div>
    `).join('');

    reportBody.innerHTML = `
      <div style="background:rgba(99,102,241,0.1); padding:16px; border-radius:12px; margin-bottom:12px;">
         <div style="font-weight:700; margin-bottom:8px;">ğŸ¤– AI Habit Coach</div>
         <div style="font-size:13px; line-height:1.5;">
           ì´ë²ˆ ì£¼ ì„±ê³µë¥ ì€ <b>${rate}%</b>ì…ë‹ˆë‹¤.<br>
           ${rate === 100 ? "ì™„ë²½í•©ë‹ˆë‹¤! ê°“ìƒ ê·¸ ìì²´ì‹œë„¤ìš”." : "ì£¼ë§ì— ì¡°ê¸ˆ ë” ì‹ ê²½ì¨ë³´ë©´ ì–´ë–¨ê¹Œìš”?"}
         </div>
      </div>
      <div style="padding:10px; background:#fff; border-radius:12px; border:1px solid #eee;">${listHTML}</div>
    `;
  }

  async function renderCalendar(uid, isPro) {
    const section = document.getElementById("calendarSection");
    const grid = document.getElementById("calendarGrid");
    
    if (!isPro) { section.style.display = "none"; return; }
    section.style.display = "block";
    grid.innerHTML = "";

    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();
    const lastDay = new Date(year, month + 1, 0).getDate();

    for (let d = 1; d <= lastDay; d++) {
      const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const snap = await getDoc(doc(db, "users", uid, "habits", dateStr));
      
      const cell = document.createElement("div");
      cell.textContent = d;
      cell.style.padding = "6px";
      cell.style.borderRadius = "6px";
      cell.style.fontSize = "12px";
      cell.style.textAlign = "center";
      
      if (snap.exists()) {
        cell.style.background = "#22c55e";
        cell.style.color = "white";
      } else {
        cell.style.background = "rgba(0,0,0,0.05)";
        cell.style.color = "var(--muted)";
      }
      grid.appendChild(cell);
    }
  }

  async function updateStreakProtectionUI(uid, isPro) {
    if (!isPro) return;
    const snap = await getDoc(doc(db, "users", uid));
    const left = snap.data()?.streakProtectionLeft ?? 2;
    
    if (left > 0) {
      restoreBtn.style.display = "block";
      restoreBtn.textContent = `ğŸ”¥ ì—°ì† ê¸°ë¡ ë³µêµ¬ (${left}íšŒ ë‚¨ìŒ)`;
      restoreBtn.onclick = async () => {
         const yesterday = dateKeyFromOffset(1);
         await setDoc(doc(db, "users", uid, "habits", yesterday), { done: true, restored: true });
         await updateDoc(doc(db, "users", uid), { streakProtectionLeft: left - 1 });
         alert("ğŸ”¥ ì–´ì œ ê¸°ë¡ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
         location.reload();
      };
    } else {
      restoreBtn.style.display = "none";
    }
  }

  async function loadStats(uid) {
    const snap = await getDocs(collection(db, "users", uid, "habits"));
    document.getElementById("totalDays").textContent = `ì´ ëˆ„ì  ì„±ê³µ: ${snap.size}ì¼`;
  }

  // ============================
  // ADMIN FUNCTIONS (NEW)
  // ============================
  const adminFab = document.getElementById("adminFab");
  const adminOverlay = document.getElementById("adminOverlay");
  const adminClose = document.getElementById("adminClose");
  const adminRefresh = document.getElementById("adminRefresh");
  const userTable = document.getElementById("userTable");
  const adminTabs = document.querySelectorAll(".admin-tab");
  const adminPanels = document.querySelectorAll(".admin-panel");

  // Admin Toggle
  adminFab.addEventListener("click", async () => {
      adminOverlay.style.display = "flex";
      await refreshAdmin();
  });
  adminClose.addEventListener("click", () => adminOverlay.style.display = "none");
  adminRefresh.addEventListener("click", refreshAdmin);

  // Tabs
  adminTabs.forEach(tab => {
      tab.addEventListener("click", () => {
          adminTabs.forEach(t => t.classList.remove("active"));
          tab.classList.add("active");
          const target = tab.dataset.tab;
          adminPanels.forEach(p => p.style.display = p.dataset.panel === target ? "block" : "none");
      });
  });

  async function refreshAdmin() {
      // 1. Load Dashboard
      const usersSnap = await getDocs(collection(db, "users"));
      const total = usersSnap.size;
      let proCount = 0;
      usersSnap.forEach(u => { if(u.data().isPro) proCount++; });
      document.getElementById("kpiTotal").textContent = total;
      document.getElementById("kpiPRO").textContent = proCount;

      // 2. Load Users Table
      let html = "";
      usersSnap.forEach(docSnap => {
          const u = docSnap.data();
          const uid = docSnap.id;
          html += `
          <div class="admin-table-row" style="grid-template-columns: 1.6fr 0.5fr 1fr;">
              <div style="font-weight:700;">${u.email || "No Email"}</div>
              <div><span class="badge" style="background:${u.isPro?'#6366f1':'#ccc'}">${u.isPro?'PRO':'FREE'}</span></div>
              <div style="font-size:11px; color:#aaa;">${uid.slice(0,6)}...</div>
          </div>
          `;
      });
      userTable.innerHTML = html;
  }

  // --- Dark Mode ---
  const toggle = document.getElementById("darkModeToggle");
  toggle.onclick = () => {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "on" : "off");
  };
  if (localStorage.getItem("darkMode") === "on") document.body.classList.add("dark-mode");
</script>

</body>
</html>