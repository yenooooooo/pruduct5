<!-- =========================
  HabitFlow (Hardened Build)
  PART 1 / 2  (<= ~800 lines)
  - ê´€ë¦¬ì íŒ¨ë„ í¬í•¨
  - ì¤‘ë³µ/ì¶©ëŒ ì œê±°
  - í´ë¦­/ë²„íŠ¼ ë¨¹í†µ ì›ì¸ ì œê±°
========================= -->
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>HabitFlow - Ultimate God Mode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --bg-color: #f8fafc;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --card-bg: rgba(255, 255, 255, 0.85);
      --card-border: rgba(255, 255, 255, 0.6);
      --panel-bg: #ffffff;
      --input-bg: rgba(241, 245, 249, 0.8);
      --primary: #6366f1;
      --secondary: #a855f7;
      --accent: #f59e0b;
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.08);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    }

    body.dark-mode {
      --bg-color: #0f172a;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --card-bg: rgba(30, 41, 59, 0.75);
      --card-border: rgba(255, 255, 255, 0.08);
      --panel-bg: #1e293b;
      --input-bg: rgba(15, 23, 42, 0.6);
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: 'SUIT', sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      position: relative;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    button {
      font-family: inherit;
    }

    @keyframes pulse {
      0% {
        transform: scale(0.95);
        opacity: 0.7;
      }

      100% {
        transform: scale(1.05);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(40px, 60px);
      }
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes ticker {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    @keyframes breathe {

      0%,
      100% {
        transform: scale(1);
        opacity: 0.3;
      }

      50% {
        transform: scale(1.5);
        opacity: 0.6;
      }
    }

    @keyframes slideDown {
      from {
        top: -100px;
      }

      to {
        top: 100px;
      }
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
      }

      to {
        transform: translateX(0);
      }
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }

      100% {
        transform: translateY(-100vh) scale(1.5);
        opacity: 0;
      }
    }

    @keyframes glowing {
      0% {
        background-position: 0 0;
      }

      50% {
        background-position: 400% 0;
      }

      100% {
        background-position: 0 0;
      }
    }

    /* âœ… í´ë¦­/ë“œë˜ê·¸ ë¨¹í†µ ë°©ì§€: ê¸°ë³¸ì€ auto */
    section {
      width: 100%;
      padding: 84px 20px;
      position: relative;
      z-index: 1;
      pointer-events: auto;
    }

    .container {
      width: 100%;
      max-width: 1080px;
      margin: 0 auto;
    }

    .glass,
    button,
    input,
    .card,
    .price-card,
    .workout-side-panel,
    .problem-card,
    .memo-panel {
      pointer-events: auto;
    }

    header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px 0;
      z-index: 10;
      pointer-events: auto;
    }

    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-weight: 900;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-main);
    }

    .logo-badge {
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 50%;
    }

    nav {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .pc-only {
      display: block;
    }

    @media (max-width: 600px) {
      .pc-only {
        display: none;
      }
    }

    .glass {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(16px);
      border-radius: 24px;
      transition: transform 0.25s ease;
    }

    .glass:hover {
      transform: translateY(-4px);
    }

    .hero {
      padding-top: 140px;
      padding-bottom: 80px;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 48px;
      align-items: center;
    }

    .hero-pill {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 800;
      background: rgba(99, 102, 241, 0.15);
      color: var(--primary);
    }

    .hero-title {
      font-size: 46px;
      line-height: 1.2;
      letter-spacing: -1px;
      margin: 18px 0;
      font-weight: 900;
      color: var(--text-main);
    }

    .hero-desc {
      font-size: 16px;
      color: var(--text-muted);
      line-height: 1.7;
      margin-bottom: 24px;
    }

    .hero-metrics {
      display: flex;
      gap: 14px;
      margin-top: 28px;
    }

    .metric-card {
      padding: 14px 18px;
      border-radius: 16px;
      background: var(--input-bg);
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
      color: var(--text-main);
    }

    .recommend-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 15px;
      color: var(--text-main);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      transition: opacity 0.5s ease-in-out;
      min-height: 140px;
      justify-content: center;
    }

    .dashboard-layout {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 24px;
      max-width: 960px;
      margin: 0 auto;
      display: none;
    }

    #app {
      flex: 1;
      max-width: 480px;
      padding: 30px;
      text-align: center;
      position: relative;
      z-index: 10;
      width: 100%;
    }

    .right-stack {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 340px;
      flex-shrink: 0;
    }

    .workout-side-panel {
      width: 100%;
      background: linear-gradient(145deg, #1e293b, #0f172a);
      color: white;
      padding: 24px;
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
      display: none;
      text-align: left;
      position: relative;
      overflow: hidden;
    }

    .master-badge-corner {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
      border: 1px solid #fbbf24;
      font-size: 10px;
      font-weight: 800;
      padding: 4px 8px;
      border-radius: 6px;
      letter-spacing: 1px;
    }

    .w-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 20px;
      background: linear-gradient(to right, #fff, #94a3b8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .workout-tabs {
      display: flex;
      background: rgba(0, 0, 0, 0.3);
      padding: 4px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .w-tab {
      flex: 1;
      border: none;
      background: transparent;
      color: #94a3b8;
      padding: 8px;
      font-size: 13px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .w-tab.active {
      background: #fbbf24;
      color: #000;
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
    }

    .workout-display {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px 10px;
      text-align: center;
      margin-bottom: 20px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .wd-main {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 4px;
      color: #fff;
    }

    .wd-sub {
      font-size: 12px;
      color: #94a3b8;
    }

    .workout-anim {
      animation: pulse 0.5s infinite alternate;
      color: #fbbf24;
      font-size: 24px;
      font-weight: 900;
    }

    .memo-panel {
      width: 100%;
      padding: 20px;
      text-align: left;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }

    .memo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .memo-title {
      font-weight: 800;
      font-size: 16px;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .memo-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      background: var(--primary);
      color: white;
      font-weight: 700;
    }

    textarea.memo-input {
      width: 100%;
      height: 100px;
      border: none;
      border-radius: 12px;
      background: var(--input-bg);
      color: var(--text-main);
      padding: 12px;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.5;
      resize: none;
      outline: none;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .memo-history-list {
      max-height: 150px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .memo-item {
      background: var(--input-bg);
      padding: 10px;
      border-radius: 10px;
      font-size: 13px;
      color: var(--text-main);
      border: 1px solid var(--card-border);
    }

    .memo-date {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
      font-weight: 700;
    }

    .panel-lock {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 24px;
      z-index: 10;
      color: var(--text-main);
      font-weight: 800;
      text-align: center;
      padding: 20px;
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 18px;
    }

    .price-card {
      padding: 24px;
      text-align: left;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      background: var(--card-bg);
      border-radius: 24px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
    }

    .price-card .plan {
      font-size: 13px;
      font-weight: 800;
      color: var(--text-muted);
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .price-card .amount {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 4px;
      letter-spacing: -1px;
      color: var(--text-main);
    }

    .price-card .desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 15px;
      min-height: 32px;
    }

    .price-card ul {
      margin-bottom: 15px;
      padding: 0;
      list-style: none;
    }

    .price-card li {
      display: flex;
      gap: 6px;
      font-size: 12px;
      margin-bottom: 6px;
      align-items: center;
      font-weight: 500;
      color: var(--text-main);
    }

    .price-card.pro {
      border: 2px solid var(--primary);
    }

    .price-card.ultra {
      border: 2px solid var(--accent);
    }

    .price-card.master {
      border: 2px solid #333;
      background: linear-gradient(135deg, #1e1e1e, #0f172a);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transform: scale(1.03);
      z-index: 2;
      position: relative;
    }

    .price-card.master .plan {
      color: #ffd700;
    }

    .price-card.master .desc {
      color: #94a3b8;
    }

    .price-card.master .amount,
    .price-card.master li {
      color: #fff;
    }

    .price-card.master .btn {
      background: #ffd700;
      color: #000;
      border: none;
      font-weight: 900;
    }

    .auth-card {
      max-width: 400px;
      margin: 0 auto;
      padding: 30px;
      text-align: center;
    }

    .btn {
      padding: 12px;
      border-radius: 12px;
      font-weight: 900;
      cursor: pointer;
      border: 1px solid var(--card-border);
      background: var(--panel-bg);
      color: var(--text-main);
      width: 100%;
      transition: 0.2s;
      box-shadow: var(--shadow);
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
    }

    input {
      width: 100%;
      padding: 14px;
      margin-bottom: 10px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: var(--input-bg);
      color: var(--text-main);
    }

    .tag-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      justify-content: center;
    }

    .theme-tag {
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid var(--card-border);
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-main);
    }

    .theme-tag.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .aura-effect {
      position: relative;
    }

    .aura-effect::before {
      content: '';
      position: absolute;
      top: -15px;
      left: -15px;
      right: -15px;
      bottom: -15px;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
      background-size: 400%;
      z-index: -1;
      filter: blur(25px);
      animation: glowing 20s linear infinite;
      opacity: 0.5;
    }

    .pet-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .pet-emoji {
      font-size: 80px;
      animation: bounce 2s infinite;
      filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.15));
    }

    .pet-bubble {
      background: var(--panel-bg);
      color: var(--text-main);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: bold;
      position: relative;
      margin-bottom: 10px;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: var(--shadow);
    }

    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(20, 1fr);
      gap: 4px;
      margin-top: 10px;
      justify-content: center;
    }

    .grass {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 3px;
      background: rgba(0, 0, 0, 0.08);
    }

    .grass.active {
      background: #22c55e;
    }

    .blob-cont {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      opacity: 0.6;
      filter: blur(60px);
      animation: float 10s infinite alternate;
    }

    .blob-1 {
      top: 10%;
      left: 10%;
      width: 300px;
      height: 300px;
      background: var(--secondary);
      animation-duration: 25s;
    }

    .blob-2 {
      bottom: 20%;
      right: 10%;
      width: 350px;
      height: 350px;
      background: var(--primary);
      animation-duration: 30s;
    }

    .blob-3 {
      bottom: 10%;
      left: 30%;
      width: 250px;
      height: 250px;
      background: #ec4899;
      animation-duration: 22s;
    }

    @media (max-width: 900px) {

      .hero-grid,
      .pricing-grid,
      .problem-grid {
        grid-template-columns: 1fr;
      }

      /* âœ… ëŒ€ì‹œë³´ë“œëŠ” ì»¬ëŸ¼ìœ¼ë¡œ ì•ˆ ë‚´ë¦¼ (ì˜¤ë¥¸ìª½ ê¸°ëŠ¥ ìœ ì§€) */
      .dashboard-layout {
        flex-direction: row;
        align-items: flex-start;
      }

      .workout-side-panel,
      .right-stack {
        width: 340px;
        max-width: 340px;
      }
    }


    .admin-shell {
      grid-template-columns: 1fr;
    }

    .admin-left {
      display: none;
    }
    }

    /* Live ticker */
    .live-ticker {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      color: white;
      padding: 8px 0;
      z-index: 9000;
      overflow: hidden;
      white-space: nowrap;
      font-size: 13px;
      font-weight: 700;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .ticker-content {
      display: inline-block;
      animation: ticker 30s linear infinite;
      padding-left: 100%;
    }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-right: 40px;
    }

    /* Zen */
    .zen-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-color);
      z-index: 20000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      opacity: 0;
      transition: opacity 0.35s;
    }

    .zen-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      opacity: 0.3;
      animation: breathe 4s infinite ease-in-out;
      margin-bottom: 30px;
    }

    /* Broadcast */
    .broadcast-overlay {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(239, 68, 68, 0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 900;
      box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
      z-index: 30000;
      display: none;
      animation: slideDown 0.5s;
    }

    .broadcast-overlay.active {
      display: block;
    }

    /* Achievement */
    .achievement-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #ffd700, #f59e0b);
      color: #000;
      padding: 15px 20px;
      border-radius: 12px;
      font-weight: 800;
      box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
      z-index: 25000;
      display: none;
      align-items: center;
      gap: 10px;
      animation: slideInRight 0.5s;
    }

    /* Hearts */
    .cheer-heart {
      position: fixed;
      font-size: 24px;
      animation: floatUp 3s linear forwards;
      z-index: 9999;
      pointer-events: none;
    }

    /* Stickers */
    #stickerLayer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 5;
    }

    .sticker {
      position: absolute;
      font-size: 40px;
      cursor: grab;
      user-select: none;
      z-index: 50;
      transition: transform 0.1s;
      filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.15));
      pointer-events: auto;
    }

    .sticker:active {
      cursor: grabbing;
      transform: scale(1.1);
    }

    /* =========================
       ADMIN PANEL
    ========================= */
    #adminPanel {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      padding: 20px;
      animation: fadeIn 0.3s;
    }

    .admin-shell {
      width: 100%;
      max-width: 1400px;
      height: 90vh;
      margin: 0 auto;
      border-radius: 20px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 260px 1fr;
      background: #111;
      box-shadow: 0 0 100px rgba(99, 102, 241, 0.2);
      border: 1px solid #333;
    }

    .admin-left {
      padding: 20px;
      background: #000;
      border-right: 1px solid #333;
      display: flex;
      flex-direction: column;
    }

    .admin-right {
      padding: 30px;
      overflow-y: auto;
      background: #0a0a0a;
      color: #eee;
    }

    .admin-title {
      font-weight: 1000;
      font-size: 24px;
      color: #fff;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .admin-sub {
      color: #666;
      font-size: 11px;
      margin-bottom: 30px;
      letter-spacing: 1px;
      font-family: monospace;
    }

    .adminNavBtn {
      width: 100%;
      padding: 14px 16px;
      border-radius: 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 700;
      text-align: left;
      color: #888;
      margin-bottom: 5px;
      transition: 0.2s;
    }

    .adminNavBtn:hover {
      background: #222;
      color: #fff;
    }

    .adminNavBtn.active {
      background: linear-gradient(90deg, #6366f1, #4f46e5);
      color: #fff;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }

    .admin-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .admin-card {
      padding: 20px;
      border-radius: 12px;
      background: #1a1a1a;
      border: 1px solid #333;
    }

    .admin-card .k {
      color: #888;
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
    }

    .admin-card .v {
      font-size: 32px;
      font-weight: 1000;
      margin-top: 10px;
      color: #fff;
    }

    .admin-pane {
      display: none;
      animation: fadeIn 0.3s;
    }

    .admin-pane.active {
      display: block;
    }

    .admin-close-x {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      opacity: 0.6;
      transition: 0.2s;
      z-index: 20;
    }

    .admin-close-x:hover {
      opacity: 1;
      color: #ef4444;
    }

    .chart-container {
      display: flex;
      gap: 5px;
      height: 10px;
      width: 100%;
      margin-top: 10px;
      background: #222;
      border-radius: 5px;
      overflow: hidden;
    }

    .chart-bar {
      height: 100%;
      transition: width 0.5s;
    }

    .matrix-bg {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.08;
      z-index: 0;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiMwZjAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTIiIHRleHQtYW5jaG9yPSJtaWRkbGUiPjEwPC90ZXh0Pjwvc3ZnPg==');
    }

    .matrix-terminal {
      background: #000;
      color: #00ff41;
      padding: 20px;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      height: 250px;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.5;
      border: 1px solid #0f0;
      box-shadow: inset 0 0 30px rgba(0, 255, 0, 0.1);
      margin-top: 20px;
      position: relative;
      z-index: 1;
    }

    .log-line {
      margin-bottom: 4px;
      display: flex;
      gap: 10px;
    }

    .log-line span {
      opacity: 0.5;
    }

    /* ===== ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´ UI ì •ë¦¬ ===== */
    .routine-state {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .routine-state.hidden {
      display: none;
    }

    .today-card h3 {
      font-size: 20px;
      font-weight: 800;
    }

    .muted {
      color: #94a3b8;
      font-size: 14px;
    }

    .routine-badge {
      font-size: 18px;
      font-weight: 900;
    }

    .routine-desc {
      font-size: 14px;
      color: #475569;
    }

    /* ================================
   AI ì¶”ì²œ ì¹´ë“œ: í…Œë‘ë¦¬ UI + ì• ë‹ˆë©”ì´ì…˜
   ================================ */

    /* ì¹´ë“œ ì „ì²´ í…Œë‘ë¦¬(ê·¸ë¼ë°ì´ì…˜) */
    .ai-rec-box {
      position: relative;
      border-radius: 18px;
      padding: 14px;
      overflow: hidden;
      background: var(--panel-bg);
      border: 1px solid rgba(99, 102, 241, 0.18);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    /* ë°”ê¹¥ ê·¸ë¼ë°ì´ì…˜ í…Œë‘ë¦¬ ëŠë‚Œ (pseudo) */
    .ai-rec-box::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.55), rgba(168, 85, 247, 0.45), rgba(245, 158, 11, 0.35));
      filter: blur(10px);
      opacity: 0.35;
      z-index: 0;
    }

    /* ë‚´ë¶€ ì‹¤ì œ ì»¨í…ì¸  ë°•ìŠ¤ */
    .ai-rec-box::after {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: 17px;
      background: var(--panel-bg);
      z-index: 0;
    }

    .ai-rec-top,
    .ai-rec-main {
      position: relative;
      z-index: 1;
    }

    /* ìƒë‹¨ ë¼ë²¨ ë¼ì¸ */
    .ai-rec-top {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .ai-badge {
      font-size: 11px;
      font-weight: 900;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(99, 102, 241, 0.12);
      color: var(--primary);
      border: 1px solid rgba(99, 102, 241, 0.18);
    }

    .ai-small {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 700;
    }

    .ai-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: rgba(34, 197, 94, 0.9);
      box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.45);
      animation: aiPulse 1.6s ease-in-out infinite;
    }

    @keyframes aiPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.45);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(34, 197, 94, 0.0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.0);
      }
    }

    /* ë©”ì¸ í…ìŠ¤íŠ¸ */
    .ai-rec-title {
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: -0.3px;
      margin-bottom: 6px;
    }

    /* ë¬¸êµ¬ í˜ì´ë“œ ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ ë˜í¼ */
    .ai-rec-desc-wrap {
      position: relative;
      min-height: 22px;
      /* ë¬¸êµ¬ ë†’ì´ ê³ ì •í•´ì„œ ëœ í”ë“¤ë¦¬ê²Œ */
      overflow: hidden;
    }

    .ai-rec-desc {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
      transform: translateY(0);
      opacity: 1;
    }

    /* ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ */
    .ai-rec-desc.fade-out {
      animation: aiFadeOut 260ms ease forwards;
    }

    .ai-rec-desc.fade-in {
      animation: aiFadeIn 380ms ease forwards;
    }

    @keyframes aiFadeOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }

      to {
        opacity: 0;
        transform: translateY(8px);
      }
    }

    @keyframes aiFadeIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* í•˜ë‹¨ divider */
    .ai-rec-divider {
      margin: 12px 0 10px;
      height: 1px;
      width: 100%;
      background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.22), transparent);
    }

    .ai-rec-hint {
      font-size: 12px;
      color: var(--text-main);
      font-weight: 700;
      opacity: 0.85;
    }

    /* ë‹¤í¬ëª¨ë“œ ë³´ì • */
    body.dark-mode .ai-rec-box {
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
    }

    body.dark-mode .ai-rec-box::after {
      background: rgba(30, 41, 59, 0.85);
    }

    body.dark-mode .ai-rec-hint {
      color: #e2e8f0;
      opacity: 0.9;
    }

    /* âœ… WHY ëœë”© ì„¹ì…˜ */
    .why-section {
      padding: 70px 0 30px;
      position: relative;
    }

    .why-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 18px;
      text-align: center;
    }

    .why-pill {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .3px;
      background: rgba(99, 102, 241, .10);
      border: 1px solid rgba(99, 102, 241, .22);
      color: #3730a3;
      margin-bottom: 12px;
    }

    .why-title {
      margin: 0;
      font-size: clamp(26px, 4vw, 42px);
      line-height: 1.12;
      letter-spacing: -.4px;
    }

    .why-sub {
      margin: 12px auto 28px;
      max-width: 720px;
      color: rgba(15, 23, 42, .72);
      font-size: 15px;
      line-height: 1.6;
    }

    .why-grid {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      margin-top: 10px;
    }

    .why-card {
      background: rgba(255, 255, 255, .78);
      border: 1px solid rgba(255, 255, 255, .55);
      box-shadow: 0 18px 40px rgba(2, 6, 23, .08);
      border-radius: 18px;
      padding: 18px 18px 16px;
      text-align: left;
      backdrop-filter: blur(8px);
    }

    .why-ico {
      font-size: 20px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(99, 102, 241, .10);
      border: 1px solid rgba(99, 102, 241, .18);
      margin-bottom: 10px;
    }

    .why-h {
      font-weight: 900;
      color: #0f172a;
      margin-bottom: 6px;
      font-size: 16px;
    }

    .why-p {
      color: rgba(15, 23, 42, .70);
      font-size: 13px;
      line-height: 1.55;
    }

    @media (max-width: 900px) {
      .why-grid {
        grid-template-columns: 1fr;
      }

      .why-section {
        padding: 52px 0 18px;
      }
    }

    /* =========================
  TOPBAR (Promotional Header)
========================= */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 9999;
      backdrop-filter: blur(14px);
      background: rgba(255, 255, 255, 0.65);
      border-bottom: 1px solid rgba(255, 255, 255, 0.55);
    }

    .topbar-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      padding: 14px 0;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
    }

    .brand .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--primary);
      box-shadow: 0 0 18px rgba(99, 102, 241, 0.55);
    }

    .brand-name {
      font-size: 16px;
      letter-spacing: -0.01em;
    }

    .brand-tag {
      font-size: 11px;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.12);
      color: #059669;
      border: 1px solid rgba(16, 185, 129, 0.22);
    }

    .topnav {
      display: flex;
      gap: 16px;
      font-weight: 800;
      color: var(--text-muted);
    }

    .topnav a {
      text-decoration: none;
      color: var(--text-muted);
      padding: 8px 10px;
      border-radius: 999px;
    }

    .topnav a:hover {
      background: rgba(0, 0, 0, 0.04);
      color: var(--text-main);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.04);
      border: 1px solid var(--card-border);
      font-size: 12px;
      font-weight: 900;
      color: var(--text-main);
    }

    .live-bolt {
      filter: drop-shadow(0 0 12px rgba(251, 191, 36, 0.6));
    }

    @media (max-width: 900px) {
      .topnav {
        display: none;
      }
    }

    .hero-proof {
      margin-top: 16px;
    }

    .proof-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .proof-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.65);
      border: 1px solid var(--card-border);
      font-size: 12px;
      font-weight: 900;
    }

    .proof-quote {
      margin-top: 10px;
      color: var(--text-main);
      font-size: 13px;
      line-height: 1.6;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.03);
      border: 1px solid var(--card-border);
    }

    .proof-by {
      color: var(--text-muted);
      font-weight: 800;
      margin-left: 8px;
    }

    /* =========================
  BOTTOM LIVE TICKER (fixed)
========================= */
    .bottom-ticker {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9998;
      height: 44px;
      display: flex;
      align-items: center;
      overflow: hidden;
      backdrop-filter: blur(14px);
      background: rgba(255, 255, 255, 0.65);
      border-top: 1px solid rgba(255, 255, 255, 0.55);
    }

    .bottom-ticker .ticker-track {
      display: inline-flex;
      align-items: center;
      gap: 14px;
      white-space: nowrap;
      padding-left: 100%;
      will-change: transform;
      animation: ticker-move 18s linear infinite;
    }

    /* ê° ì•„ì´í…œ(appendTickerì—ì„œ ë§Œë“œëŠ” .ticker-item) */
    .bottom-ticker .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      background: rgba(0, 0, 0, 0.04);
      font-size: 12px;
      font-weight: 900;
      color: var(--text-main);
    }

    @keyframes ticker-move {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    /* âœ… ë§¨ ì•„ë˜ ë°” ë•Œë¬¸ì— ë‚´ìš© ê°€ë¦¬ì§€ ì•Šê²Œ ì—¬ë°± í™•ë³´ */
    body {
      padding-bottom: 56px;
    }

    /* âœ… í—¤ë” ë°°ê²½ì„ ê¹”ë”í•˜ê²Œ ê³ ì • */
    header,
    .navbar,
    .topbar {
      background: rgba(255, 255, 255, 0.82) !important;
      backdrop-filter: blur(16px) !important;
      -webkit-backdrop-filter: blur(16px) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.6) !important;
    }

    /* ===== Header Controls (NEW) ===== */
    .header-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .hbtn {
      height: 38px;
      padding: 0 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(10px);
      color: var(--text-main);
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
    }

    .hbtn:hover {
      transform: translateY(-1px);
    }

    .hbtn.primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      color: white;
    }

    .coin-pill {
      height: 38px;
      padding: 0 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(10px);
      font-weight: 900;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
    }

    /* ë‹¤í¬ëª¨ë“œ í—¤ë” ë²„íŠ¼ í†¤ */
    body.dark-mode .hbtn,
    body.dark-mode .coin-pill {
      background: rgba(17, 24, 39, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: #fff;
    }
  </style>
</head>

<body>
  <!-- âœ… TOP HEADER (í™ë³´ìš©) -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <span class="dot"></span>
        <span class="brand-name">HabitFlow</span>
        <span class="brand-tag">LIVE</span>
      </div>

      <nav class="topnav">
        <a href="#why">WHY</a>
        <a href="#pricing">ê°€ê²©</a>
        <a href="#authSection">ì‹œì‘í•˜ê¸°</a>
      </nav>
      <!-- âœ… HEADER RIGHT CONTROLS (ì—¬ê¸° ë¶™ì—¬ë„£ê¸°) -->
      <div class="header-controls">
        <button id="focusToggleBtn" class="hbtn">ğŸ§˜ Deep Focus</button>
        <button id="themeToggleBtn" class="hbtn">ğŸŒ™</button>
        <div id="coinPill" class="coin-pill">â­ <span id="coinCount">0</span></div>
      </div>

      <div class="topbar-right">
        <div id="liveBadge" class="live-badge" title="ì‹¤ì‹œê°„ í™œë™">
          <span class="live-bolt">âš¡</span>
          <span id="liveText">ì§€ê¸ˆ ì ‘ì† ì¤‘â€¦</span>
        </div>

        <button id="topStartBtn" class="btn btn-primary" style="width:auto; padding:10px 14px;">ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  </header>



  <!-- Zen overlay -->
  <div id="zenOverlay" class="zen-overlay">
    <div class="zen-circle"></div>
    <h2 style="font-weight:300; margin-bottom:10px;">Deep Focus</h2>
    <p style="color:var(--text-muted);">ì˜¤ì§ ë‚˜ì—ê²Œë§Œ ì§‘ì¤‘í•˜ì„¸ìš”.</p>
    <button class="btn" id="zenExitBtn" style="margin-top:30px;">ë‚˜ê°€ê¸°</button>
  </div>

  <!-- Broadcast -->
  <div id="broadcastOverlay" class="broadcast-overlay">
    ğŸ“¢ <span id="broadcastMsg">ê¸´ê¸‰ ê³µì§€ì‚¬í•­ì…ë‹ˆë‹¤.</span>
  </div>

  <!-- Achievement toast -->
  <div id="achievementToast" class="achievement-toast">
    <div style="font-size:24px;">ğŸ†</div>
    <div>
      <div style="font-size:10px; opacity:0.8;">ACHIEVEMENT UNLOCKED</div>
      <div id="achievementTitle">ì‘ì‹¬ì‚¼ì¼ íƒˆì¶œ!</div>
    </div>
  </div>

  <!-- blobs -->
  <div class="blob-cont">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <!-- stickers layer -->
  <div id="stickerLayer"></div>

  <!-- coin display -->
  <div id="coinDisplay"
    style="position: fixed; top: 20px; right: 20px; z-index: 500; background: var(--panel-bg); padding: 8px 12px; border-radius: 20px; font-weight: 800; font-size: 14px; display:none; border: 2px solid var(--accent); color: var(--text-main); box-shadow: var(--shadow);">
    <span>â­</span> <span id="coinCount">0</span>
  </div>

  <header>
    <div class="container header-inner">
      <div class="logo">
        <div class="logo-badge"></div>HabitFlow
      </div>
      <nav>
        <button class="btn" id="zenToggleBtn" style="padding: 8px 12px; width:auto;">ğŸ§˜</button>
        <button class="btn btn-primary" id="startNowBtn"
          style="padding: 8px 16px; font-size: 14px; width:auto;">ì‹œì‘í•˜ê¸°</button>
        <button id="darkModeToggle" class="btn" style="padding: 8px; width:auto;">ğŸŒ“</button>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-grid">
      <div class="hero-left">
        <span class="hero-pill">âœ¨ í•˜ë£¨ í•˜ë‚˜ë¡œ ì¶©ë¶„í•´ìš”</span>
        <h1 class="hero-title">í•˜ë£¨ í•˜ë‚˜,<br />ì¸ìƒì„ ë°”ê¾¸ëŠ” ìŠµê´€</h1>
        <p class="hero-desc">ì‘ì‹¬ì‚¼ì¼ì„ ëë‚´ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°©ì‹.<br>ë²„íŠ¼ í•œ ë²ˆìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ì—°ì† ê¸°ë¡ìœ¼ë¡œ ë™ê¸°ë¶€ì—¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”.</p>
        <div class="hero-actions">
          <button class="btn btn-primary" id="heroStartBtn" style="width:auto;">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
        </div>
        <div class="hero-metrics">
          <div class="metric-card"><b>1 Habit</b><span>í•˜ë£¨ ë”± í•˜ë‚˜</span></div>
          <div class="metric-card"><b>Streak</b><span>ì—°ì† ê¸°ë¡</span></div>
          <div class="metric-card"><b>Report</b><span>ì£¼ê°„ ë¦¬í¬íŠ¸</span></div>
        </div>
      </div>

      <!-- ğŸ”½ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´ ì¹´ë“œ (êµì²´ë³¸) -->
      <div class="today-card">

        <!-- ìƒíƒœ 1: ë¡œê·¸ì¸ ì „ -->
        <div id="routineBeforeLogin" class="routine-state">
          <h3>ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´</h3>
          <p class="muted">
            ë¡œê·¸ì¸ í›„ í…Œë§ˆë¥¼ ì„ íƒí•˜ë©´<br>
            ë§¤ì¼ ë‹¤ë¥¸ ë£¨í‹´ì´ ì¶”ì²œë©ë‹ˆë‹¤.
          </p>
        </div>

        <!-- ìƒíƒœ 2: ë¡œê·¸ì¸ í›„ / í…Œë§ˆ ë¯¸ì„ íƒ -->
        <div id="routineNoTheme" class="routine-state hidden">
          <h3>ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´</h3>
          <p class="muted">í…Œë§ˆë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
        </div>

        <!-- ìƒíƒœ 3: ì¶”ì²œ ê²°ê³¼ -->
        <!-- ìƒíƒœ 3: ì¶”ì²œ ê²°ê³¼ -->
        <div id="routineResult" class="routine-state hidden">

          <!-- âœ… í…Œë‘ë¦¬ UI + ì• ë‹ˆë©”ì´ì…˜ ì»¨í…Œì´ë„ˆ -->
          <div class="ai-rec-box">
            <div class="ai-rec-top">
              <div class="ai-badge">AI ì¶”ì²œ</div>
              <div class="ai-dot" aria-hidden="true"></div>
              <div class="ai-small">ë§¤ì¼ ìë™ ì—…ë°ì´íŠ¸</div>
            </div>

            <div class="ai-rec-main">
              <div id="aiRecTitle" class="ai-rec-title">ğŸš‘ ìƒì¡´ ì²´ë ¥ íŒ©</div>

              <!-- ìì—°ìŠ¤ëŸ½ê²Œ ë°”ë€ŒëŠ” ë¬¸êµ¬ -->
              <div class="ai-rec-desc-wrap">
                <div id="aiRecDesc" class="ai-rec-desc">
                  ì§ì¥ì¸ì„ ìœ„í•œ â€˜ì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™â€™
                </div>
              </div>

              <!-- í•˜ë‹¨ ë³´ë” ë¼ì¸ -->
              <div class="ai-rec-divider"></div>

              <!-- ì‘ì€ íŒíŠ¸ -->
              <div id="aiRecHint" class="ai-rec-hint">ì˜¤ëŠ˜ì€ ê°€ë³ê²Œ ì‹œì‘í•´ìš”.</div>
            </div>
          </div>

        </div>
        <div class="hero-proof">
          <div class="proof-badges">
            <span class="proof-pill">âš¡ ë²„íŠ¼ 1ë²ˆ</span>
            <span class="proof-pill">ğŸ”¥ ì—°ì†ê¸°ë¡</span>
            <span class="proof-pill">ğŸ ì½”ì¸ ë¦¬ì›Œë“œ</span>
          </div>
          <div class="proof-quote">
            â€œì‘ì‹¬ì‚¼ì¼ì´ ì•„ë‹ˆë¼, <b>ì‘ì€ ìŠ¹ë¦¬</b>ê°€ ìŒ“ì´ê²Œ í•´ì£¼ëŠ” ì•±.â€
            <span class="proof-by">â€” ì‚¬ìš©ì í›„ê¸°</span>
          </div>
        </div>

  </section>
  <!-- âœ… WHY ëœë”© ì„¹ì…˜ (hero ì•„ë˜, ëŒ€ì‹œë³´ë“œ ìœ„) -->
  <section class="why-section" id="why">
    <div class="why-inner">
      <div class="why-pill">WHY</div>
      <h2 class="why-title">ì™œ ìŠµê´€ì€ í•­ìƒ ì‹¤íŒ¨í• ê¹Œ?</h2>
      <p class="why-sub">
        HabitFlowëŠ” <b>â€œë”± 1ê°œë§Œ, ë²„íŠ¼ 1ë²ˆâ€</b>ìœ¼ë¡œ ì‹¤í–‰ ì¥ë²½ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.
      </p>

      <div class="why-grid">
        <div class="why-card">
          <div class="why-ico">ğŸ¯</div>
          <div class="why-h">ëª©í‘œê°€ ë„ˆë¬´ ë§ë‹¤</div>
          <div class="why-p">ìš•ì‹¬ì´ ì»¤ì§ˆìˆ˜ë¡ ì‹œì‘ì´ ì–´ë ¤ì›Œì ¸ìš”. í•˜ë£¨ 1ê°œë§Œ ë‚¨ê¹ë‹ˆë‹¤.</div>
        </div>

        <div class="why-card">
          <div class="why-ico">ğŸ“</div>
          <div class="why-h">ê¸°ë¡ì´ ê·€ì°®ë‹¤</div>
          <div class="why-p">ê¸°ë¡ì´ ë²ˆê±°ë¡œìš°ë©´ í¬ê¸° í™•ë¥ ì´ ì˜¬ë¼ê°€ìš”. ë²„íŠ¼ í•œ ë²ˆì´ë©´ ë.</div>
        </div>

        <div class="why-card">
          <div class="why-ico">ğŸ“ˆ</div>
          <div class="why-h">ì„±ì·¨ê°€ ëˆˆì— ì•ˆ ë³´ì¸ë‹¤</div>
          <div class="why-p">ìŒ“ì´ëŠ” ëŠë‚Œì´ ì—†ìœ¼ë©´ ì§€ì†ì´ ì–´ë µì£ . ì—°ì† ê¸°ë¡ì„ ì¦‰ì‹œ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>
  </section>


  <section id="authSection" style="padding-top: 40px; min-height: 80vh;">
    <div class="container" style="display:flex; justify-content:center;">
      <div id="auth" class="auth-card glass">
        <h2>HabitFlow ì‹œì‘í•˜ê¸°</h2>
        <input id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
        <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
        <div class="auth-actions">
          <button id="signupBtn" class="btn btn-primary">íšŒì›ê°€ì…</button>
          <button id="signinBtn" class="btn">ë¡œê·¸ì¸</button>
        </div>
        <div style="margin-top:10px;">
          <button id="resetPwBtn" class="btn"
            style="background:transparent; box-shadow:none; border:none; text-decoration:underline; color:var(--text-muted);">ë¹„ë°€ë²ˆí˜¸
            ì°¾ê¸°</button>
        </div>
      </div>

      <div id="dashboardLayout" class="dashboard-layout">
        <div id="app" class="glass">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 id="welcome" style="margin:0; font-size: 1.2rem;"></h2>
            <button id="logoutBtn"
              style="background:none; border:none; color:var(--text-muted); font-size:0.8rem; text-decoration:underline; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
          </div>

          <div style="margin: 10px 0 10px;">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:5px;">
              <span id="levelBadge" style="font-weight:900; color:var(--primary); font-size:18px;">Lv.1</span>
              <span id="xpText" style="font-size:12px; color:var(--text-muted); font-weight:700;">0 / 100 XP</span>
            </div>
            <div
              style="background:rgba(0,0,0,0.08); border-radius:10px; height:10px; overflow:hidden; position:relative;">
              <div id="xpBar"
                style="background:linear-gradient(90deg, var(--primary), var(--secondary)); width:0%; height:100%; transition: width 0.6s; border-radius:10px;">
              </div>
            </div>
          </div>

          <div class="pet-container" id="petContainer">
            <div id="petBubble" class="pet-bubble">ì‘ì›í•©ë‹ˆë‹¤!</div>
            <div id="petEmoji" class="pet-emoji">ğŸ¥š</div>
          </div>

          <button id="globalCheerBtn" class="btn"
            style="background: #fff0f7; color: #ec4899; border: 1px solid #ec4899; width: 100%; margin-bottom: 15px;">
            ğŸ’– ëª¨ë‘ì—ê²Œ ì‘ì› ë³´ë‚´ê¸°
          </button>

          <div class="heatmap-container"
            style="margin: 15px 0; padding: 15px; border-radius: 16px; background: rgba(0,0,0,0.05); border: 1px solid var(--card-border);">
            <div
              style="font-size:12px; font-weight:700; color:var(--text-muted); display:flex; justify-content:space-between; margin-bottom: 5px;">
              <span>ğŸŒ¿ ìµœê·¼ 20ì¼</span><span>Log</span>
            </div>
            <div id="heatmapGrid" class="heatmap-grid"></div>
          </div>

          <div id="tierBadge" style="display:none; margin: 20px 0;">
            <p id="streakCount" style="font-size: 0.9rem; margin-top: 8px; font-weight:700;"></p>
          </div>

          <div id="themeSection" style="margin-top:24px;">
            <p style="font-size: 0.9rem; font-weight: 700; margin-bottom:10px;">ğŸ ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ©</p>
            <div class="tag-container">
              <button class="theme-tag" data-theme="survival">ğŸš‘ ìƒì¡´</button>
              <button class="theme-tag" data-theme="godsaeng">âœ¨ ê°“ìƒ</button>
              <button class="theme-tag" data-theme="detox">ğŸ“± ë””í†¡ìŠ¤</button>
              <button class="theme-tag" data-theme="custom">â• ì»¤ìŠ¤í…€</button>
            </div>
          </div>

          <div id="todaySuggestion"
            style="margin-top:16px; font-size:0.9rem; padding:12px; background:rgba(99,102,241,0.1); border-radius:12px; color:var(--text-main);">
            í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.
          </div>

          <input id="habitName" readonly value="í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”"
            style="margin-top: 20px; text-align: center; font-weight:700;">
          <div style="display:flex; gap:8px; margin-top:10px;">
            <button id="habitBtn" class="btn btn-primary">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ âœ…</button>
            <button id="timerBtn" class="btn"
              style="width:60px; background:#333; color:white; display:none;">â±ï¸</button>
          </div>
          <p id="status"
            style="margin-top:12px; font-size:14px; color:var(--primary); font-weight:700; min-height:20px;"></p>

          <div id="stats"
            style="display:none; margin-top:20px; padding:16px; background:rgba(0,0,0,0.05); border-radius:12px;">
            <h3 style="margin:0 0 10px; font-size:16px;">ğŸ“Š í†µê³„</h3>
            <p id="totalDays" style="margin:0; font-weight:700;"></p>
          </div>
        </div>

        <div class="right-stack">
          <div id="workoutSidePanel" class="workout-side-panel">
            <span class="master-badge-corner">MASTER</span>
            <div class="w-title">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì±Œë¦°ì§€</div>
            <div class="workout-tabs">
              <!-- âœ… inline onclick ì œê±°í•˜ê³  JSì—ì„œ ì•ˆì „í•˜ê²Œ ë°”ì¸ë”© -->
              <button class="w-tab active" data-type="walk">ğŸš¶ ê±·ê¸°</button>
              <button class="w-tab" data-type="run">ğŸƒ ë‹¬ë¦¬ê¸°</button>
              <button class="w-tab" data-type="gym">ğŸ‹ï¸ í—¬ìŠ¤</button>
            </div>
            <div class="workout-display">
              <div id="workoutResult" class="wd-main">â“</div>
              <div class="wd-sub">ì¢…ëª© ì„ íƒ í›„ ë¯¸ì…˜ ë½‘ê¸°!</div>
            </div>
            <button id="startWorkoutBtn" class="btn"
              style="background:var(--accent); color:#000; border:none; font-weight:900; box-shadow:0 4px 15px rgba(251,191,36,0.4);">ğŸ°
              ë¯¸ì…˜ ëœë¤ ë½‘ê¸°</button>
            <button id="completeWorkoutBtn" class="btn"
              style="background:linear-gradient(to right, #22c55e, #16a34a); color:#fff; border:none; display:none;">âœ…
              ì™„ë£Œ (ì½”ì¸ 3ë°°)</button>
          </div>

          <div id="memoPanel" class="glass memo-panel" style="display:none;">
            <div class="memo-header">
              <div class="memo-title">ğŸ“ ì˜¤ëŠ˜ì˜ ë©”ëª¨</div>
              <span class="memo-badge">PRO+</span>
            </div>
            <div id="memoLocked" class="panel-lock">
              <div style="font-size:30px; margin-bottom:10px;">ğŸ”’</div>
              <div>PRO ë“±ê¸‰ë¶€í„° ì‚¬ìš© ê°€ëŠ¥</div>
              <button class="btn btn-primary" id="memoUnlockBtn"
                style="margin-top:15px; width:auto; padding:8px 16px; font-size:12px;">ì ê¸ˆ í•´ì œ</button>
            </div>
            <textarea id="dailyMemo" class="memo-input" placeholder="ì˜¤ëŠ˜ì˜ ë‹¤ì§ì´ë‚˜ í•  ì¼ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea>
            <button id="saveMemoBtn" class="btn btn-primary" style="margin-top:10px;">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          </div>

          <div id="memoHistoryPanel" class="glass memo-panel" style="display:none;">
            <div class="memo-header">
              <div class="memo-title">ğŸ“‚ ì§€ë‚œ ë©”ëª¨ ê¸°ë¡</div>
            </div>
            <div id="memoHistoryList" class="memo-history-list">
              <div style="text-align:center; padding:10px; color:var(--text-muted); font-size:13px;">ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>
      </div><!-- /dashboardLayout -->
    </div>
  </section>

  <section id="pricing">
    <div class="container">
      <div style="text-align:center; margin-bottom:36px;">
        <span
          style="display:inline-block; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 800; background: rgba(99, 102, 241, 0.15); color: var(--primary);">PRICING</span>
        <h2 style="margin: 12px 0 8px;">ê°€ê²©</h2>
        <p style="color:var(--text-muted);">ë‹¹ì‹ ì˜ ì„±ì¥ì„ ê°€ì†í™”í•  ìµœì ì˜ í”Œëœì„ ì„ íƒí•˜ì„¸ìš”.</p>
      </div>

      <div class="pricing-grid">
        <div class="price-card glass">
          <div>
            <div class="plan">ë¬´ë£Œ</div>
            <div class="amount">â‚©0</div>
            <div class="desc">ê°€ë³ê²Œ ì‹œì‘í•˜ëŠ” ì…ë¬¸ììš©</div>
            <ul>
              <li>âœ… í•˜ë£¨ 1ìŠµê´€ ê¸°ë¡</li>
              <li>âœ… ê¸°ë³¸ í…Œë§ˆ ì¶”ì²œ</li>
            </ul>
          </div>
        </div>

        <div class="price-card glass pro">
          <div>
            <div class="plan" style="color:var(--primary);">PRO</div>
            <div class="amount">â‚©3,900</div>
            <div class="desc">ìŠµê´€ íŒ¨í„´ì„ ì¡ê³  ì‹¶ì€ ë¶„</div>
            <ul>
              <li>âœ¨ ìŠµê´€ ë¬´ì œí•œ + ì»¤ìŠ¤í…€</li>
              <li>âœ¨ ì£¼ê°„ AI ë¶„ì„ ë¦¬í¬íŠ¸</li>
              <li>âœ¨ ìº˜ë¦°ë” ë·° / ë³µêµ¬ê¶Œ</li>
              <li>ğŸ“ <b>ì˜¤ëŠ˜ì˜ ë©”ëª¨ & íˆìŠ¤í† ë¦¬</b></li>
            </ul>
          </div>
          <button class="btn btn-primary" id="proUpgradeBtn">PRO ì—…ê·¸ë ˆì´ë“œ</button>
        </div>

        <div class="price-card glass ultra">
          <div>
            <div class="plan" style="color:var(--accent);">ULTRA</div>
            <div class="amount">â‚©5,900</div>
            <div class="desc">ë‚˜ë§Œì˜ ê°ì„±ìœ¼ë¡œ ê¾¸ë¯¸ê¸°</div>
            <ul>
              <li>ğŸŒˆ ì•± ì»¬ëŸ¬ í…Œë§ˆ ë³€ê²½</li>
              <li>ğŸµ BGM ì„ ê³¡ê¶Œ</li>
              <li>ğŸ’° ì½”ì¸ íšë“ 2ë°°</li>
              <li>ğŸ‘‘ PRO ê¸°ëŠ¥ ëª¨ë‘ í¬í•¨</li>
            </ul>
          </div>
          <button class="btn btn-primary" id="ultraUpgradeBtn"
            style="background:linear-gradient(135deg, #f59e0b, #d97706);">ULTRA ì—…ê·¸ë ˆì´ë“œ</button>
        </div>

        <div class="price-card glass master">
          <div>
            <div class="plan">MASTER</div>
            <div class="amount">â‚©7,900</div>
            <div class="desc">ê·¹í•œì˜ ì„±ì¥ì„ ìœ„í•œ ì™„ì „ì²´</div>
            <ul>
              <li>ğŸ’ª <b>ë§¤ì¼ ìš´ë™ ì±Œë¦°ì§€ íŒ¨ë„</b></li>
              <li>â±ï¸ í¬ëª¨ë„ë¡œ ì§‘ì¤‘ íƒ€ì´ë¨¸</li>
              <li>âœ¨ ë§ˆìŠ¤í„° ì „ìš© ì˜¤ë¼</li>
              <li>ğŸ’° ì½”ì¸ íšë“ 3ë°°</li>
            </ul>
          </div>
          <button class="btn" id="masterUpgradeBtn">MASTER ì—…ê·¸ë ˆì´ë“œ</button>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="text-align:center; padding-bottom:40px; color:var(--text-muted); font-size:14px;">
      <p>Â© 2026 HabitFlow. All rights reserved.</p>
    </div>
  </footer>

  <!-- Floating buttons -->
  <button id="trashModeBtn"
    style="display:none; position:fixed; bottom:50px; right:140px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ—‘ï¸</button>
  <button id="shopOpenBtn"
    style="display:none; position:fixed; bottom:50px; right:80px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#8b5cf6; color:white; font-size:22px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ</button>
  <button id="rankOpenBtn"
    style="display:none; position:fixed; bottom:50px; right:20px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:24px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3);">ğŸ†</button>
  <button id="adminOpenBtn"
    style="display:none; position:fixed; bottom:50px; left:20px; z-index:9990; width:50px; height:50px; border-radius:50%; border:none; background:#000; color:#0f0; border:2px solid #0f0; font-size:24px; cursor:pointer; box-shadow:0 0 20px #0f0;">ğŸ˜</button>

  <!-- Shop panel -->
  <div id="shopPanel" class="glass"
    style="display:none; position:fixed; bottom:110px; right:20px; width:300px; padding:20px; z-index:10000; border:2px solid #8b5cf6; background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
      <h3 style="margin:0; color:#7c3aed;">ğŸ ìƒì </h3>
      <button class="btn" id="shopCloseBtn" style="width:auto; padding:8px 10px;">âœ–</button>
    </div>
    <div style="text-align:center; margin-bottom:20px;">
      <div style="font-size:60px;">ğŸ”®</div>
      <button id="gachaBtn" class="btn btn-primary" style="margin-top:10px;">1ì½”ì¸ ë½‘ê¸°! (ë³´ìœ : <span
          id="shopCoinCount">0</span>)</button>
    </div>
    <div style="font-size:12px; font-weight:bold; margin-bottom:5px;">ğŸ’ ë‚´ ìŠ¤í‹°ì»¤</div>
    <div id="inventoryList"
      style="height:150px; overflow-y:auto; background:var(--input-bg); padding:10px; border-radius:8px; display:grid; grid-template-columns:repeat(4,1fr); gap:10px;">
    </div>
  </div>

  <!-- Rank panel -->
  <div id="rankPanel" class="glass"
    style="display:none; position:fixed; bottom:110px; right:20px; width:340px; padding:20px; z-index:10000; border:2px solid var(--accent); background:var(--panel-bg);">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
      <h3 style="margin:0; color:var(--accent);">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h3>
      <button class="btn" id="rankCloseBtn" style="width:auto; padding:8px 10px;">âœ–</button>
    </div>
    <div id="rankList"
      style="height:300px; overflow-y:auto; background:var(--input-bg); padding:10px; border-radius:8px;"></div>
  </div>

  <!-- Pro modal -->
  <div id="proModal"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001; backdrop-filter:blur(5px);">
    <div class="glass" style="padding:40px; max-width:360px; width:90%; text-align:center; background:var(--panel-bg);">
      <h2 style="margin-top:0;" id="modalTitle">ğŸ‘‘ ì—…ê·¸ë ˆì´ë“œ</h2>
      <p style="color:var(--text-muted); margin-bottom:20px;">ë” ê°•ë ¥í•œ ê¸°ëŠ¥ìœ¼ë¡œ ì„±ì¥í•˜ì„¸ìš”.</p>
      <button class="btn btn-primary" id="modalPayBtn">ì‹œì‘í•˜ê¸°</button>
      <p style="margin-top:16px; font-size:13px; cursor:pointer; color:var(--text-muted);" id="modalCloseBtn">ë‹«ê¸°</p>
    </div>
  </div>

  <!-- Admin panel -->
  <div id="adminPanel">
    <div class="matrix-bg"></div>
    <button class="admin-close-x" id="adminCloseBtn">âœ–</button>

    <div class="admin-shell">
      <div class="admin-left">
        <div class="admin-title">ğŸ‘‘ GOD MODE</div>
        <div class="admin-sub" id="adminSubtitle">SYSTEM ACCESS GRANTED</div>

        <div class="admin-nav">
          <button class="adminNavBtn active" data-pane="pane-dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
          <button class="adminNavBtn" data-pane="pane-users">ğŸ‘¥ ìœ ì € ê´€ë¦¬</button>
          <button class="adminNavBtn" data-pane="pane-tools">ğŸ› ï¸ ì‹ ì˜ ê¶ŒëŠ¥</button>
        </div>

        <div style="margin-top:auto; color:#666; font-size:11px;">
          SECURE CONNECTION ESTABLISHED<br>v3.0.0 HARDENED
        </div>
      </div>

      <div class="admin-right">
        <div id="pane-dashboard" class="admin-pane active">
          <h2 style="color:#fff; margin-top:0;">ì‹œìŠ¤í…œ í˜„í™©</h2>
          <div class="admin-cards">
            <div class="admin-card">
              <div class="k">TOTAL USERS</div>
              <div class="v" id="dashTotal">0</div>
            </div>
            <div class="admin-card">
              <div class="k">PRO MEMBERS</div>
              <div class="v" id="dashPro">0</div>
            </div>
            <div class="admin-card">
              <div class="k">ACTIVE (7D)</div>
              <div class="v" id="dashActive">0</div>
            </div>
          </div>

          <h4 style="color:#aaa; margin-bottom:5px;">USER TIER DISTRIBUTION</h4>
          <div class="chart-container" id="tierChart"></div>

          <h3 style="color:#0f0; margin-top:30px;">ğŸ“Ÿ THE MATRIX LOG</h3>
          <div id="matrixLog" class="matrix-terminal">
            <div class="log-line"><span>[SYSTEM]</span> Booting admin console...</div>
          </div>
        </div>

        <div id="pane-users" class="admin-pane">
          <h2 style="color:#fff; margin-top:0;">ìœ ì € ê´€ë¦¬</h2>
          <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input id="adminSearch" placeholder="ì´ë©”ì¼ ê²€ìƒ‰..."
              style="flex:1; background:#222; border:1px solid #444; color:#fff;">
            <button id="refreshAdminBtn" class="btn"
              style="background:#333; color:#fff; border:1px solid #555;">ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div id="admUserList" style="display:grid; gap:10px;"></div>
        </div>

        <div id="pane-tools" class="admin-pane">
          <h2 style="color:#fff; margin-top:0;">ì‹ ì˜ ê¶ŒëŠ¥ (God Tools)</h2>

          <div class="admin-cards" style="grid-template-columns: 1fr 1fr;">
            <div class="admin-card">
              <div class="k">ğŸ’° MASS GIFT</div>
              <p style="color:#888; font-size:12px; margin-bottom:15px;">ëª¨ë“  ìœ ì €ì—ê²Œ 100 ì½”ì¸ì„ ì„ ë¬¼í•©ë‹ˆë‹¤.</p>
              <button id="godGiftBtn" class="btn"
                style="width:100%; background:#ffd700; color:#000; border:none; font-weight:900;">ì „ì²´ ì½”ì¸ ë°œì†¡</button>
            </div>

            <div class="admin-card">
              <div class="k">ğŸ“¢ EMERGENCY BROADCAST</div>
              <p style="color:#888; font-size:12px; margin-bottom:10px;">ëª¨ë“  ìœ ì € í™”ë©´ì— ê¸´ê¸‰ ê³µì§€ë¥¼ ë„ì›ë‹ˆë‹¤.</p>
              <div style="display:flex; gap:5px;">
                <input id="broadcastInput" placeholder="ê³µì§€ ë‚´ìš© ì…ë ¥"
                  style="background:#222; border:1px solid #444; color:#fff; width:100%;">
                <button id="godBroadcastBtn" class="btn"
                  style="background:#ef4444; color:#fff; border:none; width:auto;">ì „ì†¡</button>
              </div>
            </div>
          </div>

          <button id="adminExitBtn" class="btn"
            style="margin-top:30px; background:transparent; color:#ef4444; border:1px solid #ef4444; width:100%;">GOD
            MODE ì¢…ë£Œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
    SCRIPT (MODULE) - PART 1 ì‹œì‘
  ========================= -->
  <script type="module">
    /* =========================
      0) Imports
    ========================= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      onAuthStateChanged,
      signOut,
      sendPasswordResetEmail,
      sendEmailVerification
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    import {
      getFirestore,
      doc, setDoc, getDoc, updateDoc,
      collection, getDocs, addDoc,
      query, orderBy, limit,
      onSnapshot, arrayUnion,
      serverTimestamp,
      runTransaction
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    /* =========================
      1) Firebase Config
    ========================= */
    const firebaseConfig = {
      apiKey: "AIzaSyAIaroNs2VsMamnnNJV1cP9LdXqIDhl3Ig",
      authDomain: "giiiddd-36340523-3f595.firebaseapp.com",
      projectId: "giiiddd-36340523-3f595",
      storageBucket: "giiiddd-36340523-3f595.firebasestorage.app",
      messagingSenderId: "698901018936",
      appId: "1:698901018936:web:2fb12a7a03cbd844c1e9cd"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* =========================
      2) Admin Settings
    ========================= */
    const ADMIN_EMAILS = ["test@gmail.com"]; // âœ… ìš”ì²­ëŒ€ë¡œ 1ê°œë§Œ

    /* =========================
      3) Safe Helpers
    ========================= */
    const $ = (id) => document.getElementById(id);

    function isAdminUser(user) {
      return !!user?.email && ADMIN_EMAILS.includes(user.email);
    }

    function nowDateKey() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }

    function dateKeyFromOffset(n) {
      const d = new Date();
      d.setDate(d.getDate() - n);
      return d.toISOString().slice(0, 10);
    }

    function toastAchievement(title) {
      const box = $("achievementToast");
      const t = $("achievementTitle");
      if (!box || !t) return;
      t.textContent = title;
      box.style.display = "flex";
      setTimeout(() => { box.style.display = "none"; }, 3500);
    }

    function safeConfetti(p = 120) {
      try { confetti({ particleCount: p, spread: 70, origin: { y: 0.65 } }); } catch (_) { }
    }

    function appendTicker(msg) {
      const track = $("tickerContent");
      if (!track) return;
      const item = document.createElement("div");
      item.className = "ticker-item";
      item.textContent = `âš¡ ${msg}`;
      track.appendChild(item);

      const items = track.querySelectorAll(".ticker-item");
      if (items.length > 30) items[0]?.remove();

      const lt = document.getElementById("liveText"); if (lt) lt.textContent = msg;
    }

    function showProModal(type) {
      $("modalTitle").textContent = `ğŸ‘‘ ${type} ì—…ê·¸ë ˆì´ë“œ`;
      $("proModal").style.display = "flex";
    }

    function closeProModal() {
      $("proModal").style.display = "none";
    }

    function toggleZenMode(force = null) {
      const zen = $("zenOverlay");
      if (!zen) return;
      const isOpen = zen.style.display === "flex";
      const next = (force === null) ? !isOpen : force;

      if (next) {
        zen.style.display = "flex";
        requestAnimationFrame(() => { zen.style.opacity = "1"; });
      } else {
        zen.style.opacity = "0";
        setTimeout(() => { zen.style.display = "none"; }, 250);
      }
    }
    function showRoutineState(state) {
      ["routineBeforeLogin", "routineNoTheme", "routineResult"].forEach(id => {
        document.getElementById(id)?.classList.add("hidden");
      });
      document.getElementById(state)?.classList.remove("hidden");
    }

    function applyTheme(primary, secondary) {
      document.documentElement.style.setProperty("--primary", primary);
      document.documentElement.style.setProperty("--secondary", secondary);
      const b1 = document.querySelector(".blob-1");
      const b2 = document.querySelector(".blob-2");
      if (b1) b1.style.background = secondary;
      if (b2) b2.style.background = primary;
    }

    /* =========================
      4) Audio (Fail-safe)
    ========================= */
    const sfx = {
      click: new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=click-124467.mp3"),
      success: new Audio("https://cdn.pixabay.com/download/audio/2021/08/04/audio_bb630cc098.mp3?filename=success-1-6297.mp3"),
      admin: new Audio("https://cdn.pixabay.com/download/audio/2022/03/24/audio_03e0545939.mp3?filename=sci-fi-click-903.mp3"),
      play(name) {
        try {
          const a = this[name];
          if (!a) return;
          a.currentTime = 0;
          a.play();
        } catch (_) { }
      }
    };

    /* =========================
      5) Data Pools
    ========================= */
    const STICKERS = ["ğŸ", "ğŸ’Š", "ğŸ“š", "ğŸ¸", "ğŸ’", "ğŸ‘‘", "ğŸš€", "ğŸ¦„", "ğŸ¦–", "ğŸ•", "ğŸŒˆ", "ğŸ”¥", "ğŸ’§", "â­", "ğŸ€", "ğŸ„"];

    const themeData = {
      survival: ["ğŸ›Œ ë°¤ 11ì‹œ í° ë„ê¸°", "ğŸ’§ ê³µë³µ ë¬¼ í•œ ì”", "ğŸ’Š ì˜ì–‘ì œ ì±™ê²¨ë¨¹ê¸°", "ğŸ¢ ê±°ë¶ëª© ìŠ¤íŠ¸ë ˆì¹­", "ğŸ‘ï¸ ë¨¼ ì‚° ë³´ê¸°", "ğŸ§¹ ì±…ìƒ ìœ„ ë¦¬ì…‹"],
      godsaeng: ["ğŸ“… ì£¼ê°„ ê³„íš", "ğŸ›ï¸ ì´ë¶ˆ ì •ë¦¬", "ğŸ’° ê°€ê³„ë¶€", "ğŸ“š ë…ì„œ 2p", "ğŸ—£ï¸ ì˜ë‹¨ì–´ 1ê°œ", "ğŸ“ ê°ì‚¬ì¼ê¸°"],
      detox: ["ğŸ“ ì†ê¸°ë¡", "ğŸ“µ ê¸°ìƒí›„ ë…¸í°", "ğŸ½ï¸ ë°¥ë¨¹ì„ë•Œ í°X", "ğŸ§ ì´ì–´í° ë¹¼ê¸°", "ğŸ§˜ ëª…ìƒ 5ë¶„"],
      custom: []
    };
    // ===============================
    // AI ì¶”ì²œ ë¬¸êµ¬ ìì—° ì „í™˜ ë¡œí…Œì´í„°
    // ===============================
    const AI_RECS = [
      { title: "ğŸš‘ ìƒì¡´ ì²´ë ¥ íŒ©", desc: "ì§ì¥ì¸ì„ ìœ„í•œ â€˜ì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™â€™", hint: "ì˜¤ëŠ˜ì€ ë¬´ë¦¬í•˜ì§€ ë§ê³  3ë¶„ë§Œ!" },
      { title: "âœ¨ ê°“ìƒ ì…ë¬¸ íŒ©", desc: "ì„±ê³µ ë£¨í‹´ì„ 2ë¶„ì§œë¦¬ë¡œ ìª¼ê°œê¸°", hint: "ì‘ê²Œ ì‹œì‘í•˜ë©´ ë‚´ì¼ì´ ì‰¬ì›Œìš”." },
      { title: "ğŸ§˜ ë””í†¡ìŠ¤ íë§ íŒ©", desc: "ìŠ¤ë§ˆíŠ¸í° ë‚´ë ¤ë†“ê³  ë‡Œ íœ´ì‹í•˜ê¸°", hint: "í°ì€ ì ê¹, ë‚´ í˜¸í¡ì€ ê¸¸ê²Œ." },
      { title: "ğŸ§  ì§‘ì¤‘ ë¶€ìŠ¤í„°", desc: "25ë¶„ ëª°ì… + 5ë¶„ ì‰¬ê¸°", hint: "íƒ€ì´ë¨¸ ì¼œê³ , í•˜ë‚˜ë§Œ ëë‚´ìš”." }
    ];

    let aiRecIdx = 0;
    let aiRecTimer = null;

    function setAIRecContent(rec) {
      const titleEl = document.getElementById("aiRecTitle");
      const descEl = document.getElementById("aiRecDesc");
      const hintEl = document.getElementById("aiRecHint");
      if (!titleEl || !descEl || !hintEl) return;

      titleEl.textContent = rec.title;
      hintEl.textContent = rec.hint || "";
      descEl.textContent = rec.desc;
    }

    function rotateAIRec() {
      const descEl = document.getElementById("aiRecDesc");
      if (!descEl) return;

      // fade out
      descEl.classList.remove("fade-in");
      descEl.classList.add("fade-out");

      setTimeout(() => {
        aiRecIdx = (aiRecIdx + 1) % AI_RECS.length;
        const next = AI_RECS[aiRecIdx];

        // ë‚´ìš© êµì²´
        setAIRecContent(next);

        // fade in
        descEl.classList.remove("fade-out");
        descEl.classList.add("fade-in");
      }, 260);
    }

    function startAIRecRotation() {
      stopAIRecRotation();
      // ì´ˆê¸° 1íšŒ ì„¸íŒ…
      setAIRecContent(AI_RECS[aiRecIdx]);
      aiRecTimer = setInterval(rotateAIRec, 4200);
    }

    function stopAIRecRotation() {
      if (aiRecTimer) clearInterval(aiRecTimer);
      aiRecTimer = null;
    }

    const recommendations = [
      { t: "ğŸš‘ ìƒì¡´ ì²´ë ¥ íŒ©", d: 'ì§ì¥ì¸ì„ ìœ„í•œ "ì£½ì§€ ì•Šìœ¼ë ¤ê³  í•˜ëŠ” ìš´ë™"' },
      { t: "âœ¨ ê°“ìƒ ì…ë¬¸ íŒ©", d: "ì„±ê³µ ë£¨í‹´ì„ 2ë¶„ì§œë¦¬ë¡œ ìª¼ê°œê¸°" },
      { t: "ğŸ§˜ ë””í†¡ìŠ¤ íë§ íŒ©", d: "ìŠ¤ë§ˆíŠ¸í° ë‚´ë ¤ë†“ê³  ë‡Œ íœ´ì‹í•˜ê¸°" }
    ];

    /* =========================
      6) Global State
    ========================= */
    let recIdx = 0;
    let unsubscribeLogs = null;
    let unsubscribeBroadcast = null;

    let isDeleteMode = false;
    let dragCtx = null;

    /* =========================
      7) Rotating Recommendation (safe)
    ========================= */
    setInterval(() => {
      const card = $("heroRecommendCard");
      if (!card) return;
      recIdx = (recIdx + 1) % recommendations.length;
      card.style.opacity = "0";
      setTimeout(() => {
        const r = recommendations[recIdx];
        card.innerHTML = `<div><b>${r.t}</b></div><span style="font-size:12px; color:var(--text-muted)">${r.d}</span>`;
        card.style.opacity = "1";
      }, 350);
    }, 4000);

    /* =========================
      8) Auth/UI Bindings (DOM ready)
    ========================= */
    function bindStaticUI() {
      // scroll to auth
      const goAuth = () => $("authSection")?.scrollIntoView({ behavior: "smooth", block: "start" });

      $("topStartBtn")?.addEventListener("click", () => { sfx.play("click"); $("authSection")?.scrollIntoView({ behavior: "smooth", block: "start" }); });
      $("startNowBtn")?.addEventListener("click", () => { sfx.play("click"); goAuth(); });
      $("heroStartBtn")?.addEventListener("click", () => { sfx.play("click"); goAuth(); });

      // dark mode
      $("darkModeToggle")?.addEventListener("click", () => {
        sfx.play("click");
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "on" : "off");
      });
      if (localStorage.getItem("darkMode") === "on") document.body.classList.add("dark-mode");

      // zen mode
      $("zenToggleBtn")?.addEventListener("click", () => { sfx.play("click"); toggleZenMode(); });
      $("zenExitBtn")?.addEventListener("click", () => { sfx.play("click"); toggleZenMode(false); });

      // modal
      $("modalCloseBtn")?.addEventListener("click", closeProModal);
      $("modalPayBtn")?.addEventListener("click", () => alert("ê²°ì œ ê¸°ëŠ¥ ì¤€ë¹„ì¤‘!"));

      $("proUpgradeBtn")?.addEventListener("click", () => showProModal("PRO"));
      $("ultraUpgradeBtn")?.addEventListener("click", () => showProModal("ULTRA"));
      $("masterUpgradeBtn")?.addEventListener("click", () => showProModal("MASTER"));
      $("memoUnlockBtn")?.addEventListener("click", () => showProModal("PRO"));
      // âœ… header controls
      $("headerStartBtn")?.addEventListener("click", () => {
        sfx.play("click");
        $("authSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
      });

      $("themeToggleBtn")?.addEventListener("click", () => {
        sfx.play("click");
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "on" : "off");
        $("themeToggleBtn").textContent = document.body.classList.contains("dark-mode") ? "â˜€ï¸" : "ğŸŒ™";
      });

      // Deep Focus(=Zen)
      $("focusToggleBtn")?.addEventListener("click", () => {
        sfx.play("click");
        toggleZenMode(); // ê¸°ì¡´ ë„ˆ í•¨ìˆ˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      });

    }

    document.addEventListener("DOMContentLoaded", bindStaticUI);

    /* =========================
      PART 1 END HERE.
      ë‹¤ìŒ íŒŒíŠ¸(PART 2)ì—ì„œ:
      - Auth ë¡œì§(íšŒì›ê°€ì…/ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/ì¸ì¦ì²´í¬)
      - Habit ì™„ë£Œ/XP/ì½”ì¸
      - ê¸€ë¡œë²Œë¡œê·¸/ë¸Œë¡œë“œìºìŠ¤íŠ¸ êµ¬ë…
      - ìƒì /ìŠ¤í‹°ì»¤ ë“œë˜ê·¸/ì‚­ì œëª¨ë“œ
      - ë­í‚¹ ë¡œë“œ
      - ê´€ë¦¬ì íŒ¨ë„ ë™ì‘(ì—´ê¸°/íƒ­/ìœ ì €ëª©ë¡/ì½”ì¸ì„ ë¬¼/ë°©ì†¡)
      ë¥¼ ì´ì–´ì„œ ì™„ì„±í•¨.
    ========================= */
    /* =========================
      9) Firestore helpers
    ========================= */
    import { increment, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    function userRef(uid) { return doc(db, "users", uid); }
    function userLogRef(uid, dateKey) { return doc(db, "users", uid, "logs", dateKey); }
    function userMemoRef(uid, dateKey) { return doc(db, "users", uid, "memos", dateKey); }
    function systemBroadcastRef() { return doc(db, "system", "broadcast"); }
    function systemTickerRef() { return doc(db, "system", "ticker"); }

    async function ensureUserDoc(user) {
      const ref = userRef(user.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, {
          email: user.email || "",
          createdAt: serverTimestamp(),
          tier: "FREE",              // FREE | PRO | ULTRA | MASTER
          xp: 0,
          level: 1,
          coins: 0,
          streak: 0,
          totalDays: 0,
          lastCompletedDate: "",
          lastActiveAt: serverTimestamp(),
          theme: "",
          inventory: [],
          placedStickers: [],        // [{id,emoji,x,y,ts}]
        }, { merge: true });
      } else {
        await updateDoc(ref, { lastActiveAt: serverTimestamp() }).catch(() => { });
      }
    }

    function calcLevelFromXp(xp) {
      // ë ˆë²¨ì—… ê³¡ì„  (ì™„ë§Œ)
      let level = 1;
      let need = 100;
      let remaining = xp;
      while (remaining >= need) {
        remaining -= need;
        level += 1;
        need = Math.floor(need * 1.2);
        if (level > 99) break;
      }
      return { level, remain: remaining, need };
    }

    function setXpUI(xp) {
      const { level, remain, need } = calcLevelFromXp(xp);
      $("levelBadge").textContent = `Lv.${level}`;
      $("xpText").textContent = `${remain} / ${need} XP`;
      const pct = Math.max(0, Math.min(100, Math.round((remain / need) * 100)));
      $("xpBar").style.width = `${pct}%`;
      return level;
    }

    function setCoinsUI(coins) {
      $("coinCount").textContent = String(coins || 0);
      $("shopCoinCount").textContent = String(coins || 0);
    }

    function showDashboard(show) {
      $("auth").style.display = show ? "none" : "block";
      $("dashboardLayout").style.display = show ? "flex" : "none";
      $("coinDisplay").style.display = show ? "block" : "none";
      $("trashModeBtn").style.display = show ? "block" : "none";
      $("shopOpenBtn").style.display = show ? "block" : "none";
      $("rankOpenBtn").style.display = show ? "block" : "none";
    }

    function setTierUI(tier) {
      const t = tier || "FREE";
      // Memo panel (PRO+)
      const memoOk = ["PRO", "ULTRA", "MASTER"].includes(t);
      $("memoPanel").style.display = memoOk ? "flex" : "none";
      $("memoHistoryPanel").style.display = memoOk ? "flex" : "none";
      $("memoLocked").style.display = memoOk ? "none" : "flex";

      // MASTER stuff
      const isMaster = (t === "MASTER");
      $("workoutSidePanel").style.display = isMaster ? "block" : "none";
      $("timerBtn").style.display = isMaster ? "block" : "none";

      // Aura effect on app
      const appEl = $("app");
      appEl.classList.toggle("aura-effect", isMaster);

      // Tier badge text
      const tb = $("tierBadge");
      tb.style.display = "block";
      tb.innerHTML = `<div style="font-weight:900;">ë“±ê¸‰: <span style="color:var(--primary)">${t}</span></div>`;
    }

    function setPetByLevel(level) {
      const pet = $("petEmoji");
      if (!pet) return;
      if (level >= 30) pet.textContent = "ğŸ‰";
      else if (level >= 20) pet.textContent = "ğŸ¦„";
      else if (level >= 12) pet.textContent = "ğŸ£";
      else if (level >= 6) pet.textContent = "ğŸ¤";
      else pet.textContent = "ğŸ¥š";
    }

    function petSay(msg) {
      const bubble = $("petBubble");
      if (!bubble) return;
      bubble.textContent = msg;
      bubble.style.opacity = "1";
      clearTimeout(petSay._t);
      petSay._t = setTimeout(() => bubble.style.opacity = "0", 2000);
    }

    /* =========================
      10) Heatmap
    ========================= */
    function renderHeatmap(activeDatesSet) {
      const grid = $("heatmapGrid");
      if (!grid) return;
      grid.innerHTML = "";
      for (let i = 19; i >= 0; i--) {
        const key = dateKeyFromOffset(i);
        const cell = document.createElement("div");
        cell.className = "grass" + (activeDatesSet.has(key) ? " active" : "");
        cell.title = key;
        grid.appendChild(cell);
      }
    }

    async function loadHeatmap(uid) {
      const snaps = await getDocs(collection(db, "users", uid, "logs"));
      const set = new Set();
      snaps.forEach(s => {
        if (s.exists() && s.id) set.add(s.id);
      });
      renderHeatmap(set);
    }

    /* =========================
      11) Theme + suggestion
    ========================= */
    function setThemeActive(theme) {
      document.querySelectorAll(".theme-tag").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.theme === theme);
      });
    }

    function chooseSuggestion(theme) {
      if (!theme) return "í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.";
      if (theme === "custom") return "ì»¤ìŠ¤í…€ì€ ì…ë ¥í•œ ë£¨í‹´ìœ¼ë¡œ ì§„í–‰ë¼ìš”.";
      const arr = themeData[theme] || [];
      if (!arr.length) return "ì¶”ì²œ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤.";
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function bindThemeButtons(currentUser, currentTier) {
      document.querySelectorAll(".theme-tag").forEach(btn => {
        btn.addEventListener("click", async () => {
          sfx.play("click");
          const theme = btn.dataset.theme;

          // FREEëŠ” ì»¤ìŠ¤í…€ ê¸ˆì§€
          if (theme === "custom" && currentTier === "FREE") {
            alert("ì»¤ìŠ¤í…€ í…Œë§ˆëŠ” PROë¶€í„° ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return;
          }

          setThemeActive(theme);
          const suggestion = chooseSuggestion(theme);
          $("todaySuggestion").textContent = suggestion;
          $("habitName").value = suggestion;
          await updateDoc(userRef(currentUser.uid), { theme }).catch(() => { });
        });
      });
    }

    /* =========================
      12) Habit complete (core)
    ========================= */
    async function completeHabit(user, userData) {
      const today = nowDateKey();
      const logRef = userLogRef(user.uid, today);

      const logSnap = await getDoc(logRef);
      if (logSnap.exists()) {
        $("status").textContent = "ì´ë¯¸ ì˜¤ëŠ˜ ì™„ë£Œí–ˆì–´ìš” âœ…";
        petSay("ì˜¤ëŠ˜ì€ ì´ë¯¸ í–ˆì–´! ë©‹ì ¸ ğŸ˜");
        return;
      }

      const tier = userData.tier || "FREE";
      let xpGain = 20;
      let coinGain = 1;

      if (tier === "PRO") { xpGain = 25; coinGain = 1; }
      if (tier === "ULTRA") { xpGain = 25; coinGain = 2; }
      if (tier === "MASTER") { xpGain = 30; coinGain = 3; }

      await runTransaction(db, async (tx) => {
        const uRef = userRef(user.uid);
        const uSnap = await tx.get(uRef);
        const d = uSnap.data();

        const last = d.lastCompletedDate || "";
        let streak = d.streak || 0;

        // streak ê³„ì‚°
        const yesterday = dateKeyFromOffset(1);
        if (!last) streak = 1;
        else if (last === yesterday) streak += 1;
        else if (last === today) streak = streak; // (ì´ë¯¸ ì²˜ë¦¬ë¨)
        else streak = 1;

        tx.set(logRef, { completed: true, ts: serverTimestamp(), habit: $("habitName").value || "" }, { merge: true });

        tx.update(uRef, {
          xp: increment(xpGain),
          coins: increment(coinGain),
          totalDays: increment(1),
          streak,
          lastCompletedDate: today,
          lastActiveAt: serverTimestamp()
        });
      });

      sfx.play("success");
      safeConfetti(160);

      $("status").textContent = `ì™„ë£Œ! +XP ${tier === "MASTER" ? 30 : (tier === "ULTRA" ? 25 : (tier === "PRO" ? 25 : 20))} / +ì½”ì¸`;
      petSay("ì™„ë£Œ! ì˜¤ëŠ˜ë„ ê°“ìƒ ğŸ˜¤");

      if ((userData.streak || 0) + 1 === 3) toastAchievement("ì‘ì‹¬ì‚¼ì¼ íƒˆì¶œ!");
      if ((userData.streak || 0) + 1 === 7) toastAchievement("ì¼ì£¼ì¼ ì—°ì†!");
      if ((userData.streak || 0) + 1 === 30) toastAchievement("30ì¼ ì—°ì† ë¯¸ì³¤ë‹¤!");

      appendTicker(`${user.email} ë‹˜ì´ ì˜¤ëŠ˜ ìŠµê´€ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!`);

      // heatmap ì—…ë°ì´íŠ¸
      await loadHeatmap(user.uid).catch(() => { });
    }

    /* =========================
      13) Memo (PRO+)
    ========================= */
    async function saveMemo(user) {
      const today = nowDateKey();
      const text = ($("dailyMemo").value || "").trim();
      if (!text) return alert("ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      await setDoc(userMemoRef(user.uid, today), {
        date: today,
        text,
        ts: serverTimestamp()
      }, { merge: true });
      petSay("ë©”ëª¨ ì €ì¥ ì™„ë£Œ âœï¸");
      $("dailyMemo").value = "";
      await loadMemoHistory(user.uid);
    }

    async function loadMemoHistory(uid) {
      const list = $("memoHistoryList");
      if (!list) return;

      // date í•„ë“œ ê¸°ì¤€ ì •ë ¬ (ë¬¸ìì—´ YYYY-MM-DD)
      const qy = query(collection(db, "users", uid, "memos"), orderBy("date", "desc"), limit(20));
      const snaps = await getDocs(qy);
      list.innerHTML = "";
      if (snaps.empty) {
        list.innerHTML = `<div style="text-align:center; padding:10px; color:var(--text-muted); font-size:13px;">ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }
      snaps.forEach(s => {
        const d = s.data();
        const item = document.createElement("div");
        item.className = "memo-item";
        item.innerHTML = `<div class="memo-date">${d.date}</div><div>${(d.text || "").replace(/</g, "&lt;")}</div>`;
        list.appendChild(item);
      });
    }

    /* =========================
      14) Shop + Stickers
    ========================= */
    function renderInventory(inv) {
      const box = $("inventoryList");
      if (!box) return;
      box.innerHTML = "";
      (inv || []).forEach((emoji) => {
        const b = document.createElement("button");
        b.className = "btn";
        b.style.width = "100%";
        b.style.padding = "10px 0";
        b.style.borderRadius = "10px";
        b.style.background = "rgba(0,0,0,0.04)";
        b.style.boxShadow = "none";
        b.textContent = emoji;
        b.title = "í´ë¦­í•˜ë©´ í™”ë©´ì— ë°°ì¹˜";
        b.addEventListener("click", () => spawnSticker(emoji, true));
        box.appendChild(b);
      });
    }

    function spawnSticker(emoji, save = false, preset = null) {
      const layer = $("stickerLayer");
      if (!layer) return;

      const st = document.createElement("div");
      st.className = "sticker";
      st.textContent = emoji;

      const id = preset?.id || crypto.randomUUID();
      st.dataset.id = id;

      const x = preset?.x ?? Math.floor(40 + Math.random() * (window.innerWidth - 120));
      const y = preset?.y ?? Math.floor(120 + Math.random() * (window.innerHeight - 220));

      st.style.left = `${x}px`;
      st.style.top = `${y}px`;

      // delete mode click
      st.addEventListener("click", async (e) => {
        if (!isDeleteMode) return;
        e.stopPropagation();
        st.remove();
        await removePlacedSticker(id).catch(() => { });
        petSay("ì‚­ì œ ì™„ë£Œ ğŸ—‘ï¸");
      });

      // drag
      st.addEventListener("pointerdown", (e) => {
        if (isDeleteMode) return;
        dragCtx = { el: st, startX: e.clientX, startY: e.clientY, origX: parseInt(st.style.left, 10), origY: parseInt(st.style.top, 10) };
        st.setPointerCapture(e.pointerId);
      });
      st.addEventListener("pointermove", (e) => {
        if (!dragCtx || dragCtx.el !== st) return;
        const nx = dragCtx.origX + (e.clientX - dragCtx.startX);
        const ny = dragCtx.origY + (e.clientY - dragCtx.startY);
        st.style.left = `${nx}px`;
        st.style.top = `${ny}px`;
      });
      st.addEventListener("pointerup", async (e) => {
        if (!dragCtx || dragCtx.el !== st) return;
        dragCtx = null;
        // ì €ì¥ ê°±ì‹ 
        await updatePlacedSticker(id, parseInt(st.style.left, 10), parseInt(st.style.top, 10)).catch(() => { });
      });

      layer.appendChild(st);

      if (save) addPlacedSticker({ id, emoji, x, y });
    }

    let currentUserCache = null;

    async function addPlacedSticker(stickerObj) {
      if (!currentUserCache) return;
      const u = currentUserCache;
      await updateDoc(userRef(u.uid), {
        placedStickers: arrayUnion({ ...stickerObj, ts: Date.now() })
      }).catch(() => { });
    }

    async function updatePlacedSticker(id, x, y) {
      if (!currentUserCache) return;
      const u = currentUserCache;
      const snap = await getDoc(userRef(u.uid));
      const d = snap.data();
      const arr = (d.placedStickers || []).map(s => (s.id === id ? { ...s, x, y } : s));
      await updateDoc(userRef(u.uid), { placedStickers: arr }).catch(() => { });
    }

    async function removePlacedSticker(id) {
      if (!currentUserCache) return;
      const u = currentUserCache;
      const snap = await getDoc(userRef(u.uid));
      const d = snap.data();
      const arr = (d.placedStickers || []).filter(s => s.id !== id);
      await updateDoc(userRef(u.uid), { placedStickers: arr }).catch(() => { });
    }

    async function loadPlacedStickers(uid) {
      const layer = $("stickerLayer");
      if (!layer) return;
      layer.innerHTML = "";
      const snap = await getDoc(userRef(uid));
      const d = snap.data();
      (d.placedStickers || []).forEach(s => spawnSticker(s.emoji, false, s));
    }

    async function gachaRoll(user) {
      const uRef = userRef(user.uid);
      await runTransaction(db, async (tx) => {
        const snap = await tx.get(uRef);
        const d = snap.data();
        const coins = d.coins || 0;
        if (coins < 1) throw new Error("NO_COIN");
        const pick = STICKERS[Math.floor(Math.random() * STICKERS.length)];
        tx.update(uRef, { coins: increment(-1), inventory: arrayUnion(pick), lastActiveAt: serverTimestamp() });
      }).then(async () => {
        const pick = STICKERS[Math.floor(Math.random() * STICKERS.length)];
        // ìœ„ íŠ¸ëœì­ì…˜ì—ì„œ pickê³¼ ë™ì¼ ë³´ì¥í•˜ë ¤ë©´ pickì„ ë°–ì—ì„œ ë§Œë“¤ê³  txì— ë„£ì–´ì•¼ í•¨.
        // ì•ˆì •ì„±ì„ ìœ„í•´ ë‹¤ì‹œ í•œë²ˆ user docì—ì„œ ë§ˆì§€ë§‰ addedë¥¼ ëª» ì½ìœ¼ë‹ˆ, ì—¬ê¸°ì„œëŠ” íš¨ê³¼ë§Œ.
        petSay("ìŠ¤í‹°ì»¤ GET! ğŸ‰");
        safeConfetti(120);
      }).catch((e) => {
        if (e.message === "NO_COIN") alert("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        else console.error(e);
      });
    }

    /* =========================
      15) Ranking
    ========================= */
    async function loadRanking() {
      const box = $("rankList");
      if (!box) return;
      box.innerHTML = `<div style="color:var(--text-muted); font-size:13px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
      const qy = query(collection(db, "users"), orderBy("totalDays", "desc"), limit(20));
      const snaps = await getDocs(qy);
      box.innerHTML = "";
      let i = 1;
      snaps.forEach(s => {
        const d = s.data();
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.justifyContent = "space-between";
        row.style.alignItems = "center";
        row.style.padding = "10px";
        row.style.borderRadius = "10px";
        row.style.marginBottom = "8px";
        row.style.background = "rgba(0,0,0,0.04)";
        row.innerHTML = `
          <div style="display:flex; flex-direction:column;">
            <b>${i}. ${(d.email || "unknown").replace(/</g, "&lt;")}</b>
            <span style="font-size:12px; color:var(--text-muted);">ë“±ê¸‰: ${d.tier || "FREE"} Â· ì—°ì† ${d.streak || 0}ì¼</span>
          </div>
          <div style="font-weight:900; color:var(--primary);">${d.totalDays || 0}íšŒ</div>
        `;
        box.appendChild(row);
        i++;
      });
    }

    /* =========================
      16) Global Cheer (hearts)
    ========================= */
    function spawnHeart() {
      const h = document.createElement("div");
      h.className = "cheer-heart";
      h.textContent = "ğŸ’–";
      h.style.left = `${Math.random() * (window.innerWidth - 20)}px`;
      h.style.bottom = "10px";
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 3000);
    }

    /* =========================
      17) Workout (MASTER)
    ========================= */
    const workoutMissions = {
      walk: ["10ë¶„ ë¹ ë¥´ê²Œ ê±·ê¸°", "ê³„ë‹¨ 5ì¸µ ì˜¤ë¥´ê¸°", "ì‚°ì±… 20ë¶„", "ë§Œë³´ì˜ 10% ë‹¬ì„±"],
      run: ["1km ëŸ¬ë‹", "ì¸í„°ë²Œ 5ì„¸íŠ¸", "ê°€ë²¼ìš´ ì¡°ê¹… 15ë¶„", "200m ìŠ¤í”„ë¦°íŠ¸ 3íšŒ"],
      gym: ["ìŠ¤ì¿¼íŠ¸ 30ê°œ", "í‘¸ì‰¬ì—… 20ê°œ", "í”Œë­í¬ 60ì´ˆ", "ë°ë“œë¦¬í”„íŠ¸/ìŠ¤ì¿¼íŠ¸ ê°€ë³ê²Œ 3ì„¸íŠ¸"]
    };
    let workoutType = "walk";
    let lastWorkoutMission = "";

    function bindWorkoutPanel(user) {
      document.querySelectorAll(".w-tab").forEach(b => {
        b.addEventListener("click", () => {
          sfx.play("click");
          document.querySelectorAll(".w-tab").forEach(x => x.classList.remove("active"));
          b.classList.add("active");
          workoutType = b.dataset.type;
          $("workoutResult").textContent = "â“";
          $("completeWorkoutBtn").style.display = "none";
        });
      });

      $("startWorkoutBtn")?.addEventListener("click", () => {
        sfx.play("click");
        const arr = workoutMissions[workoutType] || ["ì˜¤ëŠ˜ì€ ì‰¬ì–´ë„ ë¨"];
        lastWorkoutMission = arr[Math.floor(Math.random() * arr.length)];
        $("workoutResult").innerHTML = `<div class="workout-anim">${lastWorkoutMission}</div>`;
        $("completeWorkoutBtn").style.display = "block";
      });

      $("completeWorkoutBtn")?.addEventListener("click", async () => {
        if (!lastWorkoutMission) return;
        // ì½”ì¸ 3ë°° ë³´ë„ˆìŠ¤(ì¶”ê°€ë¡œ +6)
        await updateDoc(userRef(user.uid), { coins: increment(6), lastActiveAt: serverTimestamp() }).catch(() => { });
        safeConfetti(140);
        petSay("ìš´ë™ ì™„ë£Œ! ì½”ì¸ ë³´ë„ˆìŠ¤ ğŸ’°");
        $("completeWorkoutBtn").style.display = "none";
        lastWorkoutMission = "";
      });
    }

    /* =========================
      18) Pomodoro (MASTER)
    ========================= */
    let timerInterval = null;
    function startPomodoro(minutes = 25) {
      let remaining = minutes * 60;
      $("status").textContent = `â±ï¸ ${minutes}ë¶„ ì§‘ì¤‘ ì‹œì‘!`;

      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        remaining--;
        const mm = String(Math.floor(remaining / 60)).padStart(2, "0");
        const ss = String(remaining % 60).padStart(2, "0");
        $("timerBtn").textContent = `${mm}:${ss}`;
        if (remaining <= 0) {
          clearInterval(timerInterval);
          $("timerBtn").textContent = "â±ï¸";
          safeConfetti(120);
          toastAchievement("ì§‘ì¤‘ ì™„ë£Œ!");
          alert("í¬ëª¨ë„ë¡œ ì¢…ë£Œ! 5ë¶„ ì‰¬ì–´ìš”.");
        }
      }, 1000);
    }

    /* =========================
      19) Broadcast (system)
    ========================= */
    function bindBroadcastListener() {
      if (unsubscribeBroadcast) unsubscribeBroadcast();
      unsubscribeBroadcast = onSnapshot(systemBroadcastRef(), (snap) => {
        if (!snap.exists()) return;
        const d = snap.data();
        if (d?.active) {
          $("broadcastMsg").textContent = d.message || "ê¸´ê¸‰ ê³µì§€";
          $("broadcastOverlay").classList.add("active");
          setTimeout(() => $("broadcastOverlay").classList.remove("active"), 6000);
        }
      });
    }

    /* =========================
      20) Admin Panel Logic
    ========================= */
    function logAdmin(msg) {
      const box = $("matrixLog");
      if (!box) return;
      const line = document.createElement("div");
      line.className = "log-line";
      const ts = new Date().toLocaleTimeString();
      line.innerHTML = `<span>[${ts}]</span><div>${msg}</div>`;
      box.appendChild(line);
      box.scrollTop = box.scrollHeight;
    }

    function openAdmin() {
      sfx.play("admin");
      $("adminPanel").style.display = "block";
      logAdmin("ADMIN CONSOLE OPENED");
    }
    function closeAdmin() {
      $("adminPanel").style.display = "none";
    }

    function bindAdminNav() {
      document.querySelectorAll(".adminNavBtn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".adminNavBtn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          const pane = btn.dataset.pane;
          document.querySelectorAll(".admin-pane").forEach(p => p.classList.remove("active"));
          $(pane).classList.add("active");
        });
      });
    }

    async function adminRefreshDashboard() {
      const snaps = await getDocs(collection(db, "users"));
      let total = 0, pro = 0, active = 0;
      const tiers = { FREE: 0, PRO: 0, ULTRA: 0, MASTER: 0 };

      const now = Date.now();
      const weekAgo = now - 7 * 24 * 60 * 60 * 1000;

      snaps.forEach(s => {
        total++;
        const d = s.data();
        const tier = d.tier || "FREE";
        tiers[tier] = (tiers[tier] ?? 0) + 1;
        if (["PRO", "ULTRA", "MASTER"].includes(tier)) pro++;

        // lastActiveAtì€ Timestampì¼ ìˆ˜ ìˆìŒ
        const la = d.lastActiveAt?.toMillis ? d.lastActiveAt.toMillis() : 0;
        if (la && la >= weekAgo) active++;
      });

      $("dashTotal").textContent = String(total);
      $("dashPro").textContent = String(pro);
      $("dashActive").textContent = String(active);

      // tier chart
      const chart = $("tierChart");
      chart.innerHTML = "";
      const max = Math.max(1, ...Object.values(tiers));
      Object.entries(tiers).forEach(([k, v]) => {
        const bar = document.createElement("div");
        bar.className = "chart-bar";
        bar.style.width = `${Math.round((v / max) * 100)}%`;
        bar.title = `${k}: ${v}`;
        // ìƒ‰ì€ CSS ì§€ì • ëª»í•˜ë‹ˆ inline(ìš”ì²­ ì—†ìŒ) ëŒ€ì‹  ê°„ë‹¨íˆ ë“±ê¸‰ë³„ ê³ ì •
        bar.style.background = k === "MASTER" ? "#ffd700" : (k === "ULTRA" ? "#f59e0b" : (k === "PRO" ? "#6366f1" : "#555"));
        chart.appendChild(bar);
      });

      logAdmin(`DASH REFRESHED: total=${total}, pro=${pro}, active7d=${active}`);
    }

    async function adminLoadUsers(filterEmail = "") {
      const box = $("admUserList");
      box.innerHTML = `<div style="color:#666;">Loading...</div>`;
      const snaps = await getDocs(collection(db, "users"));

      const rows = [];
      snaps.forEach(s => {
        const d = s.data();
        if (filterEmail && !(d.email || "").includes(filterEmail)) return;
        rows.push({ id: s.id, ...d });
      });

      box.innerHTML = "";
      if (!rows.length) {
        box.innerHTML = `<div style="color:#666;">No users.</div>`;
        return;
      }

      rows.slice(0, 200).forEach(u => {
        const el = document.createElement("div");
        el.className = "admin-card";
        el.style.display = "grid";
        el.style.gridTemplateColumns = "1fr auto";
        el.style.gap = "12px";
        el.innerHTML = `
          <div>
            <div style="font-weight:900; color:#fff;">${(u.email || "unknown").replace(/</g, "&lt;")}</div>
            <div style="color:#888; font-size:12px; margin-top:6px;">
              tier: <b style="color:#fff">${u.tier || "FREE"}</b> Â· streak: <b style="color:#fff">${u.streak || 0}</b> Â· total: <b style="color:#fff">${u.totalDays || 0}</b> Â· coins: <b style="color:#fff">${u.coins || 0}</b>
            </div>
          </div>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button class="btn" data-act="give10" style="background:#222; color:#fff; border:1px solid #444; width:auto;">+10ğŸ’°</button>
            <button class="btn" data-act="ban" style="background:#ef4444; color:#fff; border:none; width:auto;">(ìƒ˜í”Œ)ì œí•œ</button>
          </div>
        `;

        el.querySelector('[data-act="give10"]').addEventListener("click", async () => {
          await updateDoc(userRef(u.id), { coins: increment(10) }).catch(() => { });
          logAdmin(`GIFTED +10 coins -> ${u.email}`);
          adminRefreshDashboard();
        });

        el.querySelector('[data-act="ban"]').addEventListener("click", () => {
          alert("ë°ëª¨ ë²„íŠ¼ì…ë‹ˆë‹¤. (ì‹¤ì œ ì°¨ë‹¨ ê¸°ëŠ¥ì€ ë³„ë„ ì„¤ê³„ í•„ìš”)");
        });

        box.appendChild(el);
      });
    }

    async function adminMassGiftCoins(amount = 100) {
      const snaps = await getDocs(collection(db, "users"));
      const docs = [];
      snaps.forEach(s => docs.push(s));

      // batch in chunks
      let i = 0;
      while (i < docs.length) {
        const batch = writeBatch(db);
        const chunk = docs.slice(i, i + 400);
        chunk.forEach(s => batch.update(s.ref, { coins: increment(amount) }));
        await batch.commit();
        i += 400;
      }
      logAdmin(`MASS GIFT completed: +${amount} coins to ${docs.length} users`);
      await adminRefreshDashboard();
    }

    async function adminBroadcast(message) {
      const msg = (message || "").trim();
      if (!msg) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
      await setDoc(systemBroadcastRef(), { active: true, message: msg, ts: serverTimestamp() }, { merge: true });
      logAdmin(`BROADCAST SENT: "${msg}"`);
      setTimeout(() => setDoc(systemBroadcastRef(), { active: false }, { merge: true }).catch(() => { }), 6500);
    }

    /* =========================
      21) UI Bindings (after login)
    ========================= */
    function bindAuthedUI(user, getUserData) {
      $("logoutBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        await signOut(auth);
      });

      $("habitBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        const data = await getUserData();
        await completeHabit(user, data);
      });

      $("saveMemoBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        await saveMemo(user);
      });

      $("petContainer")?.addEventListener("click", () => {
        sfx.play("click");
        petSay(["í•  ìˆ˜ ìˆì–´!", "ì˜¤ëŠ˜ë„ í•œ ê±¸ìŒ!", "ë©ˆì¶”ì§€ë§ˆ!", "ë„ˆëŠ” ëœë‹¤!"][Math.floor(Math.random() * 4)]);
      });

      $("globalCheerBtn")?.addEventListener("click", () => {
        sfx.play("click");
        for (let i = 0; i < 12; i++) setTimeout(spawnHeart, i * 120);
        appendTicker(`ğŸ’– ${user.email} ë‹˜ì´ ëª¨ë‘ì—ê²Œ ì‘ì›ì„ ë³´ëƒˆìŠµë‹ˆë‹¤!`);
        petSay("ì‘ì› ë°œì‚¬ ğŸ’–");
      });

      // shop open/close
      $("shopOpenBtn")?.addEventListener("click", () => { sfx.play("click"); $("shopPanel").style.display = "block"; });
      $("shopCloseBtn")?.addEventListener("click", () => { sfx.play("click"); $("shopPanel").style.display = "none"; });

      // rank open/close
      $("rankOpenBtn")?.addEventListener("click", async () => { sfx.play("click"); $("rankPanel").style.display = "block"; await loadRanking(); });
      $("rankCloseBtn")?.addEventListener("click", () => { sfx.play("click"); $("rankPanel").style.display = "none"; });

      // gacha
      $("gachaBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        // íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ pickì„ ê³ ì •í•˜ë ¤ë©´ ì´ë ‡ê²Œ:
        const pick = STICKERS[Math.floor(Math.random() * STICKERS.length)];
        await runTransaction(db, async (tx) => {
          const uRef = userRef(user.uid);
          const snap = await tx.get(uRef);
          const d = snap.data();
          const coins = d.coins || 0;
          if (coins < 1) throw new Error("NO_COIN");
          tx.update(uRef, { coins: increment(-1), inventory: arrayUnion(pick), lastActiveAt: serverTimestamp() });
        }).then(() => {
          petSay(`ìŠ¤í‹°ì»¤ GET! ${pick}`);
          safeConfetti(120);
          spawnSticker(pick, true);
        }).catch((e) => {
          if (e.message === "NO_COIN") alert("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
          else console.error(e);
        });
      });

      // delete mode
      $("trashModeBtn")?.addEventListener("click", () => {
        sfx.play("click");
        isDeleteMode = !isDeleteMode;
        $("trashModeBtn").style.filter = isDeleteMode ? "drop-shadow(0 0 10px rgba(245,158,11,0.9))" : "none";
        petSay(isDeleteMode ? "ì‚­ì œ ëª¨ë“œ ON (ìŠ¤í‹°ì»¤ í´ë¦­í•´ì„œ ì‚­ì œ)" : "ì‚­ì œ ëª¨ë“œ OFF");
      });

      // pomodoro
      $("timerBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        const data = await getUserData();
        if ((data.tier || "FREE") !== "MASTER") return;
        startPomodoro(25);
      });

      // admin buttons (only admin)
      $("adminOpenBtn")?.addEventListener("click", () => openAdmin());
      $("adminCloseBtn")?.addEventListener("click", closeAdmin);
      $("adminExitBtn")?.addEventListener("click", closeAdmin);
      bindAdminNav();

      $("refreshAdminBtn")?.addEventListener("click", async () => {
        sfx.play("click");
        await adminRefreshDashboard();
        await adminLoadUsers($("adminSearch").value.trim());
      });

      $("adminSearch")?.addEventListener("input", async () => {
        const v = $("adminSearch").value.trim();
        await adminLoadUsers(v);
      });

      $("godGiftBtn")?.addEventListener("click", async () => {
        if (!confirm("ëª¨ë“  ìœ ì €ì—ê²Œ 100ì½”ì¸ì„ ì„ ë¬¼í• ê¹Œìš”?")) return;
        await adminMassGiftCoins(100);
      });

      $("godBroadcastBtn")?.addEventListener("click", async () => {
        await adminBroadcast($("broadcastInput").value);
        $("broadcastInput").value = "";
      });

      // close panels on background click? (safe)
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          $("shopPanel").style.display = "none";
          $("rankPanel").style.display = "none";
          closeProModal();
          closeAdmin();
          toggleZenMode(false);
        }
      });
    }

    /* =========================
      22) Auth actions
    ========================= */
    $("signupBtn")?.addEventListener("click", async () => {
      sfx.play("click");
      const email = ($("email").value || "").trim();
      const password = ($("password").value || "").trim();
      if (!email || !password) return alert("ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      if (password.length < 6) return alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        // ì¸ì¦ë©”ì¼(ì›í•˜ë©´)
        try { await sendEmailVerification(cred.user); } catch (_) { }
        alert("íšŒì›ê°€ì… ì™„ë£Œ! (ì›í•˜ë©´ ì´ë©”ì¼ ì¸ì¦ì„ ì§„í–‰í•˜ì„¸ìš”)");
      } catch (e) {
        alert(e?.message || "íšŒì›ê°€ì… ì‹¤íŒ¨");
        console.error(e);
      }
    });

    $("signinBtn")?.addEventListener("click", async () => {
      sfx.play("click");
      const email = ($("email").value || "").trim();
      const password = ($("password").value || "").trim();
      if (!email || !password) return alert("ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (e) {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ í™•ì¸");
        console.error(e);
      }
    });

    $("resetPwBtn")?.addEventListener("click", async () => {
      sfx.play("click");
      const email = ($("email").value || "").trim();
      if (!email) return alert("ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.");
      try {
        await sendPasswordResetEmail(auth, email);
        alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.");
      } catch (e) {
        alert("ì „ì†¡ ì‹¤íŒ¨: ì´ë©”ì¼ í™•ì¸");
        console.error(e);
      }
    });

    /* =========================
      23) Single Auth Observer (NO DUPLICATE)
    ========================= */
    let userDataCache = null;
    let userUnsub = null;

    onAuthStateChanged(auth, async (user) => {
      // cleanup
      if (userUnsub) { userUnsub(); userUnsub = null; }
      if (unsubscribeLogs) { unsubscribeLogs(); unsubscribeLogs = null; }

      if (!user) {
        currentUserCache = null;
        userDataCache = null;
        showDashboard(false);
        $("welcome").textContent = "";
        $("stickerLayer").innerHTML = "";
        $("adminOpenBtn").style.display = "none";
        return;
      }
      // âœ… ê´€ë¦¬ì ë²„íŠ¼ ê°•ì œ í‘œì‹œ íŒ¨ì¹˜
      const adminBtn = document.getElementById("adminOpenBtn");
      if (adminBtn && user.email === "test@gmail.com") {
        adminBtn.style.display = "block";

        adminBtn.onclick = () => {
          document.getElementById("adminPanel").style.display = "block";
        };
      }
      currentUserCache = user;
      showDashboard(true);
      $("welcome").textContent = `${user.email} ë‹˜`;

      await ensureUserDoc(user);
      bindBroadcastListener();

      // live user doc subscribe
      userUnsub = onSnapshot(
        userRef(user.uid),
        async (snap) => {
          console.log("[onSnapshot] fired", snap.exists(), snap.id);

          if (!snap.exists()) {
            console.warn("[onSnapshot] user doc missing -> ensureUserDoc again");
            await ensureUserDoc(user);
            return;
          }

          const data = snap.data();

          // âœ… ADMINì´ë©´ tierë¥¼ ë¨¼ì € MASTERë¡œ ê°•ì œ (UI ì—…ë°ì´íŠ¸ë³´ë‹¤ ë¨¼ì €!)
          const isAdmin = isAdminUser(user);
          if (isAdmin) {
            data.tier = "MASTER";
          }


          // ---- UI updates ----
          const level = setXpUI(data.xp || 0);
          setPetByLevel(level);

          setCoinsUI(data.coins || 0);
          setTierUI(data.tier || "FREE");

          $("streakCount").textContent = `ğŸ”¥ ì—°ì† ${data.streak || 0}ì¼ / ì´ ${data.totalDays || 0}íšŒ`;

          // theme
          const theme = data.theme || "";
          if (theme) {
            setThemeActive(theme);
            const suggestion = chooseSuggestion(theme);
            $("todaySuggestion").textContent = suggestion;
            $("habitName").value = suggestion;
          } else {
            setThemeActive("");
            $("todaySuggestion").textContent = "í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.";
            $("habitName").value = "í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.";
          }

          // inventory
          renderInventory(data.inventory || []);

          // placed stickers
          await loadPlacedStickers(user.uid).catch(() => ({}));

          // heatmap
          await loadHeatmap(user.uid).catch(() => ({}));

          // memo history (tier ê¸°ì¤€)
          if (["PRO", "ULTRA", "MASTER"].includes(data.tier || "FREE")) {
            await loadMemoHistory(user.uid).catch(() => ({}));
          }

          // âœ… admin visibility (ìœ„ì—ì„œ êµ¬í•œ isAdmin ì¬ì‚¬ìš©)
          $("adminOpenBtn").style.display = isAdmin ? "block" : "none";
          if (isAdmin) {
            await adminRefreshDashboard().catch(() => ({}));
            await adminLoadUsers($("adminSearch").value.trim()).catch(() => ({}));
          }
        });

      // bind one-time UI handlers that need user reference
      const getUserData = async () => userDataCache || (await getDoc(userRef(user.uid))).data();

      // theme buttons
      bindThemeButtons(user, (userDataCache?.tier || "FREE"));

      // workout panel bindings
      bindWorkoutPanel(user);

      // authed UI events
      bindAuthedUI(user, getUserData);

      // initial ticker
      appendTicker(`${user.email} ë‹˜ì´ ì ‘ì†í–ˆìŠµë‹ˆë‹¤.`);
      // âœ… ê¸°ëŠ¥ ì „ì²´ ë°”ì¸ë”© (ì´ê²Œ ë¹ ì ¸ ìˆì—ˆìŒ)
      bindThemeButtons(user, userDataCache?.tier || "FREE");
      bindWorkoutPanel(user);
      bindAuthedUI(user, async () => userDataCache);
    });

    /* =========================
      24) Safety: prevent overlay blocking clicks
    ========================= */
    // (ì´ë¯¸ CSSë¡œ pointer-events ì •ë¦¬ë˜ì–´ ìˆìŒ)

  </script>
  <!-- ===================== DASHBOARD (ë¡œê·¸ì¸ í›„ ë³´ì„) ===================== -->
  <section id="dashboard" style="display:none;">
    <div class="dashboard-layout">

      <!-- âœ… ì™¼ìª½: ë©”ì¸ ì¹´ë“œ -->
      <div class="glass card main-card">
        <div class="top-row">
          <div>
            <div id="welcome" class="welcome">-</div>
            <div class="level-row">
              <span id="levelText" class="level">Lv.1</span>
              <span id="xpText" class="xp">0 / 100 XP</span>
            </div>
            <div class="xp-bar">
              <div id="xpBarFill" class="xp-fill" style="width:0%"></div>
            </div>
          </div>

          <button id="logoutBtn" class="ghost-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="pet-wrap">
          <div id="pet" class="pet">ğŸ¥š</div>
        </div>

        <button id="broadcastBtn" class="primary-btn">ğŸ’Œ ëª¨ë‘ì—ê²Œ ì‘ì› ë³´ë‚´ê¸°</button>

        <div class="mini-row">
          <div id="streakCount" class="mini-pill">ğŸ”¥ ì—°ì† 0ì¼ / ì´ 0íšŒ</div>
          <button id="openLogBtn" class="mini-link">Log</button>
        </div>

        <div class="tier-row">
          <div class="tier-label">ë“±ê¸‰: <b id="tierText">FREE</b></div>
          <div class="coins">â­ <b id="coinsText">0</b></div>
        </div>

        <hr class="sep" />

        <!-- âœ… ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ© -->
        <div class="section-title">ğŸ ì˜¤ëŠ˜ì˜ ë£¨í‹´ íŒ©</div>
        <div class="theme-tabs">
          <button class="theme-btn" data-theme="survival">ğŸš‘ ìƒì¡´</button>
          <button class="theme-btn" data-theme="growth">âœ¨ ê°“ìƒ</button>
          <button class="theme-btn" data-theme="detox">ğŸ“µ ë””í†¡ìŠ¤</button>
          <button class="theme-btn" data-theme="custom">â• ì»¤ìŠ¤í…€</button>
        </div>

        <div class="suggest-card">
          <div class="suggest-title">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë£¨í‹´</div>
          <div id="todaySuggestion" class="suggest-text">í…Œë§ˆë¥¼ ì„ íƒí•˜ë©´ ì¶”ì²œì´ ëœ¹ë‹ˆë‹¤.</div>
        </div>

        <div class="input-row">
          <input id="habitName" class="input" placeholder="ì˜¤ëŠ˜ í•  'ë”± 1ê°œ' ìŠµê´€" />
          <button id="addHabitBtn" class="accent-btn">ì¶”ê°€</button>
        </div>

        <div id="habitList" class="habit-list"></div>

        <button id="completeDayBtn" class="big-done">ì˜¤ëŠ˜ ìŠµê´€ ì™„ë£Œ âœ…</button>
      </div>

      <!-- âœ… ì˜¤ë¥¸ìª½: ìš´ë™/ë©”ëª¨/íˆíŠ¸ë§µ/ì¸ë²¤í† ë¦¬ íŒ¨ë„ -->
      <div class="right-stack">

        <!-- ìš´ë™ íŒ¨ë„ -->
        <div id="workoutSidePanel" class="glass card workout-side-panel">
          <div class="w-title">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì±Œë¦°ì§€</div>
          <div class="workout-tabs">
            <button class="w-tab active" data-type="walk">ğŸš¶ ê±·ê¸°</button>
            <button class="w-tab" data-type="run">ğŸƒ ë‹¬ë¦¬ê¸°</button>
            <button class="w-tab" data-type="gym">ğŸ‹ï¸ í—¬ìŠ¤</button>
          </div>

          <div class="workout-display">
            <div id="workoutResult" class="wd-main">?</div>
            <div class="wd-sub">ì¢…ëª© ì„ íƒ í›„ ë¯¸ì…˜ ë½‘ê¸°!</div>
          </div>

          <button id="startWorkoutBtn" class="btn">ë¯¸ì…˜ ëœë¤ ë½‘ê¸°</button>
          <button id="completeWorkoutBtn" class="btn done" style="display:none;">ì™„ë£Œ (ì½”ì¸ 3ë°°)</button>
        </div>

        <!-- ë©”ëª¨ íŒ¨ë„ -->
        <div id="memoPanel" class="glass card memo-panel" style="display:none;">
          <div class="memo-header">
            <div class="memo-title">ğŸ“ ì˜¤ëŠ˜ì˜ ë©”ëª¨</div>
            <span class="memo-badge">PRO+</span>
          </div>

          <textarea id="memoInput" class="memo-input" placeholder="ì˜¤ëŠ˜ ëŠë‚€ ì , íšŒê³ , ë‚´ì¼ ê³„íš..."></textarea>
          <div class="memo-actions">
            <button id="saveMemoBtn" class="accent-btn">ì €ì¥</button>
            <button id="openMemoHistoryBtn" class="ghost-btn">ê¸°ë¡ ë³´ê¸°</button>
          </div>

          <div id="memoHistory" class="memo-history" style="display:none;"></div>
        </div>

        <!-- íˆíŠ¸ë§µ -->
        <div class="glass card">
          <div class="section-title">ğŸ“ˆ íˆíŠ¸ë§µ</div>
          <div id="heatmap" class="heatmap"></div>
        </div>

        <!-- ì¸ë²¤í† ë¦¬ -->
        <div class="glass card">
          <div class="section-title">ğŸ’ ì¸ë²¤í† ë¦¬</div>
          <div id="inventory" class="inventory"></div>
        </div>

      </div>
    </div>
  </section>

  <!-- âœ… ê´€ë¦¬ì ë²„íŠ¼ / ê´€ë¦¬ì íŒ¨ë„ -->
  <button id="adminOpenBtn" class="admin-fab" style="display:none;">ğŸ›  ê´€ë¦¬ì</button>

  <section id="adminPanel" class="admin-panel" style="display:none;">
    <div class="glass card admin-shell">
      <div class="admin-top">
        <div class="admin-title">ğŸ›  ê´€ë¦¬ì íŒ¨ë„</div>
        <button id="adminCloseBtn" class="ghost-btn">ë‹«ê¸°</button>
      </div>

      <div class="admin-grid">
        <div class="admin-box">
          <div class="admin-box-title">ìœ ì € ê²€ìƒ‰</div>
          <div class="input-row">
            <input id="adminSearch" class="input" placeholder="ì´ë©”ì¼ë¡œ ê²€ìƒ‰" />
            <button id="adminSearchBtn" class="accent-btn">ê²€ìƒ‰</button>
          </div>
          <div id="adminUserList" class="admin-list"></div>
        </div>

        <div class="admin-box">
          <div class="admin-box-title">ê´€ë¦¬ì ë¡œê·¸ì¸ ê°•ì œ</div>
          <div class="admin-desc">
            ê´€ë¦¬ì ì´ë©”ì¼/ë¹„ë²ˆì„ ì„¤ì •í•˜ë©´, ì„ íƒí•œ ìœ ì €ë¥¼ ë¡œê·¸ì¸ëœ ìƒíƒœâ€ë¡œ ì „í™˜í•˜ëŠ” ê¸°ëŠ¥(ì„¸ì…˜ ìŠ¤ìœ„ì¹˜)ì„ ë¶™ì¼ ìˆ˜ ìˆì–´ìš”.
            (Firebase Auth íŠ¹ì„±ìƒ ì„œë²„ ì—†ì´ ì™„ì „í•œ ê°•ì œë¡œê·¸ì¸ì€ ì œí•œì´ ìˆì–´ ë³„ë„ êµ¬í˜„ í•„ìš”)
          </div>

          <div class="input-row">
            <input id="adminEmail" class="input" placeholder="ê´€ë¦¬ì ì´ë©”ì¼" value="test@gmail.com" />
          </div>
          <div class="input-row">
            <input id="adminPass" class="input" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸" type="password" />
            <button id="saveAdminCredBtn" class="accent-btn">ì €ì¥</button>
          </div>

          <div id="adminStatus" class="admin-status">-</div>
        </div>
      </div>
    </div>
  </section>
  <!-- âœ… BOTTOM LIVE TICKER (site bottom, one-line marquee) -->
  <div id="bottomTicker" class="bottom-ticker" aria-label="ì‹¤ì‹œê°„ í™œë™">
    <div class="ticker-track" id="tickerContent"></div>
  </div>

</body>

</html>